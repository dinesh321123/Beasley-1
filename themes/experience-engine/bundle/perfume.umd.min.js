!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):t.Perfume=i()}(this,function(){"use strict";var t,i,e,n,s=function(){return+new Date},r="function"==typeof window.requestIdleCallback,o=function(){function t(t){this.initTime_=t}return Object.defineProperty(t.prototype,"didTimeout",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype.timeRemaining=function(){return Math.max(0,50-(s()-this.initTime_))},t}(),a=r?window.requestIdleCallback:function(t){var i=new o(s());return setTimeout(function(){return t(i)},0)},u=r?window.cancelIdleCallback:function(t){clearTimeout(t)},f="function"==typeof Promise&&Promise.toString().indexOf("[native code]")>-1?function(t){Promise.resolve().then(t)}:(t=0,i=[],e=new MutationObserver(function(){i.forEach(function(t){return t()}),i=[]}),n=document.createTextNode(""),e.observe(n,{characterData:!0}),function(e){i.push(e),n.data=String(++t%2)}),c=0,h=!("object"!=typeof window.safari||!window.safari.pushNotification),l=function(){function t(t){var i=void 0===t?{}:t,e=i.ensureTasksRun,n=void 0!==e&&e,s=i.defaultMinTaskTime,r=void 0===s?c:s;this.taskQueue_=[],this.isProcessing_=!1,this.state_=null,this.idleCallbackHandle_=null,this.taskQueue_=[],this.isProcessing_=!1,this.state_=null,this.defaultMinTaskTime_=r,this.ensureTasksRun_=n,this.runTasksImmediately=this.runTasksImmediately.bind(this),this.runTasks_=this.runTasks_.bind(this),this.onVisibilityChange_=this.onVisibilityChange_.bind(this),this.ensureTasksRun_&&(addEventListener("visibilitychange",this.onVisibilityChange_,!0),h&&addEventListener("beforeunload",this.runTasksImmediately,!0))}return t.prototype.pushTask=function(t){this.addTask_(Array.prototype.push,t)},t.prototype.unshiftTask=function(t){this.addTask_(Array.prototype.unshift,t)},t.prototype.runTasksImmediately=function(){this.runTasks_()},t.prototype.hasPendingTasks=function(){return this.taskQueue_.length>0},t.prototype.clearPendingTasks=function(){this.taskQueue_=[],this.cancelScheduledRun_()},t.prototype.getState=function(){return this.state_},t.prototype.destroy=function(){this.taskQueue_=[],this.cancelScheduledRun_(),this.ensureTasksRun_&&(removeEventListener("visibilitychange",this.onVisibilityChange_,!0),h&&removeEventListener("beforeunload",this.runTasksImmediately,!0))},t.prototype.addTask_=function(t,i,e){var n=(void 0===e?{}:e).minTaskTime,r=void 0===n?this.defaultMinTaskTime_:n,o={time:s(),visibilityState:document.visibilityState};t.call(this.taskQueue_,{state:o,task:i,minTaskTime:r}),this.scheduleTasksToRun_()},t.prototype.scheduleTasksToRun_=function(){this.ensureTasksRun_&&"hidden"===document.visibilityState?f(this.runTasks_):this.idleCallbackHandle_||(this.idleCallbackHandle_=a(this.runTasks_))},t.prototype.runTasks_=function(t){if(this.cancelScheduledRun_(),!this.isProcessing_){for(this.isProcessing_=!0;this.hasPendingTasks()&&!p(t,this.taskQueue_[0].minTaskTime);){var i=this.taskQueue_.shift(),e=i.task,n=i.state;this.state_=n,e(n),this.state_=null}this.isProcessing_=!1,this.hasPendingTasks()&&this.scheduleTasksToRun_()}},t.prototype.cancelScheduledRun_=function(){u(this.idleCallbackHandle_),this.idleCallbackHandle_=null},t.prototype.onVisibilityChange_=function(){"hidden"===document.visibilityState&&this.runTasksImmediately()},t}(),p=function(t,i){return!!(t&&t.timeRemaining()<=i)},d=function(){function t(t){this.config=t}return t.prototype.now=function(){return Date.now()/1e3},t.prototype.mark=function(t,i){},t.prototype.measure=function(t,i){return this.getDurationByMetric(t,i)},t.prototype.firstContentfulPaint=function(t){var i=this;setTimeout(function(){t(i.getFirstPaint())})},t.prototype.getDurationByMetric=function(t,i){return i.end-i.start||0},t.prototype.getFirstPaint=function(){var t=window.performance.timing,i={duration:0,entryType:"paint",name:"first-contentful-paint",startTime:0};return t&&0!==t.navigationStart&&(i.startTime=Date.now()-t.navigationStart),[i]},t}();!function(t,i){var e,n,s,r=[],o={passive:!0,capture:!0},a=new Date,u="pointerup",f="pointercancel";function c(t,r){e||(e=r,n=t,s=new Date,p(i),h())}function h(){n>=0&&n<s-a&&(r.forEach(function(t){t(n,e)}),r=[])}function l(e){if(e.cancelable){var n=(e.timeStamp>1e12?new Date:performance.now())-e.timeStamp;"pointerdown"==e.type?function(e,n){function s(){c(e,n),a()}function r(){a()}function a(){i(u,s,o),i(f,r,o)}t(u,s,o),t(f,r,o)}(n,e):c(n,e)}}function p(t){["click","mousedown","keydown","touchstart","pointerdown"].forEach(function(i){t(i,l,o)})}p(t),self.perfMetrics=self.perfMetrics||{},self.perfMetrics.onFirstInputDelay=function(t){r.push(t),h()}}(addEventListener,removeEventListener);var g=function(){function t(t){this.config=t}return t.supported=function(){return window.performance&&!!performance.now&&!!performance.mark},t.supportedPerformanceObserver=function(){return window.chrome&&"PerformanceObserver"in window},t.prototype.now=function(){return window.performance.now()},t.prototype.mark=function(t,i){var e="mark_"+t+"_"+i;window.performance.mark(e)},t.prototype.measure=function(t,i){var e="mark_"+t+"_start",n="mark_"+t+"_end";return window.performance.measure(t,e,n),this.getDurationByMetric(t,i)},t.prototype.firstContentfulPaint=function(t){this.perfObserver=new PerformanceObserver(this.performanceObserverCb.bind(this,t)),this.perfObserver.observe({entryTypes:["paint"]})},t.prototype.getDurationByMetric=function(t,i){var e=this.getMeasurementForGivenName(t);return e&&"measure"===e.entryType?e.duration:-1},t.prototype.getMeasurementForGivenName=function(t){var i=window.performance.getEntriesByName(t);return i[i.length-1]},t.prototype.performanceObserverCb=function(t,i){var e=this,n=i.getEntries();t(n),n.forEach(function(t){e.config.firstContentfulPaint&&"first-contentful-paint"===t.name&&e.perfObserver.disconnect()})},t}();return function(){function t(t){void 0===t&&(t={});var i=this;this.config={firstContentfulPaint:!1,firstPaint:!1,firstInputDelay:!1,googleAnalytics:{enable:!1,timingVar:"name"},logPrefix:"Perfume.js:",logging:!0,maxMeasureTime:18e3,warning:!1,debugging:!1},this.firstPaintDuration=0,this.firstContentfulPaintDuration=0,this.firstInputDelayDuration=0,this.isHidden=!1,this.logMetricWarn="Please provide a metric name",this.metrics=new Map,this.observers=new Map,this.didVisibilityChange=function(){document.hidden&&(i.isHidden=document.hidden)},this.config=Object.assign({},this.config,t),this.perf=g.supported()?new g(this.config):new d(this.config),g.supportedPerformanceObserver()||(this.perfEmulated=new d(this.config)),(this.config.firstPaint||this.config.firstContentfulPaint)&&(this.observeFirstContentfulPaint=new Promise(function(t){i.logDebug("observeFirstContentfulPaint"),i.observers.set("fcp",t),i.initFirstPaint()})),this.config.firstInputDelay&&(this.observeFirstInputDelay=new Promise(function(t){i.observers.set("fid",t),i.initFirstInputDelay()})),this.onVisibilityChange(),this.queue=new l({ensureTasksRun:!0})}return t.prototype.start=function(t){this.checkMetricName(t)&&(this.metrics.has(t)?this.logWarn(this.config.logPrefix,"Recording already started."):(this.metrics.set(t,{end:0,start:this.perf.now()}),this.perf.mark(t,"start"),this.isHidden=!1))},t.prototype.end=function(t){var i=this;if(this.checkMetricName(t)){var e=this.metrics.get(t);if(e){e.end=this.perf.now(),this.perf.mark(t,"end");var n=this.perf.measure(t,e),s=parseFloat(n.toFixed(2));return this.metrics.delete(t),this.queue.pushTask(function(){i.log(t,s),i.sendTiming(t,s)}),s}this.logWarn(this.config.logPrefix,"Recording already stopped.")}},t.prototype.endPaint=function(t){var i=this;return new Promise(function(e){setTimeout(function(){var n=i.end(t);e(n)})})},t.prototype.log=function(t,i){if(!this.isHidden&&this.config.logging)if(t){var e=i.toFixed(2),n="%c "+this.config.logPrefix+" "+t+" "+e+" ms";window.console.log(n,"color: #ff6d00;font-size:11px;")}else this.logWarn(this.config.logPrefix,this.logMetricWarn)},t.prototype.logDebug=function(t,i){void 0===i&&(i=""),this.config.debugging&&window.console.log("Perfume.js debugging "+t+":",i)},t.prototype.sendTiming=function(t,i){if(!this.isHidden&&(this.config.analyticsTracker&&this.config.analyticsTracker(t,i),this.config.googleAnalytics.enable))if(window.ga){var e=Math.round(i);window.ga("send","timing",t,this.config.googleAnalytics.timingVar,e)}else this.logWarn(this.config.logPrefix,"Google Analytics has not been loaded")},t.prototype.checkMetricName=function(t){return!!t||(this.logWarn(this.config.logPrefix,this.logMetricWarn),!1)},t.prototype.firstContentfulPaintCb=function(t){var i=this;this.logDebug("firstContentfulPaintCb",t),t.forEach(function(t){i.queue.pushTask(function(){i.config.firstPaint&&"first-paint"===t.name&&i.logMetric(t.startTime,"First Paint","firstPaint"),i.config.firstContentfulPaint&&"first-contentful-paint"===t.name&&i.logMetric(t.startTime,"First Contentful Paint","firstContentfulPaint")})})},t.prototype.initFirstPaint=function(){this.logDebug("initFirstPaint"),g.supportedPerformanceObserver()?(this.logDebug("initFirstPaint.supportedPerformanceObserver"),this.perf.firstContentfulPaint(this.firstContentfulPaintCb.bind(this))):this.perfEmulated&&(this.logDebug("initFirstPaint.perfEmulated"),this.perfEmulated.firstContentfulPaint(this.firstContentfulPaintCb.bind(this)))},t.prototype.initFirstInputDelay=function(){var t=this;g.supported()&&this.config.firstInputDelay&&perfMetrics.onFirstInputDelay(function(i,e){t.queue.pushTask(function(){t.logMetric(i,"First Input Delay","firstInputDelay")})})},t.prototype.onVisibilityChange=function(){void 0!==document.hidden&&document.addEventListener("visibilitychange",this.didVisibilityChange)},t.prototype.logMetric=function(t,i,e){var n=parseFloat(t.toFixed(2));n>this.config.maxMeasureTime||("firstPaint"===e&&(this.firstPaintDuration=n),"firstContentfulPaint"===e&&(this.firstContentfulPaintDuration=n,this.observers.get("fcp")(n)),"firstInputDelay"===e&&(this.firstInputDelayDuration=n,this.observers.get("fid")(n)),this.log(i,n),this.sendTiming(e,n))},t.prototype.logWarn=function(t,i){this.config.warning&&this.config.logging&&window.console.warn(t,i)},t}()});
//# sourceMappingURL=perfume.umd.min.js.map
