/*! Greater Media Prototype - v0.1.0 - 2014-10-07
 * http://wordpress.org/themes
 * Copyright (c) 2014; * Licensed GPLv2+ */
(function(i){var t=function(t){this.sessionData=t,this.authorized=!1,this.willRegister=!1,this.mediator=i({}),gigya.accounts.addEventHandlers({onLogin:i.proxy(this.didLogin,this),onLogout:i.proxy(this.didLogout,this)})};t.prototype={get_cid:function(){return this.sessionData.cid||""},isAuthorized:function(){return this.authorized},authorize:function(){var t=this.get_cid();""!==t?gigya.accounts.getAccountInfo({cid:t,callback:i.proxy(this.gotAccountInfo,this)}):this.notify()},gotAccountInfo:function(i){0===i.errorCode?(this.authorized=!0,this.account=i):this.authorized=!1,this.notify()},on:function(i,t){this.mediator.on(i,t)},notify:function(i){i||(i="change"),this.mediator.trigger(i,this)},didLogin:function(i){this.willRegister&&this.didRegister(i),this.account=i,this.authorized=!0,this.notify()},didRegister:function(t){this.willRegister=!1;var e=[];t.data.vipGroup&&e.push("VIP Newsletter"),t.data.birthdayGreetingsGroup&&e.push("Birthday Greetings"),t.data.bigFrigginDealGroup&&e.push("Big Deal");var s={action:"register_account",action_data:JSON.stringify({UID:t.UID,listNames:e})},o=this.sessionData.ajaxurl+"?"+i.param({register_account_nonce:this.sessionData.register_account_nonce}),n=i.post(o,s);n.then(i.proxy(this.didRegisterRelay,this)).fail(i.proxy(this.didRegisterRelayError,this))},didRegisterRelay:function(){location.reload()},didRegisterRelayError:function(i){console.log("didRegisterRelayError",i)},didLogout:function(){this.authorized=!1,this.notify()}};var e=function(t){this.session=t,this.session.on("change",i.proxy(this.didSessionChange,this)),this.container=i(".account"),this.container.on("click",i.proxy(this.didContainerClick,this))};e.prototype={render:function(){var t=this.session.isAuthorized();i(".login").css("visibility","visible"),i(".register").css("visibility",t?"hidden":"visible"),t?i(".login").text("Logout"):i(".login").text("Login")},didContainerClick:function(t){var e=i(t.target).attr("class");switch(e){case"register":return this.showRegisterScreen(),!1;case"login":return this.session.isAuthorized()?this.showLogoutScreen():this.showLoginScreen(),!1}},didSessionChange:function(){this.render()},showScreenSet:function(i){gigya.accounts.showScreenSet({screenSet:"GMR-RegistrationLogin",startScreen:i})},showLoginScreen:function(){this.showScreenSet("gigya-login-screen")},showRegisterScreen:function(){this.session.willRegister=!0,this.showScreenSet("gigya-register-screen")},showLogoutScreen:function(){gigya.accounts.logout({cid:this.session.get_cid(),callback:i.proxy(this.refresh,this)})},refresh:function(){location.reload()}},i(document).ready(function(){var i=window.gigya_session_data||{data:{}};i=i.data;var s=new t(i);new e(s),s.authorize()})})(jQuery);