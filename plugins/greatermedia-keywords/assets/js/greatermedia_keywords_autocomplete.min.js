/*! GreaterMedia Keywords - v0.0.1
 * http://wordpress.org/plugins
 * Copyright (c) 2015; * Licensed GPLv2+ */
jQuery(function(e){"use strict";function t(e){this.keywords=e,this.last_search=""}function i(e,t,i,n){function a(){e.find(".is-highlighted").removeClass("is-highlighted"),e.children().eq(r.position).addClass("is-highlighted")}function s(){(null===r.position||e.children().length!==r.stack_size)&&(r.position=e.children().length+1,r.stack_size=e.children().length),0===r.position?r.position=e.children().length-1:r.position--,a()}function o(){(null===r.position||e.children().length!==r.stack_size)&&(r.position=-1,r.stack_size=e.children().length),r.position===e.children().length-1?r.position=0:r.position++,a()}var r=this;r.$items=e,r.$context=t,r.position_change_callback=i,r.cancel_callback=n,r.is_navigating=!1,r.position=null,r.stack_size=e.children().length,t.keydown(function(e){38===e.which||40===e.which?(r.is_navigating=!0,r.$items.addClass("is-navigating").removeClass("is-hoverable"),e.preventDefault(),e.stopPropagation(),38===e.which?s():o(),r.position_change_callback&&r.position_change_callback(r.position)):27===e.which&&r.is_navigating?(r.$items.removeClass("is-navigating").addClass("is-hoverable"),r.cancel(),e.preventDefault(),e.stopPropagation()):(r.$items.removeClass("is-navigating").addClass("is-hoverable"),r.is_navigating=!1)}),e.find("is-highlighted").removeClass("is-highlighted"),e.addClass("is-hoverable")}function n(){var t=r.search(c.val());return t&&t.length?(t=t.slice(0,o),p.html(t.length>1?t.length+" keyword matches found":"1 keyword match found"),u.empty(),_.each(t,function(t){var i=e(l(t));i.data("keyword",t.keyword),u.append(i)}),d.show(),void 0):(d.hide(),void 0)}function a(e){c.val(u.children().eq(e).data("keyword"))}function s(){c.val(r.last_search)}t.prototype.search=function(e){if(this.last_search=e,e=this.normalize_search_term(e),!e.length)return[];var t=this,i=_.filter(this.keywords,function(i){return 0===t.normalize_search_term(i.keyword).indexOf(t.normalize_search_term(e))});return i},t.prototype.normalize_search_term=function(t){return e.trim(t).toLowerCase().replace(/[^a-z0-9]+/g,"")},i.prototype.cancel=function(){this.is_navigating=!1,this.position=null,this.cancel_callback&&this.cancel_callback()};var o=6,r=new t(GMRKeywords),c=e("#header-search"),l=_.template(e("#keyword-search-item-template").html()),h=_.template(e("#keyword-search-body-template").html()),d=e("#keyword-search-container");d.hide(),d.append(e(h()));var p=d.find(".keyword-search__header"),u=d.find(".keyword-search__items");d.find(".keyword-search__btn").click(function(){e("#header-search").parent("form").submit()});var g=new i(u,e(document),a,s);c.on("keyup",function(){g.is_navigating||n()}),c.one("focus",function(){n()})});