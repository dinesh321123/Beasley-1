/*! GreaterMedia Keywords - v0.0.1
 * http://wordpress.org/plugins
 * Copyright (c) 2015; * Licensed GPLv2+ */
jQuery(function(e){"use strict";function t(e){this.keywords=e,this.last_search=""}function i(t,i,n,a){function s(){t.find(".is-highlighted").removeClass("is-highlighted"),t.children().eq(c.position).addClass("is-highlighted")}function o(){l(),(null===c.position||t.children().length!==c.stack_size)&&(c.position=t.children().length,c.stack_size=t.children().length),0===c.position?c.position=t.children().length-1:c.position--,s()}function r(){l(),(null===c.position||t.children().length!==c.stack_size)&&(c.position=-1,c.stack_size=t.children().length),c.position===t.children().length-1?c.position=0:c.position++,s()}function l(){c.$last_hovered_item&&(c.position=c.$last_hovered_item.index(),c.$last_hovered_item=null)}var c=this;c.$items=t,c.$context=i,c.position_change_callback=n,c.cancel_callback=a,c.is_navigating=!1,c.position=null,c.stack_size=t.children().length,c.$last_hovered_item=null,i.keydown(function(e){38===e.which||40===e.which?(c.is_navigating=!0,c.$items.addClass("is-navigating").removeClass("is-hoverable"),e.preventDefault(),e.stopPropagation(),38===e.which?o():r(),c.position_change_callback&&c.position_change_callback(c.position)):27===e.which&&c.is_navigating?(c.$items.removeClass("is-navigating").addClass("is-hoverable"),c.cancel(),e.preventDefault(),e.stopPropagation()):(c.$items.removeClass("is-navigating").addClass("is-hoverable"),c.is_navigating=!1)}),t.on("mouseover","> *",function(){c.$items.addClass("is-hoverable"),c.$items.find(".is-highlighted").removeClass("is-highlighted"),c.$last_hovered_item=e(this)}),t.find(".is-highlighted").removeClass("is-highlighted"),t.addClass("is-hoverable")}function n(){var t=r.search(l.val());return t&&t.length?(t=t.slice(0,o),p.html(t.length>1?t.length+" keyword matches found":"1 keyword match found"),g.empty(),_.each(t,function(t){var i=e(h(t));i.data("keyword",t.keyword),g.append(i)}),u.show(),void 0):(u.hide(),void 0)}function a(e){l.val(g.children().eq(e).data("keyword"))}function s(){l.val(r.last_search)}t.prototype.search=function(e){if(this.last_search=e,e=this.normalize_search_term(e),!e.length)return[];var t=this,i=_.filter(this.keywords,function(i){return 0===t.normalize_search_term(i.keyword).indexOf(t.normalize_search_term(e))});return i},t.prototype.normalize_search_term=function(t){return e.trim(t).toLowerCase().replace(/[^a-z0-9]+/g,"")},i.prototype.cancel=function(){this.is_navigating=!1,this.position=null,this.$last_hovered_item=null,this.cancel_callback&&this.cancel_callback()};var o=6,r=new t(GMRKeywords),l=e("#header-search"),c=function(e){var t=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;return e.replace(t,"")},h=_.template(c(e("#keyword-search-item-template").html())),d=_.template(c(e("#keyword-search-body-template").html())),u=e("#keyword-search-container");u.hide(),u.append(e(d()));var p=u.find(".keyword-search__header"),g=u.find(".keyword-search__items");u.find(".keyword-search__btn").click(function(){e("#header-search").parent("form").submit()});var m=new i(g,e(document),a,s);l.on("keyup",function(){m.is_navigating||n()}),l.one("focus",function(){n()})});