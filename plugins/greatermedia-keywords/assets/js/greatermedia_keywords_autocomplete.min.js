/*! GreaterMedia Keywords - v0.0.1
 * http://wordpress.org/plugins
 * Copyright (c) 2015; * Licensed GPLv2+ */
jQuery(function(a){"use strict";function b(a){this.keywords=a,this.last_search=""}function c(b,c,d,e){function f(){b.find(".is-highlighted").removeClass("is-highlighted"),b.children().eq(j.position).addClass("is-highlighted")}function g(){i(),(null===j.position||b.children().length!==j.stack_size)&&(j.position=b.children().length,j.stack_size=b.children().length),0===j.position?j.position=b.children().length-1:j.position--,f()}function h(){i(),(null===j.position||b.children().length!==j.stack_size)&&(j.position=-1,j.stack_size=b.children().length),j.position===b.children().length-1?j.position=0:j.position++,f()}function i(){j.$last_hovered_item&&(j.position=j.$last_hovered_item.index(),j.$last_hovered_item=null)}var j=this;j.$items=b,j.$context=c,j.position_change_callback=d,j.cancel_callback=e,j.is_navigating=!1,j.position=null,j.stack_size=b.children().length,j.$last_hovered_item=null,c.keydown(function(a){38===a.which||40===a.which?(j.is_navigating=!0,j.$items.addClass("is-navigating").removeClass("is-hoverable"),a.preventDefault(),a.stopPropagation(),38===a.which?g():h(),j.position_change_callback&&j.position_change_callback(j.position)):27===a.which&&j.is_navigating?(j.$items.removeClass("is-navigating").addClass("is-hoverable"),j.cancel(),a.preventDefault(),a.stopPropagation()):(j.$items.removeClass("is-navigating").addClass("is-hoverable"),j.is_navigating=!1)}),b.on("mouseover","> *",function(b){j.$items.addClass("is-hoverable"),j.$items.find(".is-highlighted").removeClass("is-highlighted"),j.$last_hovered_item=a(this)}),b.find(".is-highlighted").removeClass("is-highlighted"),b.addClass("is-hoverable")}function d(){var b=h.search(i.val());return b&&b.length?(b=b.slice(0,g),n.html(b.length>1?b.length+" keyword matches found":"1 keyword match found"),o.empty(),_.each(b,function(b){var c=a(k(b));c.data("keyword",b.keyword),o.append(c)}),void m.show()):void m.hide()}function e(a){i.val(o.children().eq(a).data("keyword"))}function f(){i.val(h.last_search)}b.prototype.search=function(a){if(this.last_search=a,a=this.normalize_search_term(a),!a.length)return[];var b=this,c=_.filter(this.keywords,function(c){return 0===b.normalize_search_term(c.keyword).indexOf(b.normalize_search_term(a))});return c},b.prototype.normalize_search_term=function(b){return a.trim(b).toLowerCase().replace(/[^a-z0-9]+/g,"")},c.prototype.cancel=function(){this.is_navigating=!1,this.position=null,this.$last_hovered_item=null,this.cancel_callback&&this.cancel_callback()};var g=6,h=new b(GMRKeywords),i=a("#header-search"),j=function(a){var b=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;return a.replace(b,"")},k=_.template(j(a("#keyword-search-item-template").html())),l=_.template(j(a("#keyword-search-body-template").html())),m=a("#keyword-search-container");m.hide(),m.append(a(l()));var n=m.find(".keyword-search__header"),o=m.find(".keyword-search__items");m.find(".keyword-search__btn").click(function(){a("#header-search").parent("form").submit()});var p=new c(o,a(document),e,f);i.on("keyup",function(){p.is_navigating||d()}),i.one("focus",function(){d()})});