this.JST=this.JST||{},this.JST["src/templates/test.html"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+="<h1>Hello</h1>\n";return __p};var escapeValue=function(a){return"string"==typeof a&&(a=a.replace(/"/g,"C_DOUBLE_QUOTE"),a=a.replace(/'/g,"C_SINGLE_QUOTE"),a=a.replace(/\\/g,"C_BACKSLASH")),a},unescapeValue=function(a){return"string"==typeof a&&(a=a.replace(/C_DOUBLE_QUOTE/g,'"'),a=a.replace(/C_SINGLE_QUOTE/g,"'"),a=a.replace(/C_BACKSLASH/g,"\\")),a},Constraint=function(a){if(this.id=Constraint.nextID(),a)for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b])};Constraint.idCounter=0,Constraint.nextID=function(){return Constraint.idCounter++},Constraint.prototype={fromJSON:function(a){this.type=a.type,this.title=a.title,this.fieldPath=a.fieldPath,this.value=unescapeValue(a.value),this.valueType=a.valueType,this.operator=a.operator,this.conjunction=a.conjunction},toJSON:function(){var a={};return a.type=this.type,a.title=this.title,a.value=escapeValue(this.value),a.valueType=this.valueType,a.conjunction=this.conjunction,a.fieldPath=this.fieldPath,a.operator=this.operator,a},toGQL:function(){var a=this.fieldPath+" "+this.operator+" ";return a+="string"===this.valueType?"'"+escapeValue(this.value)+"'":this.value},clone:function(){var a=new Constraint;return a.fromJSON(this.toJSON()),a},getOperators:function(){var a=[];return"string"===this.valueType?a.push.apply(a,["contains","not contains"]):"number"===this.valueType&&a.push.apply(a,[">",">=","<","<="]),a.push.apply(a,["=","!="]),a}};var ConstraintStore=function(){this.mediator=$({}),this.available=this.getAvailableConstraints(),this.current=this.getCurrentConstraints()};ConstraintStore.prototype={getAvailableConstraints:function(){var a=[];return a.push(new Constraint({type:"influence_rank",title:"Influence Rank",fieldPath:"iRank",value:1,valueType:"number",operator:">",conjunction:"and"})),a.push(new Constraint({type:"membership_start_date",title:"Membership Start Date",fieldPath:"registeredTimestamp",value:1347872653,valueType:"number",operator:">",conjunction:"and"})),a.push(new Constraint({type:"profile_location",title:"Profile Location City",fieldPath:"profile.city",value:"",valueType:"string",operator:"contains",conjunction:"and"})),a.push(new Constraint({type:"profile_location",title:"Profile Location State",fieldPath:"profile.state",value:"",valueType:"string",operator:"contains",conjunction:"and"})),a.push(new Constraint({type:"listening_loyalty",title:"Listening Loyalty",fieldPath:"data.listeningLoyalty",value:"Only this station",valueType:"string",operator:"contains",conjunction:"and"})),a.push(new Constraint({type:"listening_frequency",title:"Listening Frequency",fieldPath:"data.listeningFrequency",value:"Once per day",valueType:"string",operator:"contains",conjunction:"and"})),a.push(new Constraint({type:"participation_in_survey",title:"Participation in Survey",fieldPath:"data.surveys.name",value:"",valueType:"string",operator:"contains",conjunction:"and"})),a.push(new Constraint({type:"survey_question",title:"Survey Question",fieldPath:"data.surveys.entries.questions.question",value:"",valueType:"string",operator:"contains",conjunction:"and"})),a.push(new Constraint({type:"survey_question_response",title:"Survey Question Response",fieldPath:"data.surveys.entries.questions.answers",value:"",valueType:"string",operator:"contains",conjunction:"and"})),a.push(new Constraint({type:"contest_name",title:"Participation in Contest",fieldPath:"data.contests.name",value:"Favorite Band",valueType:"string",operator:"contains",conjunction:"and"})),a},getCurrentConstraints:function(){var a,b,c,d=member_query_data.constraints||[],e=[],f=d.length;for(a=0;f>a;a++)b=d[a],c=new Constraint,c.fromJSON(b),e.push(c);return e},fromJSON:function(a){this.current=[];var b,c,d,e=a.length;for(b=0;e>b;b++)c=a[b],d=new Constraint,d.fromJSON(c),this.current.push(d);this.notify()},toJSON:function(){var a,b,c=this.current.length,d=[];for(a=0;c>a;a++)b=this.current[a],d.push(b.toJSON());return d},toGQL:function(){var a=this.current.length;if(0===a)return"";var b,c,d,e="select * from accounts where ";for(b=0;a>b;b++)c=this.current[b],d&&(e+=" "+d.conjunction),e+=" "+c.toGQL(),d=c;return e},add:function(a){var b=this.indexOf(a,this.available),c=this.available[b];c=c.clone(),this.current.push(c),this.notify()},copy:function(a){var b=this.indexOf(a),c=this.current[b],d=c.clone();this.current.splice(b,0,d),this.notify()},remove:function(a){{var b=this.indexOf(a),c=this.current[b];c.clone()}this.current.splice(b,1),this.notify()},update:function(a,b,c){var d=this.indexOf(a),e=this.current[d];e[b]=c,this.notify("updateField")},indexOf:function(a,b){b||(b=this.current);var c,d,e=b.length;for(c=0;e>c;c++)if(d=b[c],d.id===a)return c;return-1},on:function(a,b){this.mediator.on(a,b)},notify:function(a){a||(a="change"),this.mediator.trigger(a,this)}};var MemberQueryUpdater=function(a){this.store=a,this.store.on("change",$.proxy(this.didStoreChange,this)),this.store.on("updateField",$.proxy(this.didUpdateField,this))};MemberQueryUpdater.prototype={didStoreChange:function(){this.update()},didUpdateField:function(){this.update()},update:function(){var a=JSON.stringify(this.store.toJSON()),b=this.store.toGQL(),c=$.trim($(".direct-query-input").val());return""!==c&&(b=c),$("#constraints").attr("value",a),$("#query").attr("value",b),b}};var MenuView=function(a){this.store=a,this.container=$(".constraints-menu"),this.container.on("click",$.proxy(this.didItemClick,this)),this.render()};MenuView.prototype={didItemClick:function(a){var b=$(a.target).attr("data-id");b&&this.addConstraint(parseInt(b,10)),a.preventDefault()},addConstraint:function(a){this.store.add(a)},render:function(){var a,b,c,d=this.store.available,e=d.length;for(a=0;e>a;a++)b=d[a],item=$("<li></li>"),c=$('<a href="#"/>').attr("data-id",a).attr("title","Click to add").text(b.title),c.appendTo(item),this.container.append(item)}};var ConstraintListView=function(a){this.store=a,this.container=$(".current-constraints"),this.store.on("change",$.proxy(this.didStoreChange,this)),this.container.on("click",$.proxy(this.didItemClick,this)),this.container.on("change",$.proxy(this.didItemChange,this)),this.render()};ConstraintListView.prototype={didItemClick:function(a){var b=$(a.target),c=b.attr("data-id");c&&(c=parseInt(c,10)),b.hasClass("remove-constraint")?this.removeConstraint(c):b.hasClass("copy-constraint")&&this.copyConstraint(c),a.preventDefault()},didItemChange:function(a){var b,c=$(a.target),d=c.attr("data-id");d&&(d=parseInt(d,10)),c.hasClass("constraint-operator")?b="operator":c.hasClass("constraint-conjunction")?b="conjunction":c.hasClass("constraint-value")&&(b="value"),b&&this.updateConstraint(d,b,c.val())},didStoreChange:function(){this.render()},copyConstraint:function(a){this.store.copy(a)},removeConstraint:function(a){this.store.remove(a)},updateConstraint:function(a,b,c){this.store.update(a,b,c)},render:function(){this.container.empty();var a,b,c,d=this.store.current,e=d.length;for(a=0;e>a;a++)b=d[a],c=this.listItemForConstraint(b),this.container.append(c);0===e&&this.container.append(this.emptyListItem())},listItemForConstraint:function(a){var b=$("<li></li>").append(this.toolbarForConstraint(a)).append($("<p></p>",{"class":"constraint-title"}).text(a.title)).append(this.selectForOperator(a)).append(this.inputForConstraint(a)).append(this.selectForConjunction(a));return b},emptyListItem:function(){var a=$("<li></li>").append($("<p></p>",{"class":"constraint-empty"}).text("Click to add filters"));return a},toolbarForConstraint:function(a){var b,c,d=$("<ul></ul>").attr("class","constraint-toolbar");return b=$("<li></li>"),c=$("<a></a>",{"data-id":a.id,alt:"f105","class":"dashicons dashicons-admin-page copy-constraint",href:"#",title:"Duplicate"}),b.append(c),d.append(b),b=$("<li></li>"),c=$("<a></a>",{"data-id":a.id,alt:"f105","class":"dashicons dashicons-trash remove-constraint",href:"#",title:"Remove"}),b.append(c),d.append(b),d},inputForConstraint:function(a){var b=$("<input />",{"data-id":a.id,type:"text",value:a.value,"class":"constraint-value"});return b},selectForConjunction:function(a){var b,c,d,e,f=a.conjunction,g=$("<select />",{"data-id":a.id,"class":"constraint-conjunction"}),h=["and","or"],i=h.length;for(b=0;i>b;b++)c=h[b],d=c,e=$("<option></option>",{value:c}).text(d),f===c&&e.prop("selected",!0),g.append(e);return g},operators:{"=":"equals","!=":"not equals",">":"greater than",">=":"greater than or equal to","<":"less than","<=":"less than or equal to"},selectForOperator:function(a){var b,c,d,e,f=a.valueType,g=a.operator,h=$("<select />",{"data-id":a.id,"class":"constraint-operator"}),i=this.operatorsFor(f),j=i.length;for(b=0;j>b;b++)c=i[b],d=this.operatorLabelFor(c),e=$("<option></option>",{value:c}).text(d),g===c&&e.prop("selected",!0),h.append(e);return h},operatorLabelFor:function(a){return this.operators.hasOwnProperty(a)?this.operators[a]:a},operatorsFor:function(a){var b=["=","!="];return"number"===a?b.push.apply(b,[">",">=","<","<="]):"string"===a&&b.push.apply(b,["contains","not contains"]),b}};var PreviewView=function(a){this.queryUpdater=a,this.container=$(".member-query-results"),this.previewButton=$(".preview-member-query-button"),this.previewButton.on("click",$.proxy(this.didPreviewButtonClick,this))};PreviewView.prototype={didPreviewButtonClick:function(a){var b=this.queryUpdater.update();this.preview(b),a.preventDefault()},preview:function(a){if(""===a)return void this.setStatus("Nothing to Preview, please add some filters.");var b=member_query_meta.preview_nonce,c={action:"preview_member_query",action_data:JSON.stringify({query:a})},d=member_query_meta.ajaxurl+"?"+$.param({preview_member_query_nonce:b});this.setStatus("Searching, Please wait ...");var e=$.post(d,c);e.then($.proxy(this.didPreviewSuccess,this)).fail($.proxy(this.didPreviewError,this))},didPreviewSuccess:function(a){var b=a.data.accounts,c=a.data.total,d=c+" records found";d+=c>0?", showing the first 5":".",this.setStatus(d),this.render(b)},didPreviewError:function(a){this.setStatus("Failed to query records: "+a.responseJSON.data)},render:function(a){this.container.empty();var b,c,d=a.length;for(b=0;d>b;b++)c=a[b],this.container.append(this.rowForAccount(c,b))},rowForAccount:function(a,b){var c,d=$("<tr></tr>",{"class":b%2?"alternate":""}),e=$("<td></td>");return c=$('<a href="#"></a>').text(a),c.attr({"class":"open-member-page-text"}),e.append(c),c=$('<a href="#"></a>'),c.attr({alt:"f105","class":"dashicons dashicons-external open-member-page"}),e.append(c),d.append(e),d},setStatus:function(a){var b=$(".count-status");b.text(a)}};var $=jQuery,QueryBuilderApp=function(){$(document).ready($.proxy(this.initialize,this))};QueryBuilderApp.prototype={initialize:function(){this.store=new ConstraintStore,this.menuView=new MenuView(this.store),this.listView=new ConstraintListView(this.store),this.queryUpdater=new MemberQueryUpdater(this.store),this.previewView=new PreviewView(this.queryUpdater),this.previewView.preview(member_query_data.query),this.queryUpdater.update()}};var app=new QueryBuilderApp;