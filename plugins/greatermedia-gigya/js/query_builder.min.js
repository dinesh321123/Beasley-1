var escapeValue=function(a){return"string"==typeof a&&(a=a.replace(/"/g,"C_DOUBLE_QUOTE"),a=a.replace(/'/g,"C_SINGLE_QUOTE"),a=a.replace(/\\/g,"C_BACKSLASH")),a},unescapeValue=function(a){return"string"==typeof a&&(a=a.replace(/C_DOUBLE_QUOTE/g,'"'),a=a.replace(/C_SINGLE_QUOTE/g,"'"),a=a.replace(/C_BACKSLASH/g,"\\")),a},getTemplate=function(a){return window.JST["src/templates/"+a+".jst"]},renderTemplate=function(a,b,c){c||(c={});var d=getTemplate(a),e=d(b);return $(e)};"function"!=typeof Object.create&&(Object.create=function(){var a=function(){};return function(b){if(arguments.length>1)throw Error("Second argument not supported");if("object"!=typeof b)throw TypeError("Argument must be an object");a.prototype=b;var c=new a;return a.prototype=null,c}}()),this.JST=this.JST||{},this.JST["src/templates/constraint.jst"]=function(obj){obj||(obj={});{var __t,__p="",__e=_.escape;Array.prototype.join}with(obj)__p+='<ul class="constraint-toolbar">\n	<li>\n		<a\n			alt="f105"\n			class="dashicons dashicons-admin-page copy-constraint"\n			href="#"\n			title="Duplicate"\n		/>\n\n		<a\n			alt="f105"\n			class="dashicons dashicons-trash remove-constraint"\n			href="#"\n			title="Remove"\n		/>\n	</li>\n</ul>\n\n<p class="constraint-title">\n	'+__e(title)+'\n</p>\n\n<select class="constraint-operator" style="width: 35%">\n	',_.each(view.operatorsFor(valueType,type),function(a){__p+='\n	<option value="'+__e(a)+'" '+(null==(__t=a===operator?'selected="selected"':"")?"":__t)+'">\n	'+__e(a)+"\n	</option>\n	"}),__p+="\n</select>\n\n",view.hasChoices()?(__p+='\n	<select class="constraint-value" style="width: 45%">\n		',_.each(choices,function(a){__p+='\n		<option value="'+__e(a.value)+'" '+(null==(__t=a.value==value?'selected="selected"':"")?"":__t)+'">\n		'+__e(a.label)+"\n		</option>\n		"}),__p+="\n	</select>\n"):__p+="integer"===valueType||"float"===valueType?'\n	<input type="number" class="constraint-value constraint-value-text" value="'+__e(value)+'" />\n':'\n	<input type="text" class="constraint-value constraint-value-text" value="'+__e(value)+'" />\n',__p+='\n\n<select class="constraint-conjunction" style="width: 15%">\n	',_.each(view.conjunctions,function(a){__p+='\n	<option value="'+__e(a)+'" '+(null==(__t=a===conjunction?'selected="selected"':"")?"":__t)+'">\n	'+__e(a)+"\n	</option>\n	"}),__p+="\n</select>\n";return __p},this.JST["src/templates/constraint_item.jst"]=function(obj){obj||(obj={});{var __t,__p="",__e=_.escape;Array.prototype.join}with(obj)__p+='<li>\n	<ul class="constraint-toolbar">\n		<li>\n			<a\n				data-id="'+__e(constraint.id)+'"\n				alt="f105"\n				class="dashicons dashicons-admin-page copy-constraint"\n				href="#"\n				title="Duplicate"\n			/>\n\n			<a\n				data-id="'+__e(constraint.id)+'"\n				alt="f105"\n				class="dashicons dashicons-trash remove-constraint"\n				href="#"\n				title="Remove"\n			/>\n		</li>\n	</ul>\n\n	<p class="constraint-title">\n		'+__e(constraint.title)+'\n	</p>\n\n	<select data-id="'+__e(constraint.id)+'" class="constraint-operator">\n		',_.each(view.operatorsFor(constraint.valueType),function(a){__p+='\n		<option value="'+__e(a)+'" '+(null==(__t=constraint.operator===a?'selected="selected"':"")?"":__t)+'">\n		'+__e(view.operatorLabelFor(a))+"\n		</option>\n		"}),__p+='\n	</select>\n\n	<input\n		type="text"\n		class="constraint-value"\n		data-id="'+__e(constraint.id)+'"\n		value="'+__e(constraint.value)+'" />\n\n	<select data-id="'+__e(constraint.id)+'" class="constraint-conjunction">\n		',_.each(view.conjunctions,function(a){__p+='\n		<option value="'+__e(a)+'" '+(null==(__t=constraint.conjunction===a?'selected="selected"':"")?"":__t)+'">\n		'+__e(a)+"\n		</option>\n		"}),__p+="\n	</select>\n</li>\n";return __p},this.JST["src/templates/empty_constraints.jst"]=function(obj){obj||(obj={});{var __p="";_.escape}with(obj)__p+='<p class="constraint-empty">Click to add filters</p>\n';return __p},this.JST["src/templates/entry_answer.jst"]=function(obj){obj||(obj={});{var __t,__p="",__e=_.escape;Array.prototype.join}with(obj)__p+='<label><strong>Select Answer: </strong></label>\n<select class="constraint-operator" style="width: 35%">\n	',_.each(view.operatorsFor(valueType),function(a){__p+='\n	<option value="'+__e(a)+'" '+(null==(__t=a===operator?'selected="selected"':"")?"":__t)+'">\n	'+__e(a)+"\n	</option>\n	"}),__p+="\n</select>\n\n",view.hasChoices()?(__p+='\n	<select class="constraint-value" style="width: 45%">\n		',_.each(choices,function(a){__p+='\n		<option value="'+__e(a.value)+'" '+(null==(__t=a.value==currentChoice?'selected="selected"':"")?"":__t)+'">\n		'+__e(a.label)+"\n		</option>\n		"}),__p+="\n	</select>\n"):__p+="number"===fieldType||"price"===fieldType?'\n	<input type="number" class="constraint-value constraint-value-text"\n	value="'+__e(value)+'" min="'+__e(fieldOptions.min)+'" max="'+__e(fieldOptions.max)+'" />\n':'\n	<input type="text" class="constraint-value constraint-value-text" value="'+__e(value)+'" />\n',__p+='\n\n<select class="constraint-conjunction" style="width: 15%">\n	',_.each(view.conjunctions,function(a){__p+='\n	<option value="'+__e(a)+'" '+(null==(__t=a===conjunction?'selected="selected"':"")?"":__t)+'">\n	'+__e(a)+"\n	</option>\n	"}),__p+="\n</select>\n";return __p},this.JST["src/templates/entry_constraint.jst"]=function(obj){obj||(obj={});var __p="",__e=_.escape;with(obj)__p+='<ul class="constraint-toolbar">\n	<li>\n		<a\n			alt="f105"\n			class="dashicons dashicons-admin-page copy-constraint"\n			href="#"\n			title="Duplicate"\n		/>\n\n		<a\n			alt="f105"\n			class="dashicons dashicons-trash remove-constraint"\n			href="#"\n			title="Remove"\n		/>\n	</li>\n</ul>\n\n<p class="constraint-title">\n	'+__e(title)+'\n</p>\n\n<div class="entry-select-group">\n	<label><strong>Select Contest: </strong></label>\n	<select class="entry-select-choice entry-select-type">\n	</select>\n</div>\n\n<div class="entry-select-group">\n	<label><strong>Select Question: </strong></label>\n	<select class="entry-select-choice entry-select-field">\n	</select>\n</div>\n\n<div class="entry-answer-group">\n	<label><strong>Loading ... </strong></label>\n</div>\n';return __p},this.JST["src/templates/entry_select.jst"]=function(obj){obj||(obj={});{var __t,__p="",__e=_.escape;Array.prototype.join}with(obj)_.each(choices,function(a){__p+='\n	<option value="'+__e(a.value)+'" '+(null==(__t=a.value==currentChoice?'selected="selected"':"")?"":__t)+'">\n	'+__e(a.label)+"\n	</option>\n"}),__p+="\n";return __p},this.JST["src/templates/export.jst"]=function(obj){obj||(obj={});{var __p="",__e=_.escape;Array.prototype.join}with(obj)__p+='<div id="misc-publishing-actions" style="margin-bottom: 0.5em;">\n\n	<div class="misc-pub-section misc-pub-post-status">\n		<label for="post_status">Status:</label>\n		<span id="post-status-display">'+__e(statusText)+'</span>\n	</div>\n\n	<div class="misc-pub-section curtime misc-pub-curtime">\n		<span id="visibility"> View MyEmma Segment:\n			',__p+=emailSegmentID?'\n				<a href="'+__e(emailSegmentURL)+'" target="_blank">\n					<b>'+__e(emailSegmentID)+"</b>\n				</a>\n			":"\n					<b>N/A</b>\n			",__p+='\n		</span>\n	</div>\n\n	<div class="misc-pub-section curtime misc-pub-curtime" style="padding-bottom: 1em;">\n		<span id="timestamp"> Last Export: <b>'+__e(lastExport)+"</b></span>\n	</div>\n\n</div>\n";return __p},this.JST["src/templates/favorite_constraint.jst"]=function(obj){obj||(obj={});{var __t,__p="",__e=_.escape;Array.prototype.join}with(obj)__p+='<ul class="constraint-toolbar">\n	<li>\n		<a\n			alt="f105"\n			class="dashicons dashicons-admin-page copy-constraint"\n			href="#"\n			title="Duplicate"\n		/>\n\n		<a\n			alt="f105"\n			class="dashicons dashicons-trash remove-constraint"\n			href="#"\n			title="Remove"\n		/>\n	</li>\n</ul>\n\n<p class="constraint-title">\n	'+__e(title)+'\n</p>\n\n<div class="entry-select-group">\n	<label><strong>Favorite Type: </strong></label>\n	<select class="favorite-type" style="width: 100%">\n		',_.each(favoriteTypes,function(a){__p+='\n		<option value="'+__e(a.value)+'" '+(null==(__t=a.value==favoriteType?'selected="selected"':"")?"":__t)+'">\n		'+__e(a.label)+"\n		</option>\n		"}),__p+='\n	</select>\n</div>\n\n<div class="entry-select-group">\n	<label><strong>Category: </strong></label>\n	<select class="favorite-category" style="width: 100%">\n		',_.each(categories,function(a){__p+='\n		<option value="'+__e(a.value)+'" '+(null==(__t=a.value==category?'selected="selected"':"")?"":__t)+'">\n		'+__e(a.label)+"\n		</option>\n		"}),__p+='\n	</select>\n</div>\n\n<div class="entry-answer-group">\n	<label><strong>Favorite: </strong></label>\n\n	<select class="constraint-operator" style="width: 35%">\n		',_.each(view.operatorsFor(valueType),function(a){__p+='\n		<option value="'+__e(a)+'" '+(null==(__t=a===operator?'selected="selected"':"")?"":__t)+'">\n		'+__e(a)+"\n		</option>\n		"}),__p+='\n	</select>\n\n	<input type="text" class="constraint-value constraint-value-text" value="'+__e(value)+'" />\n\n	<select class="constraint-conjunction" style="width: 15%">\n		',_.each(view.conjunctions,function(a){__p+='\n		<option value="'+__e(a)+'" '+(null==(__t=a===conjunction?'selected="selected"':"")?"":__t)+'">\n		'+__e(a)+"\n		</option>\n		"}),__p+="\n	</select>\n</div>\n\n";return __p},this.JST["src/templates/like_constraint.jst"]=function(obj){obj||(obj={});{var __t,__p="",__e=_.escape;Array.prototype.join}with(obj)__p+='<ul class="constraint-toolbar">\n	<li>\n		<a\n			alt="f105"\n			class="dashicons dashicons-admin-page copy-constraint"\n			href="#"\n			title="Duplicate"\n		/>\n\n		<a\n			alt="f105"\n			class="dashicons dashicons-trash remove-constraint"\n			href="#"\n			title="Remove"\n		/>\n	</li>\n</ul>\n\n<p class="constraint-title">\n	'+__e(title)+'\n</p>\n\n<div class="entry-select-group">\n	<label><strong>Category: </strong></label>\n	<select class="like-category" style="width: 100%">\n		',_.each(categories,function(a){__p+='\n		<option value="'+__e(a.value)+'" '+(null==(__t=a.value==category?'selected="selected"':"")?"":__t)+'">\n		'+__e(a.label)+"\n		</option>\n		"}),__p+='\n	</select>\n</div>\n\n<div class="entry-answer-group">\n	<label><strong>Like: </strong></label>\n\n	<select class="constraint-operator" style="width: 35%">\n		',_.each(view.operatorsFor(valueType),function(a){__p+='\n		<option value="'+__e(a)+'" '+(null==(__t=a===operator?'selected="selected"':"")?"":__t)+'">\n		'+__e(a)+"\n		</option>\n		"}),__p+='\n	</select>\n\n	<input type="text" class="constraint-value constraint-value-text" value="'+__e(value)+'" />\n\n	<select class="constraint-conjunction" style="width: 15%">\n		',_.each(view.conjunctions,function(a){__p+='\n		<option value="'+__e(a)+'" '+(null==(__t=a===conjunction?'selected="selected"':"")?"":__t)+'">\n		'+__e(a)+"\n		</option>\n		"}),__p+="\n	</select>\n</div>\n";return __p},this.JST["src/templates/query_result_item.jst"]=function(obj){obj||(obj={});var __p="",__e=_.escape;with(obj)__p+='<tr>\n	<td>\n		<a href="#" class="open-member-page-text">'+__e(email)+'</a>\n		<a href="#" alt="f105" class="dashicons dashicons-external open-member-page"></a>\n	</td>\n</tr>\n';return __p},this.JST["src/templates/toolbar_item.jst"]=function(obj){obj||(obj={});var __p="",__e=_.escape;with(obj)__p+='<a title="Click to add" href="#" class="toolbar_item">\n	'+__e(title)+"\n</a>\n";return __p};var EntryType=Backbone.Model.extend({defaults:{label:"Entry Type",value:-1}}),EntryField=Backbone.Model.extend({defaults:{label:"",value:"",type:"",choices:[],fieldOptions:{}}}),Constraint=Backbone.Model.extend({defaults:{type:"constraint:type_name",operator:"equals",conjunction:"and",valueType:"string",value:""},getMeta:function(a){return this.hasMeta(a)?AVAILABLE_CONSTRAINTS_META_MAP[this.get("type")][a]:null},hasMeta:function(a){var b=this.get("type");return!!AVAILABLE_CONSTRAINTS_META_MAP[b]&&!!AVAILABLE_CONSTRAINTS_META_MAP[b][a]},toViewJSON:function(){var a=this.toJSON(),b=this.get("type"),c=AVAILABLE_CONSTRAINTS_META_MAP[b];return c&&_.extend(a,c),a}}),ProfileConstraint=Constraint.extend({defaults:{type:"profile:field_name",operator:"equals",conjunction:"and",valueType:"string",value:""}}),EntryConstraint=Constraint.extend({defaults:{type:"record:contest",operator:"equals",conjunction:"and",valueType:"string",value:"",entryTypeID:-1,entryFieldID:-1},initialize:function(a,b){Constraint.prototype.initialize.call(this,a,b),this.listenTo(this,"change:entryTypeID",this.didChangeEntryTypeID)},getEntryType:function(){var a=this.get("type").split(":"),b=a[1];return b},getEntryTypes:function(){return this.entryTypes||(this.entryTypes=new EntryTypeCollection,this.loadEntryTypes()),this.entryTypes},loadEntryTypes:function(){var a={entryType:this.getEntryType()};ajaxApi.request("list_entry_types",a).then($.proxy(this.didLoadEntryTypes,this)).fail($.proxy(this.didLoadEntryTypesError,this))},didLoadEntryTypes:function(a){var b=this.entryTypes;if(b.reset(a.data,{silent:!0}),-1===this.get("entryTypeID")){var c=b.at(0);void 0!==c&&this.set("entryTypeID",c.get("value"),{silent:!0})}this.entryTypes.trigger("reset"),this.loadEntryFields()},didLoadEntryTypesError:function(a){console.log(a)},didChangeEntryTypeID:function(){this.loadEntryFields()},loadEntryFields:function(){var a={entryTypeID:this.get("entryTypeID")};ajaxApi.request("list_entry_fields",a).then($.proxy(this.didLoadEntryFields,this)).fail($.proxy(this.didLoadEntryFieldsError,this))},didLoadEntryFields:function(a){var b,c=this.getEntryFields();c.reset(a.data,{silent:!0}),-1===this.get("entryFieldID")&&(b=c.at(0),void 0!==b&&this.set("entryFieldID",b.get("value"),{silent:!0})),c.trigger("reset"),this.trigger("change")},didLoadEntryFieldsError:function(a){console.log(a)},getEntryFields:function(){return this.entryFields||(this.entryFields=new EntryFieldCollection),this.entryFields},getEntryFieldChoices:function(a){a||(a=this.get("entryFieldID"));var b=this.getEntryFields(),c=b.findWhere({value:a});if(c){var d=c.get("choices");return d&&d.length>0?d:[]}return[]},getEntryFieldOptions:function(){var a=this.getEntryFields(),b=a.findWhere({value:this.get("entryFieldID")});return b?b.get("fieldOptions"):{}},getEntryFieldType:function(){var a=this.getEntryFieldOptions();return a.fieldType?a.fieldType:"text"},hasChoices:function(){var a=this.getEntryFieldChoices();return a.length>0}}),LikeConstraint=Constraint.extend({defaults:{type:"profile:likes",operator:"equals",conjunction:"and",valueType:"string",value:"",category:"Any Category"},getCategories:function(){return FACEBOOK_CATEGORIES}});FACEBOOK_CATEGORIES=[{label:"Actor/Director"},{label:"Movie"},{label:"Producer"},{label:"Writer"},{label:"Studio"},{label:"Movie Theater"},{label:"TV/Movie Award"},{label:"Fictional Character"},{label:"Movie Character"},{label:"Album"},{label:"Song"},{label:"Musician/Band"},{label:"Music Video"},{label:"Concert Tour"},{label:"Concert Venue"},{label:"Radio Station"},{label:"Record Label"},{label:"Music Award"},{label:"Music Chart"},{label:"Book"},{label:"Author"},{label:"Book Store"},{label:"Library"},{label:"Magazine"},{label:"Book Series"},{label:"TV Show"},{label:"TV Network"},{label:"TV Channel"},{label:"Athlete"},{label:"Artist"},{label:"Public Figure"},{label:"Journalist"},{label:"News Personality"},{label:"Chef"},{label:"Lawyer"},{label:"Doctor"},{label:"Business Person"},{label:"Comedian"},{label:"Entertainer"},{label:"Teacher"},{label:"Dancer"},{label:"Designer"},{label:"Photographer"},{label:"Entrepreneur"},{label:"Politician"},{label:"Government Official"},{label:"Sports League"},{label:"Professional Sports Team"},{label:"Coach"},{label:"Amateur Sports Team"},{label:"School Sports Team"},{label:"Restaurant/Cafe"},{label:"Bar"},{label:"Club"},{label:"Company"},{label:"Product/Service"},{label:"Website"},{label:"Cars"},{label:"Bags/Luggage"},{label:"Camera/Photo"},{label:"Clothing"},{label:"Computers"},{label:"Software"},{label:"Office Supplies"},{label:"Electronics"},{label:"Health/Beauty"},{label:"Appliances"},{label:"Building Materials"},{label:"Commercial Equipment"},{label:"Home Decor"},{label:"Furniture"},{label:"Household Supplies"},{label:"Kitchen/Cooking"},{label:"Patio/Garden"},{label:"Tools/Equipment"},{label:"Wine/Spirits"},{label:"Jewelry/Watches"},{label:"Pet Supplies"},{label:"Outdoor Gear/Sporting Goods"},{label:"Baby Goods/Kids Goods"},{label:"Media/News/Publishing"},{label:"Bank/Financial Institution"},{label:"Non-Governmental Organization (NGO)"},{label:"Insurance Company"},{label:"Small Business"},{label:"Energy/Utility"},{label:"Retail and Consumer Merchandise"},{label:"Automobiles and Parts"},{label:"Industrials"},{label:"Transport/Freight"},{label:"Health/Medical/Pharmaceuticals"},{label:"Aerospace/Defense"},{label:"Mining/Materials"},{label:"Farming/Agriculture"},{label:"Chemicals"},{label:"Consulting/Business Services"},{label:"Legal/Law"},{label:"Education"},{label:"Engineering/Construction"},{label:"Food/Beverages"},{label:"Telecommunication"},{label:"Biotechnology"},{label:"Computers/Technology"},{label:"Internet/Software"},{label:"Travel/Leisure"},{label:"Community Organization"},{label:"Political Organization"},{label:"Vitamins/Supplements"},{label:"Drugs"},{label:"Church/Religious Organization"},{label:"Phone/Tablet"},{label:"Games/Toys"},{label:"App Page"},{label:"Video Game"},{label:"Board Game"},{label:"Local Business"},{label:"Hotel"},{label:"Landmark"},{label:"Airport"},{label:"Sports Venue"},{label:"Arts/Entertainment/Nightlife"},{label:"Automotive"},{label:"Spas/Beauty/Personal Care"},{label:"Event Planning/Event Services"},{label:"Bank/Financial Services"},{label:"Food/Grocery"},{label:"Health/Medical/Pharmacy"},{label:"Home Improvement"},{label:"Pet Services"},{label:"Professional Services"},{label:"Business Services"},{label:"Community/Government"},{label:"Real Estate"},{label:"Shopping/Retail"},{label:"Public Places"},{label:"Attractions/Things to Do"},{label:"Sports/Recreation/Activities"},{label:"Tours/Sightseeing"},{label:"Transportation"},{label:"Hospital/Clinic"},{label:"Museum/Art Gallery"},{label:"Organization"},{label:"School"},{label:"University"},{label:"Non-Profit Organization"},{label:"Government Organization"},{label:"Cause"},{label:"Political Party"},{label:"Pet"},{label:"Middle School"}],function(){var a,b=0,c=FACEBOOK_CATEGORIES.length;for(b=0;c>b;b++)a=FACEBOOK_CATEGORIES[b],a.value||(a.value=a.label);FACEBOOK_CATEGORIES=_.sortBy(FACEBOOK_CATEGORIES,"label"),FACEBOOK_CATEGORIES.unshift({label:"Any Category",value:"Any Category"})}();var FavoriteConstraint=Constraint.extend({defaults:{type:"profile:favorites",operator:"equals",conjunction:"and",valueType:"string",value:"",favoriteType:"music",category:"Any Category"},getCategories:function(){return FACEBOOK_CATEGORIES},getFavoriteTypes:function(){return FACEBOOK_FAVORITE_TYPES}});FACEBOOK_FAVORITE_TYPES=[{label:"Interests",value:"interests"},{label:"Music",value:"music"},{label:"Television",value:"television"},{label:"Activities",value:"activities"},{label:"Books",value:"books"}];var AVAILABLE_CONSTRAINTS=[{type:"system:createdTimestamp",valueType:"date",value:"01/01/2012",operator:"greater than"},{type:"system:lastLoginTimestamp",valueType:"date",value:"01/01/2014",operator:"greater than"},{type:"system:isActive",valueType:"boolean",value:!0},{type:"system:isRegistered",valueType:"boolean",value:!0},{type:"system:isVerified",valueType:"boolean",value:!0},{type:"profile:gender",valueType:"string",value:"m"},{type:"profile:age",valueType:"integer",value:25},{type:"profile:birthDay",valueType:"integer",value:1},{type:"profile:birthMonth",valueType:"integer",value:1},{type:"profile:birthYear",valueType:"integer",value:1990},{type:"profile:state",valueType:"string",value:"New York"},{type:"profile:city",valueType:"string"},{type:"profile:country",valueType:"string",value:"United States"},{type:"profile:zip",valueType:"string",value:"01001"},{type:"profile:likes",valueType:"string",category:"Any Category",value:""},{type:"profile:favorites",valueType:"string",category:"Any Category",value:""},{type:"record:contest",valueType:"string",entryTypeID:-1,entryFieldID:-1},{type:"data:comment_count",valueType:"integer",value:0},{type:"data:comment_status",valueType:"boolean",value:!0},{type:"action:comment_date",valueType:"date",value:"01/01/2014",operator:"greater than"}],AVAILABLE_CONSTRAINTS_META=[{type:"system:createdTimestamp",title:"Creation Date"},{type:"system:isActive",title:"Active Status",choices:[{label:"Active",value:!0},{label:"Inactive",value:!1}]},{type:"system:isRegistered",title:"Registration Status",choices:[{label:"Registered",value:!0},{label:"Not Registered",value:!1}]},{type:"system:lastLoginTimestamp",title:"Last Logged In"},{type:"system:isVerified",title:"Verified Status",choices:[{label:"Verified",value:!0},{label:"Not Verified",value:!1}]},{type:"profile:likes",title:"Facebook Likes"},{type:"profile:favorites",title:"Facebook Favorites"},{type:"profile:birthYear",title:"Birth Year"},{type:"profile:country",title:"Country",choices:[{label:"Afghanistan",value:"Afghanistan"},{label:"Albania",value:"Albania"},{label:"Algeria",value:"Algeria"},{label:"American Samoa",value:"Samoa"},{label:"Andorra",value:"Andorra"},{label:"Angola",value:"Angola"},{label:"Antigua and Barbuda",value:"Barbuda"},{label:"Argentina",value:"Argentina"},{label:"Armenia",value:"Armenia"},{label:"Australia",value:"Australia"},{label:"Austria",value:"Austria"},{label:"Azerbaijan",value:"Azerbaijan"},{label:"Bahamas",value:"Bahamas"},{label:"Bahrain",value:"Bahrain"},{label:"Bangladesh",value:"Bangladesh"},{label:"Barbados",value:"Barbados"},{label:"Belarus",value:"Belarus"},{label:"Belgium",value:"Belgium"},{label:"Belize",value:"Belize"},{label:"Benin",value:"Benin"},{label:"Bermuda",value:"Bermuda"},{label:"Bhutan",value:"Bhutan"},{label:"Bolivia",value:"Bolivia"},{label:"Bosnia and Herzegovina",value:"Herzegovina"},{label:"Botswana",value:"Botswana"},{label:"Brazil",value:"Brazil"},{label:"Brunei",value:"Brunei"},{label:"Bulgaria",value:"Bulgaria"},{label:"Burkina Faso",value:"Faso"},{label:"Burundi",value:"Burundi"},{label:"Cambodia",value:"Cambodia"},{label:"Cameroon",value:"Cameroon"},{label:"Canada",value:"Canada"},{label:"Cape Verde",value:"Verde"},{label:"Cayman Islands",value:"Islands"},{label:"Central African Republic",value:"Republic"},{label:"Chad",value:"Chad"},{label:"Chile",value:"Chile"},{label:"China",value:"China"},{label:"Colombia",value:"Colombia"},{label:"Comoros",value:"Comoros"},{label:"Congo, Democratic Republic of the",value:"the"},{label:"Congo, Republic of the",value:"the"},{label:"Costa Rica",value:"Rica"},{label:"Croatia",value:"Croatia"},{label:"Cuba",value:"Cuba"},{label:"Cyprus",value:"Cyprus"},{label:"Czech Republic",value:"Republic"},{label:"Denmark",value:"Denmark"},{label:"Djibouti",value:"Djibouti"},{label:"Dominica",value:"Dominica"},{label:"Dominican Republic",value:"Republic"},{label:"East Timor",value:"Timor"},{label:"Ecuador",value:"Ecuador"},{label:"Egypt",value:"Egypt"},{label:"El Salvador",value:"Salvador"},{label:"Equatorial Guinea",value:"Guinea"},{label:"Eritrea",value:"Eritrea"},{label:"Estonia",value:"Estonia"},{label:"Ethiopia",value:"Ethiopia"},{label:"Fiji",value:"Fiji"},{label:"Finland",value:"Finland"},{label:"France",value:"France"},{label:"French Polynesia",value:"Polynesia"},{label:"Gabon",value:"Gabon"},{label:"Gambia",value:"Gambia"},{label:"Georgia",value:"Georgia"},{label:"Germany",value:"Germany"},{label:"Ghana",value:"Ghana"},{label:"Greece",value:"Greece"},{label:"Greenland",value:"Greenland"},{label:"Grenada",value:"Grenada"},{label:"Guam",value:"Guam"},{label:"Guatemala",value:"Guatemala"},{label:"Guinea",value:"Guinea"},{label:"Guinea-Bissau",value:"Bissau"},{label:"Guyana",value:"Guyana"},{label:"Haiti",value:"Haiti"},{label:"Honduras",value:"Honduras"},{label:"Hong Kong",value:"Kong"},{label:"Hungary",value:"Hungary"},{label:"Iceland",value:"Iceland"},{label:"India",value:"India"},{label:"Indonesia",value:"Indonesia"},{label:"Iran",value:"Iran"},{label:"Iraq",value:"Iraq"},{label:"Ireland",value:"Ireland"},{label:"Israel",value:"Israel"},{label:"Italy",value:"Italy"},{label:"Jamaica",value:"Jamaica"},{label:"Japan",value:"Japan"},{label:"Jordan",value:"Jordan"},{label:"Kazakhstan",value:"Kazakhstan"},{label:"Kenya",value:"Kenya"},{label:"Kiribati",value:"Kiribati"},{label:"North Korea",value:"Korea"},{label:"South Korea",value:"Korea"},{label:"Kosovo",value:"Kosovo"},{label:"Kuwait",value:"Kuwait"},{label:"Kyrgyzstan",value:"Kyrgyzstan"},{label:"Laos",value:"Laos"},{label:"Latvia",value:"Latvia"},{label:"Lebanon",value:"Lebanon"},{label:"Lesotho",value:"Lesotho"},{label:"Liberia",value:"Liberia"},{label:"Libya",value:"Libya"},{label:"Liechtenstein",value:"Liechtenstein"},{label:"Lithuania",value:"Lithuania"},{label:"Luxembourg",value:"Luxembourg"},{label:"Macedonia",value:"Macedonia"},{label:"Madagascar",value:"Madagascar"},{label:"Malawi",value:"Malawi"},{label:"Malaysia",value:"Malaysia"},{label:"Maldives",value:"Maldives"},{label:"Mali",value:"Mali"},{label:"Malta",value:"Malta"},{label:"Marshall Islands",value:"Islands"},{label:"Mauritania",value:"Mauritania"},{label:"Mauritius",value:"Mauritius"},{label:"Mexico",value:"Mexico"},{label:"Micronesia",value:"Micronesia"},{label:"Moldova",value:"Moldova"},{label:"Monaco",value:"Monaco"},{label:"Mongolia",value:"Mongolia"},{label:"Montenegro",value:"Montenegro"},{label:"Morocco",value:"Morocco"},{label:"Mozambique",value:"Mozambique"},{label:"Myanmar",value:"Myanmar"},{label:"Namibia",value:"Namibia"},{label:"Nauru",value:"Nauru"},{label:"Nepal",value:"Nepal"},{label:"Netherlands",value:"Netherlands"},{label:"New Zealand",value:"Zealand"},{label:"Nicaragua",value:"Nicaragua"},{label:"Niger",value:"Niger"},{label:"Nigeria",value:"Nigeria"},{label:"Norway",value:"Norway"},{label:"Northern Mariana Islands",value:"Islands"},{label:"Oman",value:"Oman"},{label:"Pakistan",value:"Pakistan"},{label:"Palau",value:"Palau"},{label:"Palestine",value:"Palestine"},{label:"Panama",value:"Panama"},{label:"Papua New Guinea",value:"Guinea"},{label:"Paraguay",value:"Paraguay"},{label:"Peru",value:"Peru"},{label:"Philippines",value:"Philippines"},{label:"Poland",value:"Poland"},{label:"Portugal",value:"Portugal"},{label:"Puerto Rico",value:"Rico"},{label:"Qatar",value:"Qatar"},{label:"Romania",value:"Romania"},{label:"Russia",value:"Russia"},{label:"Rwanda",value:"Rwanda"},{label:"Saint Kitts and Nevis",value:"Nevis"},{label:"Saint Lucia",value:"Lucia"},{label:"Saint Vincent and the Grenadines",value:"Grenadines"},{label:"Samoa",value:"Samoa"},{label:"San Marino",value:"Marino"},{label:"Sao Tome and Principe",value:"Principe"},{label:"Saudi Arabia",value:"Arabia"},{label:"Senegal",value:"Senegal"},{label:"Serbia and Montenegro",value:"Montenegro"},{label:"Seychelles",value:"Seychelles"},{label:"Sierra Leone",value:"Leone"},{label:"Singapore",value:"Singapore"},{label:"Slovakia",value:"Slovakia"},{label:"Slovenia",value:"Slovenia"},{label:"Solomon Islands",value:"Islands"},{label:"Somalia",value:"Somalia"},{label:"South Africa",value:"South Africa"},{label:"Spain",value:"Spain"},{label:"Sri Lanka",value:"Lanka"},{label:"Sudan",value:"Sudan"},{label:"Sudan, South",value:"South"},{label:"Suriname",value:"Suriname"},{label:"Swaziland",value:"Swaziland"},{label:"Sweden",value:"Sweden"},{label:"Switzerland",value:"Switzerland"},{label:"Syria",value:"Syria"},{label:"Taiwan",value:"Taiwan"},{label:"Tajikistan",value:"Tajikistan"},{label:"Tanzania",value:"Tanzania"},{label:"Thailand",value:"Thailand"},{label:"Togo",value:"Togo"},{label:"Tonga",value:"Tonga"},{label:"Trinidad and Tobago",value:"Tobago"},{label:"Tunisia",value:"Tunisia"},{label:"Turkey",value:"Turkey"},{label:"Turkmenistan",value:"Turkmenistan"},{label:"Tuvalu",value:"Tuvalu"},{label:"Uganda",value:"Uganda"},{label:"Ukraine",value:"Ukraine"},{label:"United Arab Emirates",value:"Emirates"},{label:"United Kingdom",value:"Kingdom"},{label:"United States",value:"United States"},{label:"Uruguay",value:"Uruguay"},{label:"Uzbekistan",value:"Uzbekistan"},{label:"Vanuatu",value:"Vanuatu"},{label:"Vatican City",value:"City"},{label:"Venezuela",value:"Venezuela"},{label:"Vietnam",value:"Vietnam"},{label:"Virgin Islands, British",value:"British"},{label:"Virgin Islands, U.S.",value:"Virgin Islands, US"},{label:"Yemen",value:"Yemen"},{label:"Zambia",value:"Zambia"},{label:"Zimbabwe",value:"Zimbabwe"}]},{type:"profile:zip",title:"Zip Code"},{type:"profile:gender",title:"Gender",choices:[{label:"Male",value:"m"},{label:"Female",value:"f"},{label:"Unknown",value:"u"}]},{type:"profile:age",title:"Age"},{type:"profile:birthDay",title:"Birth Day"},{type:"profile:birthMonth",title:"Birth Month",choices:[{label:"January",value:1},{label:"February",value:2},{label:"March",value:3},{label:"April",value:4},{label:"May",value:5},{label:"June",value:6},{label:"July",value:7},{label:"August",value:8},{label:"September",value:9},{label:"October",value:10},{label:"November",value:11},{label:"December",value:12}]},{type:"profile:state",title:"State",choices:[{label:"Alabama",value:"AL"},{label:"Alaska",value:"AK"},{label:"Arizona",value:"AZ"},{label:"Arkansas",value:"AR"},{label:"California",value:"CA"},{label:"Colorado",value:"CO"},{label:"Connecticut",value:"CT"},{label:"Delaware",value:"DE"},{label:"District of Columbia",value:"DC"},{label:"Florida",value:"FL"},{label:"Georgia",value:"GA"},{label:"Hawaii",value:"HI"},{label:"Idaho",value:"ID"},{label:"Illinois",value:"IL"},{label:"Indiana",value:"IN"},{label:"Iowa",value:"IA"},{label:"Kansas",value:"KS"},{label:"Kentucky",value:"KY"},{label:"Louisiana",value:"LA"},{label:"Maine",value:"ME"},{label:"Maryland",value:"MD"},{label:"Massachusetts",value:"MA"},{label:"Michigan",value:"MI"},{label:"Minnesota",value:"MN"},{label:"Mississippi",value:"MS"},{label:"Missouri",value:"MO"},{label:"Montana",value:"MT"},{label:"Nebraska",value:"NE"},{label:"Nevada",value:"NV"},{label:"New Hampshire",value:"NH"},{label:"New Jersey",value:"NJ"},{label:"New Mexico",value:"NM"},{label:"New York",value:"NY"},{label:"North Carolina",value:"NC"},{label:"North Dakota",value:"ND"},{label:"Ohio",value:"OH"},{label:"Oklahoma",value:"OK"},{label:"Oregon",value:"OR"},{label:"Pennsylvania",value:"PA"},{label:"Rhode Island",value:"RI"},{label:"South Carolina",value:"SC"},{label:"South Dakota",value:"SD"},{label:"Tennessee",value:"TN"},{label:"Texas",value:"TX"},{label:"Utah",value:"UT"},{label:"Vermont",value:"VT"},{label:"Virginia",value:"VA"},{label:"Washington",value:"WA"},{label:"West Virginia",value:"WV"},{label:"Wisconsin",value:"WI"},{label:"Wyoming",value:"WY"},{label:"Armed Forces Americas",value:"AA"},{label:"Armed Forces Europe",value:"AE"},{label:"Armed Forces Pacific",value:"AP"}]},{type:"profile:city",title:"City"},{type:"profile:timezone",title:"Timezone"},{type:"record:contest",title:"Contest Entry"},{type:"data:comment_count",title:"Comment Count"},{type:"data:comment_status",title:"Comment Status",choices:[{label:"Has Commented",value:!0},{label:"Has Not Commented",value:!1}]},{type:"action:comment_date",title:"Comment Date"}],AVAILABLE_CONSTRAINTS_META_MAP={};!function(){var a,b=function(a,b){var c,d=[];for(c=a;b>=c;c++)choice={label:c,value:c},d.push(choice);return d},c=AVAILABLE_CONSTRAINTS_META,d=AVAILABLE_CONSTRAINTS_META_MAP,e=c.length;for(a=0;e>a;a++)constraint=c[a],d[constraint.type]=constraint,"profile:birthDay"===constraint.type&&(constraint.choices=b(1,31))}();var QueryResult=Backbone.Model.extend({defaults:{email:""}}),MemberQueryStatus=Backbone.Model.extend({defaults:{memberQueryID:-1},initialize:function(a,b){Backbone.Model.prototype.initialize.call(this,a,b),this.intervalID=-1,this.delay=3,this.pollFunc=$.proxy(this.poll,this),this.startPoll()},getStatusCode:function(){return this.get("statusCode")},getMemberQueryID:function(){return this.get("memberQueryID")},getEmailSegmentID:function(){return this.get("emailSegmentID")},getLastExport:function(){return this.get("lastExport")},getProgress:function(){return this.get("progress")
},refresh:function(){var a={member_query_id:this.getMemberQueryID()};ajaxApi.request("member_query_status",a).then($.proxy(this.didRefresh,this)).fail($.proxy(this.didRefreshError,this))},didRefresh:function(a){a.success?(this.set(a.data),this.trigger("refreshSuccess"),"running"===this.get("statusCode")?this.startPoll():a.data.errors&&this.trigger("refreshError",a.data.errors[0])):this.didRefreshError(a)},didRefreshError:function(a){this.trigger("refreshError",a.data)},startPoll:function(){clearTimeout(this.intervalID),this.intervalID=setTimeout(this.pollFunc,1e3*this.delay)},poll:function(){this.refresh()}}),EntryTypeCollection=Backbone.Collection.extend({model:EntryType}),EntryFieldCollection=Backbone.Collection.extend({model:EntryField}),ConstraintCollection=Backbone.Collection.extend({model:function(a,b){var c=ConstraintCollection.kindForType(a.type),d=ConstraintCollection.typesMap[c]||Constraint;return new d(a,b)},initialize:function(a,b){this.on("change add remove reset",this.save,this),Backbone.Collection.prototype.initialize.call(this,a,b)},save:function(){var a=JSON.stringify(this.toJSON()),b=jQuery("#constraints");b.attr("value",a)}},{kindForType:function(a){var b=a.split(":");if(b.length>0){var c=b[1];return"likes"===c?"likes":"favorites"===c?"favorites":b[0]}return a},typesMap:{system:Constraint,profile:ProfileConstraint,record:EntryConstraint,likes:LikeConstraint,favorites:FavoriteConstraint}}),QueryResultCollection=Backbone.Collection.extend({model:QueryResult,initialize:function(a,b){this.activeConstraints=b.activeConstraints,this.pollDelay=3,this.maxQueryTime=300,this.maxRetries=Math.floor(this.maxQueryTime/this.pollDelay),this.retries=0,this.fetchStatusProxy=$.proxy(this.fetchStatus,this),this.lastProgress=0,Backbone.Collection.prototype.initialize(this,a,b)},search:function(){this.start()},start:function(){this.retries=0;var a=this.activeConstraints.toJSON(),b={constraints:a,mode:"start"};ajaxApi.request("preview_member_query",b).then($.proxy(this.didStartSuccess,this)).fail($.proxy(this.didStartError,this))},didStartSuccess:function(a){a.success?(this.memberQueryID=a.data.member_query_id,this.trigger("searchStart",this.memberQueryID),this.startPolling()):this.didStartError(a)},didStartError:function(a){this.reset([]),this.trigger("searchError",a.data)},onPoll:function(){this.fetchStatus()},fetchStatus:function(){var a={mode:"status",member_query_id:this.memberQueryID};this.retries++,ajaxApi.request("preview_member_query",a).then($.proxy(this.didFetchStatusSuccess,this)).fail($.proxy(this.didFetchStatusError,this))},didFetchStatusSuccess:function(a){if(a.success)if(a.data.complete)a.data.errors?(this.reset([]),this.trigger("searchError",a.data.errors[0]),this.clear()):(this.totalResults=a.data.total,this.reset(a.data.users),this.trigger("searchSuccess"),this.clear());else{var b=a.data.progress;this.lastProgress!==b&&(this.lastProgress=b,this.retries--),this.trigger("searchProgress",b),this.startPolling()}else this.didFetchStatusError(a)},didFetchStatusError:function(){this.startPolling()},getTotalResults:function(){return this.totalResults},startPolling:function(){this.retries<this.maxRetries?setTimeout(this.fetchStatusProxy,1e3*this.pollDelay):this.trigger("searchTimeout")},clear:function(){var a={mode:"clear",member_query_id:this.memberQueryID};this.retries++,ajaxApi.request("preview_member_query",a).then($.proxy(this.didClearSuccess,this)).fail($.proxy(this.didClearError,this))},didClearSuccess:function(){},didClearError:function(a){console.log("didClearError",a)}}),ToolbarItemView=Backbone.CollectionView.extend({template:getTemplate("toolbar_item"),events:{"click .toolbar_item":"didToolbarItemClick"},initialize:function(){this.render()},render:function(){var a=this.model.toViewJSON(),b=this.template(a);this.$el.html(b)},didToolbarItemClick:function(){var a=this.model.clone();return this.$el.trigger("addConstraint",a),!1}}),ToolbarView=Backbone.CollectionView.extend({modelView:ToolbarItemView,events:{addConstraint:"addConstraint"},initialize:function(a){this.activeConstraints=a.activeConstraints,a.tabIndex=-1,Backbone.CollectionView.prototype.initialize.call(this,a)},addConstraint:function(a,b){this.activeConstraints.add(b)}}),ConstraintView=Backbone.View.extend({template:getTemplate("constraint"),events:{"click .copy-constraint":"didCopyClick","click .remove-constraint":"didRemoveClick",change:"didChange"},initialize:function(){this.render()},render:function(){var a=this.model.toViewJSON();a.view=this;var b=this.template(a);this.$el.html(b);var c=$(".constraint-value",this.el);"date"===a.valueType?c.datepicker({dateFormat:"mm/dd/yy"}):this.hasChoices()},didCopyClick:function(){return this.$el.trigger("copyConstraint",this.model),!1},didRemoveClick:function(){return this.$el.trigger("removeConstraint",this.model),!1},didChange:function(a){this.updateConstraint(this.model,a.target)},updateConstraint:function(a){var b=$(".constraint-operator",this.el).val(),c=$(".constraint-conjunction",this.el).val(),d=$(".constraint-value",this.el).val();d=this.parseValue(d,a.get("valueType"));var e={operator:b,value:d,conjunction:c};a.set(e)},parseValue:function(a,b){return"boolean"===b?"true"===a:"integer"===b?parseInt(a,10):"float"===b?parseFloat(a,10):a},allOperators:["equals","not equals","greater than","greater than or equal to","less than","less than or equal to","contains","not contains"],numericOperators:["equals","not equals","greater than","greater than or equal to","less than","less than or equal to"],stringOperators:["equals","not equals","contains","not contains"],nonFullTextOperators:["equals","not equals"],booleanOperators:["equals","not equals"],dateOperators:["greater than","greater than or equal to","less than","less than or equal to"],nonFullTextTypes:["profile:zip","profile:state","profile:country","profile:timezone"],operatorsFor:function(a,b){return"integer"===a||"float"===a?this.numericOperators:"string"===a?this.isNonFullTextType(b)?this.nonFullTextOperators:this.stringOperators:"boolean"===a?this.booleanOperators:"date"===a?this.dateOperators:this.allOperators},conjunctions:["and","or"],hasChoices:function(){return this.model.hasMeta("choices")},isNonFullTextType:function(a){return void 0===a?!1:-1!==_.indexOf(this.nonFullTextTypes,a)}}),EntryConstraintView=ConstraintView.extend({template:getTemplate("entry_constraint"),entrySelectTemplate:getTemplate("entry_select"),entryAnswerTemplate:getTemplate("entry_answer"),initialize:function(a,b){ConstraintView.prototype.initialize.call(this,a,b),this.listenTo(this.model.getEntryTypes(),"reset",this.renderEntryTypes),this.listenTo(this.model.getEntryFields(),"reset",this.renderEntryField)},renderEntryTypes:function(){var a=$(".entry-select-type",this.el),b=this.model.getEntryTypes().toJSON(),c={choices:b,currentChoice:this.model.get("entryTypeID")},d=this.entrySelectTemplate(c);a.html(d)},renderEntryField:function(){var a=$(".entry-select-field",this.el),b=this.model.getEntryFields().toJSON(),c={choices:b,currentChoice:this.model.get("entryFieldID")},d=this.entrySelectTemplate(c);a.html(d),this.renderEntryAnswer()},renderEntryValueSelect:function(){var a=$(".constraint-value",this.el),b=this.model.getEntryFieldChoices(),c={choices:b,currentChoice:this.model.get("value")},d=this.entrySelectTemplate(c);a.html(d)},renderEntryAnswer:function(){var a=$(".entry-answer-group",this.el),b=this.model.toViewJSON();b.view=this,b.choices=this.model.getEntryFieldChoices(),b.currentChoice=this.model.get("value"),b.fieldType=this.model.getEntryFieldType(),b.fieldOptions=this.model.getEntryFieldOptions();var c=this.entryAnswerTemplate(b);a.html(c);var d=this.model.getEntryFieldType();if("date"===d){var e=$(".constraint-value",this.el);e.datepicker({dateFormat:"mm/dd/yy"})}},updateConstraint:function(a,b){var c=$(".constraint-operator",this.el).val(),d=$(".constraint-conjunction",this.el).val(),e=$(".constraint-value",this.el).val(),f=$(".entry-select-type",this.el).val(),g=$(".entry-select-field",this.el).val(),h=$(b);if(e=this.parseValue(e,a.get("valueType")),h.hasClass("entry-select-type"))e="",g=-1;else if(h.hasClass("entry-select-field")){var i=this.model.getEntryFieldChoices(g);e=i.length>0?i[0].value:""}var j={operator:c,value:e,conjunction:d,entryTypeID:this.parseValue(f,"string"),entryFieldID:this.parseValue(g,"string")};a.set(j),this.renderEntryAnswer()},hasChoices:function(){return this.model.hasChoices()},conjunctions:["or"]}),LikeConstraintView=ConstraintView.extend({template:getTemplate("like_constraint"),initialize:function(a,b){ConstraintView.prototype.initialize.call(this,a,b)},render:function(){var a=this.model.toViewJSON();a.view=this,a.categories=this.model.getCategories();var b=this.template(a);this.$el.html(b)},updateConstraint:function(a){var b=$(".constraint-operator",this.el).val(),c=$(".constraint-conjunction",this.el).val(),d=$(".constraint-value",this.el).val(),e=$(".like-category",this.el).val();d=this.parseValue(d,a.get("valueType"));var f={operator:b,value:d,conjunction:c,category:e};a.set(f)}}),FavoriteConstraintView=ConstraintView.extend({template:getTemplate("favorite_constraint"),initialize:function(a,b){ConstraintView.prototype.initialize.call(this,a,b)},render:function(){var a=this.model.toViewJSON();a.view=this,a.categories=this.model.getCategories(),a.favoriteTypes=this.model.getFavoriteTypes();var b=this.template(a);this.$el.html(b)},updateConstraint:function(a){var b=$(".constraint-operator",this.el).val(),c=$(".constraint-conjunction",this.el).val(),d=$(".constraint-value",this.el).val(),e=$(".favorite-category",this.el).val(),f=$(".favorite-type",this.el).val();d=this.parseValue(d,a.get("valueType"));var g={operator:b,value:d,conjunction:c,category:e,favoriteType:f};a.set(g)}}),ActiveConstraintsView=Backbone.CollectionView.extend({el:jQuery("#active_constraints"),emptyListCaption:getTemplate("empty_constraints"),events:{copyConstraint:"copyConstraint",removeConstraint:"removeConstraint"},_getModelViewConstructor:function(a){var b=a.get("type"),c=ConstraintCollection.kindForType(b);switch(c){case"record":return EntryConstraintView;case"likes":return LikeConstraintView;case"favorites":return FavoriteConstraintView;default:return ConstraintView}},copyConstraint:function(a,b){var c=b.clone(),d=this.collection.indexOf(b);this.collection.add(c,{at:d+1})},removeConstraint:function(a,b){this.collection.remove(b)}}),PreviewView=Backbone.View.extend({events:{"click .preview-member-query-button":"didPreviewClick"},initialize:function(a){this.collection=a.collection,this.listenTo(this.collection,"searchError",this.didSearchError),this.listenTo(this.collection,"searchStart",this.didSearchStart),this.listenTo(this.collection,"searchProgress",this.didSearchProgress),this.listenTo(this.collection,"searchSuccess",this.didSearchSuccess),this.listenTo(this.collection,"searchTimeout",this.didSearchTimeout),Backbone.View.prototype.initialize.call(this,a),this.previewEnabled=!0,this.stepper=new Stepper("didStep",this)},didPreviewClick:function(){return this.previewEnabled&&this.search(),!1},search:function(){this.setStatus("Searching, Please wait ..."),this.collection.search()},didSearchStart:function(){this.stepper.start(0),this.setPreviewEnabled(!1)},didSearchProgress:function(a){this.stepper.update(a)},didStep:function(a){this.setStatus("Searching, Please wait ... "+a+"%")},didSearchSuccess:function(){this.stepper.stop();var a=this.collection.getTotalResults(),b=a+" records found";b+=a>0?", showing the first 5":".",this.setStatus(b),this.setPreviewEnabled(!0)},didSearchError:function(a){this.stepper.stop(),this.setPreviewEnabled(!0),this.setStatus("Error: "+a)},didSearchTimeout:function(){this.stepper.stop(),this.setStatus("Error: Query timed out, please try again."),this.setPreviewEnabled(!0)},setStatus:function(a){var b=$(".count-status");b.text(a)},setPreviewEnabled:function(a){var b=$(".preview-member-query-button",this.el);b.toggleClass("disabled",!a),this.previewEnabled=a}}),Stepper=function(a,b){this.callback=a,this.scope=b,this.intervalID=-1;var c=this;this.stepFunc=function(){c.step()}};Stepper.prototype={start:function(a){this.value=a,this.current=0,this.startInterval()},update:function(a){this.value=a,this.isRunning()||this.startInterval()},startInterval:function(){clearInterval(this.intervalID),this.intervalID=setInterval(this.stepFunc,100)},stop:function(){clearInterval(this.intervalID),this.intervalID=-1},step:function(){this.current<this.value?(this.current++,this.scope[this.callback](this.current)):this.stop()},isRunning:function(){return-1!==this.intervalID}};var QueryResultItemView=Backbone.CollectionView.extend({template:getTemplate("query_result_item"),render:function(){var a=this.model.toJSON(),b=this.template(a);this.$el.html(b)}}),QueryResultsView=Backbone.CollectionView.extend({modelView:QueryResultItemView}),ExportView=Backbone.View.extend({template:getTemplate("export"),initialize:function(a){Backbone.View.prototype.initialize.call(this,a),this.listenTo(this.model,"change",this.render)},render:function(){var a=this.getStatusJSON();a.view=this;var b=this.template(a);this.$el.html(b),this.$el.css("visibility","visible")},getStatusJSON:function(){var a={},b=this.model.getStatusCode();"pending"===b?a.statusText="Pending":"running"===b?a.statusText=this.model.getProgress()+"% Completed ...":"completed"===b&&(a.statusText="Completed");var c=this.model.getLastExport();return c?(a.lastExport=this.toHumanTime(this.model.getLastExport()),a.emailSegmentID=this.model.getEmailSegmentID(),a.emailSegmentURL=this.toEmmaGroupURL(a.emailSegmentID)):(a.lastExport="Never",a.emailSegmentID=!1),a},toEmmaGroupURL:function(a){return"https://app.e2ma.net/app2/audience/list/active/"+a+"/"},monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],toHumanTime:function(a){var b=new Date(1e3*a),c=b.getMonth(),d=this.monthNames[c];d=d.substring(0,3);var e=b.getDay(),f=b.getFullYear(),g=b.getHours();10>g&&(g="0"+g);var h=b.getMinutes();10>h&&(h="0"+h);var i=b.getSeconds();10>i&&(i="0"+i);var j=d+" "+e+", "+f+" @ "+g+":"+h+":"+i;return j},getStatusText:function(){return"statusText"},getEmailSegmentID:function(){return"segment123"},getLastExport:function(){return"1 minute ago"}}),ExportMenuView=Backbone.View.extend({events:{"click .export-button":"didClickExport"},initialize:function(a){Backbone.View.prototype.initialize.call(this,a)},render:function(){var a=this.getSubmitButton();a.val("Save"),a.toggleClass("button-primary",!1);var b=$('<input name="export" type="button" class="button button-primary button-large export-button" id="export-button" value="Export">');b.insertBefore(a)},getSubmitButton:function(){return $("#publish",this.$el)},getPublishForm:function(){return this.getSubmitButton().parents("form:first")},didClickExport:function(){var a=$("<input>").attr({type:"hidden",name:"export_member_query",value:"1"}),b=this.getPublishForm();a.appendTo(b);var c=this.getSubmitButton();return c.trigger("click"),!1}}),$=jQuery,QueryBuilderApp=function(){$(document).ready($.proxy(this.initialize,this))};QueryBuilderApp.version="0.1.0",QueryBuilderApp.prototype={initialize:function(){window.ajaxApi=new WpAjaxApi(member_query_meta);var a=member_query_data.constraints||[],b=new ConstraintCollection(AVAILABLE_CONSTRAINTS),c=new ConstraintCollection(a),d=new QueryResultCollection([],{activeConstraints:c}),e=new MemberQueryStatus(member_query_meta.status_meta),f=new ToolbarView({el:$("#query_builder_toolbar"),collection:b,activeConstraints:c}),g=new ActiveConstraintsView({el:$("#active_constraints"),collection:c}),h=new PreviewView({el:$(".preview-member-query"),collection:d}),i=new QueryResultsView({el:$(".member-query-results"),collection:d}),j=new ExportView({el:$("#submitdiv #minor-publishing"),model:e}),k=new ExportMenuView({el:$("#submitdiv #major-publishing-actions"),model:e});$("#query_builder_metabox").toggleClass("loading",!1),$("#query_builder_metabox .loading-indicator").remove(),f.render(),g.render(),h.render(),i.render(),j.render(),k.render(),c.save(),$(".wrap-preloader").remove(),$(".wrap").css("display","block")}};var app=new QueryBuilderApp;