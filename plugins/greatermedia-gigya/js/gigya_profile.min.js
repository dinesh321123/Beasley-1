!function(a){var b=function(){this.cookieValue={}};b.prototype={isEnabled:function(){return Cookies.enabled},set:function(a,b){this.cookieValue[a]=b},get:function(a){return this.cookieValue[a]},save:function(a){Cookies.set(this.getCookieName(),this.serialize(this.cookieValue),this.getCookieOptions(a))},load:function(){if(this.isEnabled()){var a=Cookies.get(this.getCookieName());this.cookieValue=this.deserialize(a)}},clear:function(){var a={path:this.getCookiePath(),domain:this.getCookieDomain()};Cookies.expire(this.getCookieName(),a),this.cookieValue={}},getCookieOptions:function(a){return{path:this.getCookiePath(),domain:this.getCookieDomain(),secure:this.isSecurePage(),expires:this.getCookieTimeout(a)}},getCookieName:function(){return"gigya_profile"},getCookiePath:function(){return"/"},getCookieDomain:function(){return location.hostname},getCookieTimeout:function(a){return a?31536e3:1800},serialize:function(a){var b=JSON.stringify(a);return btoa?btoa(b):b},deserialize:function(a){if(a){var b;try{atob&&(a=atob(a)),b=JSON.parse(a)}catch(c){}finally{this.isObject(b)||(b={})}return b}return{}},isObject:function(a){return!!a&&a.constructor===Object},isSecurePage:function(){return"https:"===location.protocol}};var c=function(a){this.store=a};c.prototype={isEnabled:function(){return this.store.isEnabled()},isLoggedIn:function(){return!!this.getUserID()},register:function(a){this.login(a)},login:function(a){for(var b in a)a.hasOwnProperty(b)&&this.store.set(b,a[b]);this.store.save()},logout:function(){this.store.clear()},getUserID:function(){return this.store.get("UID")}};var d=function(b,c){this.session=b,this.willRegister=!!c,gigya.accounts.addEventHandlers({onLogin:a.proxy(this.didLogin,this),onLogout:a.proxy(this.didLogout,this)})};d.prototype={didLogin:function(a){if(this.willRegister)return this.willRegister=!1,void this.didRegister(a);var b=this.profileForResponse(a);this.session.login(b),this.redirect("/")},didRegister:function(a){var b=this.profileForResponse(a);this.session.register(b),this.redirect("/")},didLogout:function(){this.session.logout(),this.redirect("/")},profileForResponse:function(a){var b={UID:a.UID,firstName:a.profile.firstName,lastName:a.profile.lastName,age:a.profile.age,zip:a.zip};return b},redirect:function(a){var b=this.getRedirectUrl(a);b&&(location.href=b)},getRedirectUrl:function(a){var b=this.getQueryParam("dest"),c=this.getQueryParam("anchor");return 0===b.indexOf("/")?""!==c?b+"#"+c:b:a},getQueryParam:function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null===c?"":decodeURIComponent(c[1].replace(/\+/g," "))}};var e=function(a,b,c){this.config=a,this.screenSet=b,this.session=c};e.prototype={render:function(){this.show(this.getCurrentScreen())},show:function(a){"gigya-logout-screen"!==a?gigya.accounts.showScreenSet({screenSet:this.screenSet,startScreen:a,containerID:"profile-content"}):gigya.accounts.logout({cid:this.session.getUserID()})},getCurrentScreen:function(){var a=this.config.current_page;return this.pageToScreenSet(a)},screenSets:{join:"gigya-register-screen",login:"gigya-login-screen",logout:"gigya-logout-screen","forgot-password":"gigya-forgot-password-screen",account:"gigya-update-profile-screen"},pageToScreenSet:function(a){var b=this.screenSets[a];return b?b:"gigya-login-screen"}};var f=function(){this.config=window.gigya_profile_meta;var a="register"===this.config.current_page;this.store=new b,this.session=new c(this.store),this.controller=new d(this.session,a)};f.prototype={run:function(){var a=this.getCurrentPage();if(this.store.isEnabled()){if(this.store.load(),this.session.isLoggedIn()&&("login"===a||"register"===a||"forgot-password"==a))return void this.controller.redirect("/");this.screenSetView=new e(this.config,this.getCurrentScreenSet(),this.session),this.screenSetView.render()}else"cookies-required"!==a&&this.controller.redirect("/members/cookies-required")},loggedInPages:["logout","account"],isLoggedInPage:function(a){return-1!==_.indexOf(this.loggedInPages,a)},getCurrentPage:function(){return this.config.current_page},getCurrentScreenSet:function(){switch(this.getCurrentPage()){case"account":return"GMR-ProfileUpdate";default:return"GMR-RegistrationLogin"}}},a(document).ready(function(){var a=new f;a.run()})}(jQuery);