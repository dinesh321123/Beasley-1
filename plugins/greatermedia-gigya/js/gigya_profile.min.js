!function(a){var b=function(){this.cookieValue={}};b.prototype={isEnabled:function(){return Cookies.enabled},set:function(a,b){this.cookieValue[a]=b},get:function(a){var b=this.cookieValue[a];return b},save:function(a){var b=this.getCookieOptions(a);Cookies.set(this.getCookieName(),this.serialize(this.cookieValue),b)},load:function(){if(this.isEnabled()){var a=Cookies.get(this.getCookieName());this.cookieValue=this.deserialize(a)}},clear:function(){var a={path:this.getCookiePath(),domain:this.getCookieDomain()};Cookies.expire(this.getCookieName(),a),this.cookieValue={}},getCookieOptions:function(a){return{path:this.getCookiePath(),domain:this.getCookieDomain(),secure:this.isSecurePage(),expires:this.getCookieTimeout(a)}},getCookieName:function(){return"gigya_profile"},getCookiePath:function(){return"/"},getCookieDomain:function(){return location.hostname},getCookieTimeout:function(a){return a?31536e3:1800},serialize:function(a){var b=JSON.stringify(a);return window.btoa?btoa(b):b},deserialize:function(a){if(a){var b;try{window.atob&&(a=atob(a)),b=JSON.parse(a)}catch(c){}finally{this.isObject(b)||(b={})}return b}return{}},isObject:function(a){return!!a&&a.constructor===Object},isSecurePage:function(){return"https:"===location.protocol}};var c=function(a){this.store=a};c.prototype={isEnabled:function(){return this.store.isEnabled()},isLoggedIn:function(){return!!this.getUserID()},register:function(a){this.login(a)},login:function(a){for(var b in a)a.hasOwnProperty(b)&&this.store.set(b,a[b]);this.store.save(!0)},logout:function(){this.store.clear()},getUserID:function(){return this.store.get("UID")},getUserField:function(a){return this.isLoggedIn()?this.store.get(a):null}};var d=function(b,c){this.session=b,this.willRegister=!!c,gigya.accounts.addEventHandlers({onLogin:a.proxy(this.didLogin,this),onLogout:a.proxy(this.didLogout,this)})};d.prototype={didLogin:function(a){if(this.willRegister)return this.willRegister=!1,void this.didRegister(a);var b=this.profileForResponse(a);this.session.login(b),this.redirect("/")},didRegister:function(a){var b=this.profileForResponse(a);this.session.register(b),this.redirect("/")},didLogout:function(){this.session.logout(),this.redirect("/")},profileForResponse:function(a){var b={UID:a.UID,firstName:a.profile.firstName,lastName:a.profile.lastName,age:a.profile.age,zip:a.zip};return a.profile.thumbnailURL&&(b.thumbnailURL=a.profile.thumbnailURL),b},redirect:function(a){var b=this.getRedirectUrl(a);b&&(location.href=b)},getRedirectUrl:function(a){var b=this.getQueryParam("dest"),c=this.getQueryParam("anchor");return 0===b.indexOf("/")?""!==c?b+"#"+c:b:a},getQueryParam:function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null===c?"":decodeURIComponent(c[1].replace(/\+/g," "))}};var e=function(b,c,d){this.config=b,this.screenSet=c,this.session=d,this.activeScreenID="",this.didBeforeScreenHandler=a.proxy(this.didBeforeScreen,this),this.didAfterScreenHandler=a.proxy(this.didAfterScreen,this),this.didErrorHandler=a.proxy(this.didError,this),this.didLogoutClickHandler=a.proxy(this.didLogoutClick,this),this.loadLabels()};e.prototype={render:function(){this.show(this.getCurrentScreen());var b=a(".profile-page__sidebar .profile-header-link");b.on("click",a.proxy(this.didProfileHeaderClick,this))},loadLabels:function(){for(var a=["join","login","logout","forgot-password","account"],b=0;b<a.length;b++)this.loadLabel(a[b])},loadLabel:function(a){var b=a,c=a;this.screenLabels[b]||(this.screenLabels[b]={header:"",message:""}),this.config[c+"_header"]&&(this.screenLabels[b].header=this.config[c+"_header"]),this.config[c+"_message"]&&(this.screenLabels[b].message=this.config[c+"_message"])},show:function(a){this.activeScreenID=a,gigya.accounts.showScreenSet({screenSet:this.screenSet,startScreen:a,containerID:"profile-content",onBeforeScreenLoad:this.didBeforeScreenHandler,onAfterScreenLoad:this.didAfterScreenHandler,onError:this.didErrorHandler,onBeforeSubmit:this.didBeforeSubmitHandler,onFieldChanged:this.didBeforeSubmitHandler}),"gigya-logout-screen"===a&&gigya.accounts.logout({cid:this.session.getUserID()})},getCurrentScreen:function(){var a=this.config.current_page;return this.pageToScreenSet(a)},getActiveScreen:function(){return this.getPageForScreenID(this.activeScreenID)},getPageForScreenID:function(a){switch(a){case"gigya-login-screen":case"gigya-login-success-screen":return"login";case"gigya-logout-screen":return"logout";case"gigya-register-screen":case"gigya-register-complete-screen":case"gigya-register-success-screen":return"join";case"gigya-update-profile-screen":case"gigya-update-profile-success-screen":case"gigya-change-password-screen":case"gigya-change-password-success-screen":return"account";case"gigya-forgot-password-screen":case"gigya-forgot-password-sent-screen":return"forgot-password";default:throw new Error("Unknown activeScreenID: "+this.activeScreenID)}},screenSets:{join:"gigya-register-screen",login:"gigya-login-screen",logout:"gigya-logout-screen","forgot-password":"gigya-forgot-password-screen",account:"gigya-update-profile-screen"},screenLabels:{join:{header:"Register",message:"Membership gives you access to all areas of the site, including full membership-only contests and the ability to submit content to share with the site and other members."},login:{header:"Login",message:"Please enter your login details to access full membership-only contests and the ability to submit content to share with the site and other members."},account:{header:"Manage Your Account",message:"Help us get to know you better, manage your communication preferences, or change your password."},"forgot-password":{header:"Password Reset",message:"Forgot your password? No worries, it happens. We'll send you a password reset email."},"cookies-required":{header:"Cookies Required",message:"It doesn't look like your browser is letting us set a cookie. These small bits of information are stored in your browser and allow us to ensure you stay logged in. They are required to use the site and can generally be authorized in your browser's preferences or settings screen."}},pageToScreenSet:function(a){var b=this.screenSets[a];return b?b:"gigya-login-screen"},didBeforeScreen:function(a){var b=a.nextScreen;this.updateSidebar(this.getPageForScreenID(b))},didAfterScreen:function(a){this.activeScreenID=a.currentScreen,this.scrollToTop(),"gigya-update-profile-screen"===a.currentScreen&&this.registerLogoutButton()},registerLogoutButton:function(){var b=a("#gigya-update-profile-screen .logout-button");b.one("click",this.didLogoutClickHandler)},didLogoutClick:function(){return this.show("gigya-logout-screen"),gigya.accounts.logout(),!1},didError:function(a){console&&console.log&&console.log("didError",a)},scrollToTop:function(){var b=a("html, body"),c=a("#profile-content"),d={scrollTop:c.offset().top};b.animate(d,500)},updateSidebar:function(b){var c=a(".profile-page__sidebar .profile-header-text"),d=a(".profile-page__sidebar .profile-message"),e=a(".profile-page__sidebar .profile-header-sep"),f=a(".profile-page__sidebar .profile-header-link"),g=this.screenLabels[b];"login"===b?(f.text(this.screenLabels.join.header),f.css("display","inline"),e.css("display","inline")):"join"===b?(f.text(this.screenLabels.login.header),f.css("display","inline"),e.css("display","inline")):(f.css("display","none"),e.css("display","none")),c.text(g.header),d.html(g.message)},didProfileHeaderClick:function(){var b=(a(".profile-page__sidebar .profile-header-link"),this.getActiveScreen());return"login"===b?this.show("gigya-register-screen"):"join"===b&&this.show("gigya-login-screen"),!1}};var f=function(){this.config=window.gigya_profile_meta;var a="register"===this.config.current_page;this.store=new b,this.session=new c(this.store),this.controller=new d(this.session,a)};f.prototype={run:function(){var a=this.getCurrentPage();if(this.store.isEnabled()){if(this.store.load(),this.session.isLoggedIn()){if("login"===a||"register"===a||"forgot-password"==a)return void this.controller.redirect("/")}else if("account"===a)return void this.controller.redirect("/members/login?dest=%2Fmembers%2Faccount");this.screenSetView=new e(this.config,this.getCurrentScreenSet(),this.session),this.screenSetView.controller=this.controller,this.screenSetView.render()}else"cookies-required"!==a&&this.controller.redirect("/members/cookies-required")},loggedInPages:["logout","account"],isLoggedInPage:function(a){return-1!==_.indexOf(this.loggedInPages,a)},getCurrentPage:function(){return this.config.current_page},getCurrentScreenSet:function(){return"GMR-CustomScreenSet"}};var g=new f;a(document).ready(function(){g.run()}),window.is_gigya_user_logged_in=function(){return g.session.isEnabled()&&g.session.isLoggedIn()},window.get_gigya_user_id=function(){return g.session.getUserID()},window.get_gigya_user_field=function(a){return g.session.getUserField(a)};var h=function(a){return a=""+a,a=a.replace(/[!'()*]/g,escape),a=encodeURIComponent(a)},i=function(a){var b,c=[];for(var d in a)a.hasOwnProperty(d)&&(b=a[d],b=h(b),d=h(d),c.push(d+"="+b));return c.join("&")},j="members";window.gigya_profile_path=function(a,b){var c="/"+j+"/"+a;return b?c+"?"+i(b):c},a(document).on("pjax:beforeSend",function(a,b,c){var d=c.url,e=document.createElement("a");e.href=d;var f=e.search.replace("_pjax=.page-wrap","");f=f.replace("_pjax=.main","");var g=e.pathname+f;return 0===g.indexOf("/members/")?(location.href=g,!1):!0})}(jQuery);