!function(a){var b=new WpAjaxApi(window.gigya_profile_meta),c=function(){this.cookieValue={}};c.prototype={isEnabled:function(){return Cookies.enabled},set:function(a,b){this.cookieValue[a]=b},get:function(a){var b=this.cookieValue[a];return b},save:function(a){var b=this.getCookieOptions(a);Cookies.set(this.getCookieName(),this.serialize(this.cookieValue),b),Cookies.expire("livefyre_token",b)},load:function(){if(this.isEnabled()){var a=Cookies.get(this.getCookieName());this.cookieValue=this.deserialize(a)}},clear:function(){var a={path:this.getCookiePath(),domain:this.getCookieDomain()};Cookies.expire(this.getCookieName(),a),Cookies.expire("livefyre_token",a),this.cookieValue={}},getCookieOptions:function(a){return{path:this.getCookiePath(),domain:this.getCookieDomain(),secure:this.isSecurePage(),expires:this.getCookieTimeout(a)}},getCookieName:function(){return"gigya_profile"},getCookiePath:function(){return"/"},getCookieDomain:function(){return location.hostname},getCookieTimeout:function(a){return a?31536e3:1800},serialize:function(a){var b=JSON.stringify(a);return window.btoa?btoa(b):b},deserialize:function(a){if(a){var b;try{window.atob&&(a=atob(a)),b=JSON.parse(a)}catch(c){}finally{this.isObject(b)||(b={})}return b}return{}},isObject:function(a){return!!a&&a.constructor===Object},isSecurePage:function(){return"https:"===location.protocol}};var d=function(a){this.store=a};d.prototype={isEnabled:function(){return this.store.isEnabled()},isLoggedIn:function(){return!!this.getUserID()},save:function(a){for(var b in a)a.hasOwnProperty(b)&&this.store.set(b,a[b]);this.store.save(!0)},register:function(a){return this.save(a),b.request("register_account",{})},login:function(a){return this.save(a),b.request("gigya_login",{})},update:function(a){this.store.clear(),this.save(a)},logout:function(){this.store.clear()},getUserID:function(){return this.store.get("UID")},getUserField:function(a){return this.isLoggedIn()?this.store.get(a):null}};var e=function(b,c){this.session=b,this.willRegister=!!c,gigya.accounts.addEventHandlers({onLogin:a.proxy(this.didLogin,this),onLogout:a.proxy(this.didLogout,this)})};e.prototype={didLogin:function(a){if(this.willRegister)return this.willRegister=!1,void this.didRegister(a);var b=this.profileForResponse(a),c=this;this.session.login(b).then(function(){c.redirect("/","login")}).fail(function(){c.redirect("/",login)})},didRegister:function(a){var b=this.profileForResponse(a),c=this;this.session.register(b).then(function(){c.redirect("/")}).fail(function(){c.redirect("/")})},didLogout:function(){this.session.logout(),this.redirect("/")},didProfileUpdate:function(a,c){var d={UID:this.session.getUserID(),profile:a,data:c},e=this.profileForResponse(d);this.session.update(e),b.request("update_account",{})},profileForResponse:function(a){var b={UID:a.UID,firstName:a.profile.firstName,lastName:a.profile.lastName,age:a.profile.age,zip:a.profile.zip,nielsen_optout:a.data?a.data.nielsen_optout:!1};return a.profile.thumbnailURL&&(b.thumbnailURL=a.profile.thumbnailURL),b},redirect:function(a,b){var c=this.getRedirectUrl(a);"login"===b&&0===c.indexOf("/members/account")&&(c="/"),c&&(location.replace?location.replace(c):location.href=c)},getRedirectUrl:function(a){var b=this.getQueryParam("dest"),c=this.getQueryParam("anchor");return 0===b.indexOf("/")?""!==c?b+"#"+c:b:a},getQueryParam:function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null===c?"":decodeURIComponent(c[1].replace(/\+/g," "))},resetPassword:function(c){var d={api_key:this.getQueryParam("apiKey"),password_reset_token:this.getQueryParam("pwrt"),new_password:c};this.screenSetView.show("gigya-reset-link-password-progress-screen"),b.request("reset_password",d).then(a.proxy(this.didResetPassword,this)).fail(a.proxy(this.didResetPasswordError,this))},didResetPassword:function(a){a.success?this.screenSetView.show("gigya-reset-link-password-success-screen"):this.didResetPasswordError(a)},didResetPasswordError:function(a){this.resetError=a.data,this.screenSetView.show("gigya-reset-link-password-screen")}};var f=function(b,c,d){this.config=b,this.screenSet=c,this.session=d,this.activeScreenID="",this.submitTimeoutID=-1,this.didBeforeScreenHandler=a.proxy(this.didBeforeScreen,this),this.didAfterScreenHandler=a.proxy(this.didAfterScreen,this),this.didErrorHandler=a.proxy(this.didError,this),this.didLogoutClickHandler=a.proxy(this.didLogoutClick,this),this.didBeforeSubmitHandler=a.proxy(this.didBeforeSubmit,this),this.didFieldChangeHandler=a.proxy(this.didFieldChange,this),this.loadLabels()};f.prototype={render:function(){this.show(this.getCurrentScreen());var b=a(".profile-page__sidebar .profile-header-link");b.on("click",a.proxy(this.didProfileHeaderClick,this))},loadLabels:function(){for(var a=["join","login","logout","forgot-password","account"],b=0;b<a.length;b++)this.loadLabel(a[b])},loadLabel:function(a){var b=a,c=a;this.screenLabels[b]||(this.screenLabels[b]={header:"",message:""}),this.config[c+"_header"]&&(this.screenLabels[b].header=this.config[c+"_header"]),this.config[c+"_message"]&&(this.screenLabels[b].message=this.config[c+"_message"])},show:function(a){this.activeScreenID=a,gigya.accounts.showScreenSet({screenSet:this.screenSet,startScreen:a,containerID:"profile-content",onBeforeScreenLoad:this.didBeforeScreenHandler,onAfterScreenLoad:this.didAfterScreenHandler,onError:this.didErrorHandler,onBeforeSubmit:this.didBeforeSubmitHandler,onFieldChanged:this.didFieldChangeHandler}),"gigya-logout-screen"===a&&gigya.accounts.logout({cid:this.session.getUserID()})},getCurrentScreen:function(){var a=this.config.current_page;return this.pageToScreenSet(a)},getActiveScreen:function(){return this.getPageForScreenID(this.activeScreenID)},getPageForScreenID:function(a){switch(a){case"gigya-login-screen":case"gigya-login-success-screen":return"login";case"gigya-logout-screen":return"logout";case"gigya-register-screen":case"gigya-register-complete-screen":case"gigya-register-success-screen":return"join";case"gigya-update-profile-screen":case"gigya-update-profile-success-screen":case"gigya-change-password-screen":case"gigya-change-password-success-screen":return"account";case"gigya-forgot-password-screen":case"gigya-forgot-password-sent-screen":return"forgot-password";case"gigya-reset-link-password-screen":case"gigya-reset-link-password-progress-screen":case"gigya-reset-link-password-success-screen":return"reset-password";case"gigya-verify-email-screen":case"gigya-resend-verification-code-screen":case"gigya-resend-verification-code-success-screen":case"gigya-resend-verification-code-update-screen":case"gigya-resend-verification-code-update-success-screen":return"verify-email";default:throw new Error("Unknown activeScreenID: "+this.activeScreenID)}},screenSets:{join:"gigya-register-screen",login:"gigya-login-screen",logout:"gigya-logout-screen","forgot-password":"gigya-forgot-password-screen",account:"gigya-update-profile-screen","reset-password":"gigya-reset-link-password-screen","verify-email":"gigya-verify-email-screen"},screenLabels:{join:{header:"Register",message:"Membership gives you access to all areas of the site, including full membership-only contests and the ability to submit content to share with the site and other members."},login:{header:"Login",message:"Please enter your login details to access full membership-only contests and the ability to submit content to share with the site and other members."},account:{header:"Manage Your Account",message:"Help us get to know you better, manage your communication preferences, or change your password."},"forgot-password":{header:"Password Reset",message:"Forgot your password? No worries, it happens. We'll send you a password reset email."},"cookies-required":{header:"Cookies Required",message:"It doesn't look like your browser is letting us set a cookie. These small bits of information are stored in your browser and allow us to ensure you stay logged in. They are required to use the site and can generally be authorized in your browser's preferences or settings screen."},"reset-password":{header:"Reset Password",message:"Enter your new password to reset it."},"verify-email":{header:"Email Verification",message:"Please verify that your profile email belongs to you."}},pageToScreenSet:function(a){var b=this.screenSets[a];return b?b:"gigya-login-screen"},didBeforeScreen:function(a){var b=a.nextScreen;this.updateSidebar(this.getPageForScreenID(b))},didAfterScreen:function(b){switch(this.activeScreenID=b.currentScreen,this.scrollToTop(),this.initSubmitListener(),b.currentScreen){case"gigya-update-profile-screen":this.registerLogoutButton();break;case"gigya-register-complete-screen":this.controller.willRegister=!0,this.updateGeoFields();break;case"gigya-update-profile-success-screen":var c=this.profileFromEvent(b),d=this.dataFromEvent(b);this.controller.didProfileUpdate(c,d);break;case"gigya-reset-link-password-screen":if(this.controller.resetError){var e=a("#gigya-reset-link-password-screen .reset-link-password-error-msg");e.text(this.controller.resetError),e.css("display","block"),e.css("visibility","visible")}break;case"gigya-resend-verification-code-screen":case"gigya-resend-verification-code-update-screen":if(b.profile.email){var f=a("#resend-email");f.val(b.profile.email)}}},profileFromEvent:function(a){var b=a.profile,c=a.response.requestParams.profile;for(var d in c)c.hasOwnProperty(d)&&b.hasOwnProperty(d)&&(b[d]=c[d]);return c.birthYear&&(b.age=this.calcAge(c.birthYear)),b},dataFromEvent:function(a){var b=a.data,c=a.response.requestParams.data;for(var d in c)c.hasOwnProperty(d)&&b.hasOwnProperty(d)&&(b[d]=c[d]);return b},calcAge:function(a){var b=new Date,c=b.getFullYear(),d=Math.max(0,c-a);return d},registerLogoutButton:function(){var b=a("#gigya-update-profile-screen .logout-button");b.one("click",this.didLogoutClickHandler)},didLogoutClick:function(){return this.show("gigya-logout-screen"),gigya.accounts.logout(),!1},didError:function(a){console&&console.log&&console.log("didError",a)},scrollToTop:function(){var b=a("html, body"),c=a("#profile-content"),d={scrollTop:c.offset().top};b.animate(d,500)},updateSidebar:function(b){var c=a(".profile-page__sidebar .profile-header-text"),d=a(".profile-page__sidebar .profile-message"),e=a(".profile-page__sidebar .profile-header-sep"),f=a(".profile-page__sidebar .profile-header-link"),g=this.screenLabels[b];"login"===b?(f.text(this.screenLabels.join.header),f.css("display","inline"),e.css("display","inline")):"join"===b?(f.text(this.screenLabels.login.header),f.css("display","inline"),e.css("display","inline")):(f.css("display","none"),e.css("display","none")),c.text(g.header),d.html(g.message)},didProfileHeaderClick:function(){var b=(a(".profile-page__sidebar .profile-header-link"),this.getActiveScreen());return"login"===b?this.show("gigya-register-screen"):"join"===b&&this.show("gigya-login-screen"),!1},didBeforeSubmit:function(a){return"gigya-reset-link-password-form"===a.form?(this.controller.resetPassword(a.formData.newPassword),!1):void 0},didFieldChange:function(b){if("gigya-update-profile-screen"===b.screen&&"profile.email"===b.field){var c=a(".verify-email-link");c.css("display","inline-block")}},getStates:function(){var b=a("#profile-state option"),c=[];return b.each(function(b,d){var e=a(d);c.push({label:e.text(),value:e.val()})}),c},updateGeoFields:function(){var b=this.getStates(),c=a("#profile-city"),d=a("#profile-state"),e=c.val(),f=new g(b),h=null;try{h=f.parse(e)}catch(i){}null!==h?(c.val(h.city),d.val(h.state)):(c.val(""),d.val(""))},initSubmitListener:function(){var b=a(".gigya-input-submit-button");b.click(a.proxy(this.didInputSubmitClick,this))},didInputSubmitClick:function(){clearTimeout(this.submitTimeoutID),this.submitTimeoutID=setTimeout(a.proxy(this.checkForSubmitErrors,this),150)},checkForSubmitErrors:function(){var b=a(".gigya-error-msg-active");if(b.length>0){var c=a(b[0]),d={scrollTop:c.offset().top-50},e=a("html, body");e.animate(d,500)}}};var g=function(a){this.states=a};g.prototype={parse:function(a){var b,c,d=a.split(","),e=d.length,f=this.trim(d[e-1]);"United States"===f||"US"===f||"USA"===f?(b=this.trim(d[e-2]),c=this.trim(d.slice(0,e-2).join(", "))):(b=f,c=this.trim(d.slice(0,e-1).join(", ")));var g=this.findState(b);return g?{state:g,city:c}:null},findState:function(a){for(var b,c=this.states.length,d=0;c>d;d++)if(b=this.states[d],b.label===a)return b.value;return null},trim:function(a){var b=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;return a.replace(b,"")}};var h=function(){this.config=window.gigya_profile_meta;var a="register"===this.config.current_page;this.store=new c,this.session=new d(this.store),this.controller=new e(this.session,a)};h.prototype={run:function(){var a=this.getCurrentPage();if(this.store.isEnabled()){if(this.store.load(),this.session.isLoggedIn()){if("login"===a||"register"===a||"forgot-password"==a)return void this.controller.redirect("/")}else if("account"===a)return void this.controller.redirect("/members/login?dest=%2Fmembers%2Faccount");this.screenSetView=new f(this.config,this.getCurrentScreenSet(),this.session),this.screenSetView.controller=this.controller,this.controller.screenSetView=this.screenSetView,this.screenSetView.render()}else"cookies-required"!==a&&this.controller.redirect("/members/cookies-required")},rerun:function(a){this.config.current_page=a,this.controller.screenSetView.render()},loggedInPages:["logout","account"],isLoggedInPage:function(a){return-1!==_.indexOf(this.loggedInPages,a)},getCurrentPage:function(){return this.config.current_page},getCurrentScreenSet:function(){return"GMR-CustomScreenSet"}};var i=new h;a(document).ready(function(){i.run()}),window.is_gigya_user_logged_in=function(){return i.session.isEnabled()&&i.session.isLoggedIn()},window.get_gigya_user_id=function(){return i.session.getUserID()},window.get_gigya_user_field=function(a){return i.session.getUserField(a)};var j=function(a){return a=""+a,a=a.replace(/[!'()*]/g,escape),a=encodeURIComponent(a)},k=function(a){var b,c=[];for(var d in a)a.hasOwnProperty(d)&&a[d]&&(b=a[d],b=j(b),d=j(d),c.push(d+"="+b));return c.join("&")},l="members",m=function(a){var b=document.createElement("a");b.href=a;var c=b.pathname,d=c.split("/"),e=d.length;return""===d[e-1]?d[e-2]:d[e-1]};window.gigya_profile_path=function(a,b){b||(b={}),b.dest||"login"!==a&&"logout"!==a||(b.dest=location.pathname);var c="/"+l+"/"+a,d=m(b.dest);a===d&&(b.dest=void 0);var e=k(b);return""!==e?c+"?"+k(b):c};var n=function(a){var b=document.createElement("a");b.href=a;var c=b.search.replace("_pjax=.page-wrap","");c=c.replace("_pjax=.main","");var d=b.pathname+c;return d};a(document).on("pjax:beforeSend",function(a,b,c){var d=n(c.url);return 0===d.indexOf("/members/")?window.gigya_profile_loaded?!0:(location.href=d,!1):!0}),a(document).on("pjax:end",function(a,b,c){var d=n(c.url);0===d.indexOf("/members/account")?i.rerun("account"):0===d.indexOf("/members/logout")&&i.rerun("logout")}),window.gigya_profile_loaded=!0}(jQuery);