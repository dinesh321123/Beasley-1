var $=jQuery;!function(){function a(a,b){var c=this;c.gg=a,c.player=b,c.is_playing=!1}var b;window.bindNielsenSDKEvents=function(f,g){var h=g.addEventListener?!0:!1,i={"track-cue-point":e,"ad-break-cue-point":d,"stream-status":c};b=new a(f,g);for(var j in i)h?g.addEventListener(j,i[j]):g.attachEvent(j,i[j])};var c=function(a){("LIVE_PAUSE"===a.data.code||"LIVE_STOP"===a.data.code)&&f()},d=function(a){var c=a.data.adBreakData;b.is_playing&&f(),g("Send ad block cue metadata event to Nielsen SDK."),b.gg.ggPM(15,{assetid:c.cueID,title:c.cueTitle,length:c.duration/1e3,type:"midroll"}),g("Send playhead position event to Nielsen SDK."),b.gg.ggPM(49,Date.now()/1e3),b.is_playing=!0},e=function(a){var c=a.data.cuePoint;b.is_playing&&f(),g("Send track cue metadata event to Nielsen SDK."),b.gg.ggPM(15,{assetid:c.cueID,title:c.cueTitle,length:c.cueTimeDuration,type:"content"}),g("Send playhead position event to Nielsen SDK."),b.gg.ggPM(49,Date.now()/1e3),b.is_playing=!0},f=function(){b.is_playing&&(g("Send stop event to Nielsen SDK."),b.gg.ggPM(7,Date.now()/1e3),b.is_playing=!1)},g=function(a){gmr.debug&&console&&console.log(a)}}(),function(a,b){"use strict";function c(){is_gigya_user_logged_in()?a.support.pjax&&a(d).pjax("a:not(.ab-item)",".main",{fragment:".main",maxCacheLength:500,timeout:1e4}):gmr.wpLoggedIn&&a.support.pjax&&a(d).pjax("a:not(.ab-item)",".page-wrap",{fragment:".page-wrap",maxCacheLength:500,timeout:1e4})}var d=b.document,e=(d.querySelectorAll("body"),a("#playButton")),f=(a("#pauseButton"),a("#resumeButton")),g=a("#live-stream__listen-now"),h=a("#live-stream__login"),i=a(".header__account--btn");e.on("click",function(){c()}),f.on("click",function(){c()}),e.on("click",function(){is_gigya_user_logged_in()||(Cookies.set("gmlp_play_button_pushed",1),Cookies.set("gmr_play_live_audio",0))}),h.on("click",function(){is_gigya_user_logged_in()||(Cookies.set("gmlp_play_button_pushed",1),Cookies.set("gmr_play_live_audio",0))}),g.on("click",function(){is_gigya_user_logged_in()||(Cookies.set("gmlp_play_button_pushed",1),Cookies.set("gmr_play_live_audio",0))}),i.on("click",function(){is_gigya_user_logged_in()||Cookies.set("gmr_play_live_audio",0)})}(jQuery,window),function(a,b,c){"use strict";function d(a,b,c){null!=a&&(a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c))}function e(){var b=gmr.intervals.live_streaming;b>0&&($("Live stream interval set"),Ob=setInterval(function(){a(rb).trigger("liveStreamPlaying.gmr"),$("Live stream interval reached")},60*b*1e3))}function f(){var b=gmr.intervals.inline_audio;b>0&&($("Inline audio interval set"),Nb=setInterval(function(){a(rb).trigger("inlineAudioPlaying.gmr"),$("Inline audio interval reached")},60*b*1e3))}function g(){clearInterval(Ob),$("Live stream interval off")}function h(){clearInterval(Nb),$("Inline audio interval off")}function i(){return bowser.firefox?["Flash","Html5"]:bowser.safari?["Html5","Flash"]:bowser.chrome?["Flash","Html5"]:["Html5","Flash"]}function j(){var a=i();$("+++ initPlayer - techPriority = "+a.join(", "));var b={coreModules:[{id:"MediaPlayer",playerId:"td_container",isDebug:!1,techPriority:a,timeShift:{active:0,max_listening_time:35},geoTargeting:{desktop:{isActive:!1},iOS:{isActive:!1},android:{isActive:!1}},plugins:[{id:"vastAd"}]},{id:"NowPlayingApi"},{id:"Npe"},{id:"PlayerWebAdmin"},{id:"SyncBanners",elements:[{id:"td_synced_bigbox",width:300,height:250}]},{id:"TargetSpot"}]};require(["tdapi/base/util/Companions"],function(a){nb=new a}),hb=new TdPlayerApi(b),hb.addEventListener?(hb.addEventListener("player-ready",D),hb.addEventListener("configuration-error",R),hb.addEventListener("module-error",S)):hb.attachEvent&&(hb.attachEvent("player-ready",D),hb.attachEvent("configuration-error",R),hb.attachEvent("module-error",S)),hb.loadModules()}function k(){null!=wb&&d(wb,Qb,B),null!=xb&&d(xb,Qb,A),null!=Hb&&d(Hb,Qb,ab)}function l(){null!==sb&&(sb.classList.add("stream__active"),vb.classList.add(!0===ob&&b.innerWidth<=767?"live-player__login":"live-player__muted"),xb.classList.contains("live-player__muted")||xb.classList.add("live-player__muted"),xb.classList.contains("resume__live")&&xb.classList.remove("resume__live"),!0===ob?(Db.style.display="none",Cb.style.display="inline-block"):(Db.style.display="inline-block",Cb.style.display="none"),!1===ob&&null!=yb&&yb.classList.add("loading"),!0===ob&&null!=wb?wb.classList.contains("live-player__muted")&&wb.classList.remove("live-player__muted"):wb.classList.add("live-player__muted"))}function m(){null!==sb&&(xb.classList.contains("live-player__muted")&&(xb.classList.remove("live-player__muted"),xb.classList.add("resume__live")),Cb.style.display="inline-block",Db.style.display="none",wb.classList.add("live-player__muted"))}function n(){null!==sb&&(vb.classList.add(!0===ob&&b.innerWidth<=767?"live-player__login":"live-player__muted"),rb.classList.contains("live-player--active")&&rb.classList.remove("live-player--active"),Cb.style.display="inline-block",Db.style.display="none",wb.classList.add("live-player__muted"),xb.classList.contains("live-player__muted")&&(xb.classList.remove("live-player__muted"),xb.classList.add("resume__live")),xb.classList.add("resume__audio"))}function o(){var a,b=document.querySelectorAll(".audio__time");for(a=0;a<b.length;++a)b[a].classList.add("playing");null!=ub&&ub.classList.add("audio__playing"),null!=Jb&&Jb.classList.add("audio__playing"),null!=tb&&tb.classList.add("playing"),null!=Kb&&Kb.classList.add("playing"),null!=Cb&&setTimeout(function(){Cb.innerHTML="Switch to Live Stream"},1e3)}function p(b){var c,d=b.target,e=d.parentNode,f=e.nextElementSibling,g=f.nextElementSibling,h=document.querySelectorAll(".audio__time"),i=document.querySelector(".podcast__runtime");if(a(".playing__current").removeClass("playing__current"),null!=Bb&&(rb.classList.contains("single-show")||rb.classList.contains("post-type-archive-podcast")||rb.classList.contains("single-podcast")))f.classList.add("playing__current"),g.classList.add("playing");else{for(c=0;c<h.length;++c)null!=h[c]&&(h[c].classList.add("playing"),h[c].classList.add("playing__current"));i.classList.add("playing")}}function q(){var a,b=document.querySelectorAll(".audio__time"),c=document.querySelectorAll(".podcast__runtime");for(a=0;a<b.length;++a)null!=b[a]&&b[a].classList.contains("playing")&&b[a].classList.remove("playing"),null!=b[a]&&b[a].classList.contains("playing__current")&&b[a].classList.remove("playing__current");for(null!=ub&&ub.classList.remove("audio__playing"),null!=Jb&&Jb.classList.remove("audio__playing"),null!=tb&&tb.classList.remove("playing"),a=0;a<c.length;++a)null!=c[a]&&c[a].classList.contains("playing")&&c[a].classList.remove("playing");null!=Kb&&Kb.classList.remove("playing")}function r(){b.innerWidth<=767&&(""===Lb.innerHTML?(Ib.classList.add("on-air__npe"),Mb.classList.add("full__width")):Ib.classList.contains("on-air__npe")&&(Ib.classList.remove("on-air__npe"),Mb.classList.remove("full__width")))}function s(){null!=vb&&vb.classList.add("play-btn--heartbeat"),null!=tb&&tb.classList.add("live-player--heartbeat")}function t(){null!=vb&&vb.classList.contains("play-btn--heartbeat")&&vb.classList.remove("play-btn--heartbeat"),null!=tb&&tb.classList.contains("live-player--heartbeat")&&tb.classList.remove("live-player--heartbeat")}function u(){Pb=1,$("-- Player Initialized By Click ---")}function v(){Pb=!0,$("-- Player Ready to Go ---")}function w(){is_gigya_user_logged_in()&&Pb===!0&&(m(),b.innerWidth>=768?z():y())}function x(){is_gigya_user_logged_in()?(null!=vb&&d(vb,Qb,function(){Pb===!0?(m(),b.innerWidth>=768?z():y()):u()}),null!=Cb&&d(Cb,Qb,Rb)):(null!=vb&&d(vb,"click",function(){b.location.href=Gb,v()}),null!=Cb&&d(Cb,"click",function(){b.location.href=Gb}),null!=Eb&&b.innerWidth<=767&&d(Eb,"click",function(){b.location.href=Gb}))}function y(){var a=gmr.callsign;return""===a?void alert("Please enter a Station"):(!0===ob&&Rb(),$("playLiveStream - station="+a),mb&&hb.stop(),rb.classList.add("live-player--active"),tb.classList.add("live-player--active"),hb.play({station:a,timeShift:!0}),void l())}function z(){var a=gmr.callsign;if(cb(),!0===ob)Xb(),l();else{if(""===a)return void alert("Please enter a Station");$("playLiveStream - station="+a),mb&&hb.stop(),rb.classList.add("live-player--active"),tb.classList.add("live-player--active"),hb.play({station:a,timeShift:!0}),l()}}function A(){if(cb(),!0===ob)Xb(),l();else{var a=gmr.callsign;if(""===a)return void alert("Please enter a Station");$("playLiveStream - station="+a),mb&&hb.stop(),tb.classList.add("live-player--active"),hb.play({station:a,timeShift:!0}),l()}}function B(){!0===ob?(Zb(),h()):(qb=!1,hb.pause(),g()),tb.classList.contains("live-player--active")&&tb.classList.remove("live-player--active"),n()}function C(){if(""===a("#songHistoryCallsignUser").val())return void alert("Please enter a Callsign");var b="hdConnection"==a("#songHistoryConnectionTypeSelect").val();hb.NowPlayingApi.load({mount:a("#songHistoryCallsignUser").val(),hd:b,numberToFetch:15})}function D(){if(hb.MediaPlayer!==c&&(k(),hb.addEventListener?(hb.addEventListener("track-cue-point",H),hb.addEventListener("ad-break-cue-point",K),hb.addEventListener("stream-track-change",I),hb.addEventListener("hls-cue-point",J),hb.addEventListener("stream-status",T),hb.addEventListener("stream-geo-blocked",U),hb.addEventListener("timeout-alert",P),hb.addEventListener("timeout-reach",Q),hb.addEventListener("stream-select",F),hb.addEventListener("stream-start",E),hb.addEventListener("stream-stop",G)):hb.attachEvent&&(hb.attachEvent("track-cue-point",H),hb.attachEvent("ad-break-cue-point",K),hb.attachEvent("stream-track-change",I),hb.attachEvent("hls-cue-point",J),hb.attachEvent("stream-status",T),hb.attachEvent("stream-geo-blocked",U),hb.attachEvent("timeout-alert",P),hb.attachEvent("timeout-reach",Q),hb.attachEvent("stream-select",F),hb.attachEvent("stream-start",E),hb.attachEvent("stream-stop",G)),hb.setVolume(1),V("Api Ready"),1===Pb?(v(),w()):1===Cookies.get("gmlp_play_button_pushed")?(v(),w()):v(),b.innerWidth>=768&&(s(),setTimeout(t,2e3)),W(hb.MediaPlayer.tech.type),hb.addEventListener?(hb.addEventListener("list-loaded",M),hb.addEventListener("list-empty",N),hb.addEventListener("nowplaying-api-error",O)):hb.attachEvent&&(hb.attachEvent("list-loaded",M),hb.attachEvent("list-empty",N),hb.attachEvent("nowplaying-api-error",O)),a("#fetchSongHistoryByUserCallsignButton").click(function(){C()}),hb.addEventListener?hb.addEventListener("pwa-data-loaded",Y):hb.attachEvent&&hb.attachEvent("pwa-data-loaded",Y),a("#pwaButton").click(function(){X()}),b._nolggGlobalParams)){var d=new NOLCMB.ggInitialize(b._nolggGlobalParams);bindNielsenSDKEvents(d,hb)}}function E(){mb=!0,qb=!0,yb.classList.contains("loading")&&yb.classList.remove("loading"),wb.classList.contains("live-player__muted")&&wb.classList.remove("live-player__muted"),e()}function F(){a("#hasHQ").html(hb.MediaPlayer.hasHQ().toString()),a("#isHQ").html(hb.MediaPlayer.isHQ().toString()),a("#hasLow").html(hb.MediaPlayer.hasLow().toString()),a("#isLow").html(hb.MediaPlayer.isLow().toString())}function G(){mb=!1,qb=!1,L(),a("#trackInfo").html(""),a("#asyncData").html(""),a("#hasHQ").html("N/A"),a("#isHQ").html("N/A"),a("#hasLow").html("N/A"),a("#isLow").html("N/A"),g()}function H(b){$("New Track cuepoint received"),$("Title: "+b.data.cuePoint.cueTitle+" - Artist: "+b.data.cuePoint.artistName),lb&&lb!=b.data.cuePoint&&L(),b.data.cuePoint.nowplayingURL&&hb.Npe.loadNpeMetadata(b.data.cuePoint.nowplayingURL,b.data.cuePoint.artistName,b.data.cuePoint.cueTitle),lb=b.data.cuePoint,a("#trackInfo").html('<div class="now-playing__title">'+lb.cueTitle+'</div><div class="now-playing__artist">'+lb.artistName+"</div>"),setTimeout(r,1e4),a(rb).trigger("liveAudioTrack.gmr")}function I(a){$("Stream Track has changed"),$("Codec:"+a.data.cuePoint.audioTrack.codec()+" - Bitrate:"+a.data.cuePoint.audioTrack.bitRate())}function J(a){$("New HLS cuepoint received"),$("Track Id:"+a.data.cuePoint.hlsTrackId+" SegmentId:"+a.data.cuePoint.hlsSegmentId)}function K(){V("Commercial break...")}function L(){a("#npeInfo").html(""),a("#asyncData").html("")}function M(b){$("Song History loaded"),a("#asyncData").html('<br><p><span class="label label-warning">Song History:</span>');var c,d='<table class="table table-striped"><thead><tr><th>Song title</th><th>Artist name</th><th>Time</th></tr></thead>';a.each(b.data.list,function(a,b){c=new Date(Number(b.cueTimeStart)),d+="<tr><td>"+b.cueTitle+"</td><td>"+b.artistName+"</td><td>"+c.toLocaleTimeString()+"</td></tr>"}),d+="</table></p>",a("#asyncData").html("<div>"+d+"</div>")}function N(){a("#asyncData").html('<br><p><span class="label label-important">Song History is empty</span>')}function O(){$("Song History loading error",!0),a("#asyncData").html('<br><p><span class="label label-important">Song History error</span>')}function P(){$("Time Out Alert")}function Q(){$("Time Out Reached")}function R(){$("Configuration error",!0)}function S(b){var c="";a.each(b.data.errors,function(a,b){c+="ERROR : "+b.data.error.message+"<br/>"}),a("#status").html('<p><span class="label label-important">'+c+"</span><p></p>")}function T(a){$("tdplayer::onStatus"),V(a.data.status)}function U(a){$("tdplayer::onGeoBlocked"),V(a.data.text)}function V(b){$(b),a("#status").html('<p><span class="label label-success">Status: '+b+"</span></p>")}function W(b){var c=hb.version.major+"."+hb.version.minor+"."+hb.version.patch+"."+hb.version.flag,d='<p><span class="label label-info">Api version: '+c+" - Technology: "+b;hb.flash.available&&(d+=" - Your current version of flash plugin is: "+hb.flash.version.major+"."+hb.flash.version.minor+"."+hb.flash.version.rev),d+="</span></p>",a("#techInfo").html(d)}function X(){return""===a("#pwaCallsign").val()||""===a("#pwaStreamId").val()?void alert("Please enter a Callsign and a streamid"):void hb.PlayerWebAdmin.load(a("#pwaCallsign").val(),a("#pwaStreamId").val())}function Y(b){$("PlayerWebAdmin data loaded successfully"),a("#asyncData").html('<br><p><span class="label label-warning">PlayerWebAdmin:</span>');var c='<table class="table table-striped"><thead><tr><th>Key</th><th>Value</th></tr></thead>';for(var d in b.data.config)c+="<tr><td>"+d+"</td><td>"+b.data.config[d]+"</td></tr>";c+="</table></p>",a("#asyncData").html("<div>"+c+"</div>")}function Z(){for(var a,c=[],d=b.location.href.slice(b.location.href.indexOf("?")+1).split("&"),e=0;e<d.length;e++)a=d[e].split("="),c.push(a[0]),c[a[0]]=a[1];return c}function $(c,d){gmr.debug&&(b.console&&(d?console.error(c):console.log(c)),a("#debugInformation").append(c),a("#debugInformation").append("\n"))}function ab(){a("#debugInformation").html("")}function bb(){if("undefined"!=typeof Modernizr&&Modernizr.audio){var b=document.querySelectorAll(".content"),c=a(b);c.on("click",".podcast__btn--play",function(b){var c=a(b.currentTarget);p(b),Yb(c.attr("data-mp3-src")),Ub(),ac(c.attr("data-mp3-title"),c.attr("data-mp3-artist"),c.attr("data-mp3-hash"))}),c.on("click",".podcast__btn--pause",Zb)}else{var d=a(".gmr-mediaelement-fallback audio"),e=a(".podcast__play");d.mediaelementplayer(),e.hide()}}function cb(){is_gigya_user_logged_in()?a.support.pjax&&a(document).pjax("a:not(.ab-item)",".main",{fragment:".main",maxCacheLength:500,timeout:1e4}):gmr.wpLoggedIn&&a.support.pjax&&a(document).pjax("a:not(.ab-item)",".page-wrap",{fragment:".page-wrap",maxCacheLength:500,timeout:1e4})}function db(a){qb===!0||!0===ob||a.preventDefault()}function eb(){var a,b=document.querySelectorAll(".audio__progress"),c=0;for(a=0;a<b.length;++a)pb.currentTime>0&&(c=Math.floor(100/pb.duration*pb.currentTime)),b[a].style.width=c+"%"}function fb(){var a,b,c,d=document.querySelectorAll(".audio__time--remaining"),e=parseInt(pb.duration),f=parseInt(pb.currentTime),g=e-f;for(a=0;a<d.length;++a)b=g%60,b=isNaN(b)?"00":10>b?"0"+b:b,c=Math.floor(g/60)%60,isNaN(c)&&(c="0"),d[a].innerHTML=c+":"+b}function gb(){var a,b=document.querySelectorAll(".audio__time--elapsed"),c=parseInt(pb.currentTime%60),d=parseInt(pb.currentTime/60%60);for(a=0;a<b.length;++a)b[a].innerHTML=10>c?d+":0"+c:d+":"+c}var hb,ib,jb,kb,lb,mb,nb,ob=(Z().tech||"html5_flash","false"==Z().aSyncCuePointFallback?!1:!0,!1),pb=!1,qb=!1,rb=document.querySelector("body"),sb=document.getElementById("td_container"),tb=document.getElementById("live-player"),ub=document.querySelector(".live-stream__player"),vb=document.getElementById("playButton"),wb=document.getElementById("pauseButton"),xb=document.getElementById("resumeButton"),yb=document.getElementById("loadButton"),zb=document.querySelector(".podcast__btn--play"),Ab=document.querySelector(".podcast__btn--pause"),Bb=document.querySelector(".podcast-player"),Cb=document.getElementById("live-stream__listen-now"),Db=document.getElementById("live-stream__now-playing"),Eb=document.getElementById("live-stream__login"),Fb=a(document.getElementById("trackInfo")),Gb=gigya_profile_path("login"),Hb=document.getElementById("clearDebug"),Ib=document.getElementById("on-air"),Jb=document.getElementById("live-stream__status"),Kb=document.getElementById("nowPlaying"),Lb=document.getElementById("trackInfo"),Mb=document.querySelector(".live-player__stream"),Nb=null,Ob=null,Pb=(document.querySelector(".footer"),!1),Qb="click";b.tdPlayerApiReady=function(){$("--- TD Player API Loaded ---"),j()};var Rb=function(){var a=Cb.textContent,c=document.getElementById("trackInfo"),d=document.getElementById("npeInfo");!0===ob&&(pb.pause(),c.innerHTML="",d.innerHTML="",Ub(),q(),ob=!1,h()),"Switch to Live Stream"===a&&(Cb.innerHTML="Listen Live"),b.innerWidth>=768&&z()};a(document).ready(function(){x()});var Sb=a(".live-player__stream--current-name");Sb.bind("DOMSubtreeModified",function(){$("--- new stream select ---");var a=Sb.text();mb&&hb.stop(),!0===ob&&Rb(),hb.play({station:a,timeShift:!0}),tb.classList.add("live-player--active"),l()});var Tb=function(){"undefined"!=typeof hb&&"undefined"!=typeof hb.stop&&hb.stop()},Ub=function(){a(".podcast__btn--play.playing").removeClass("playing"),a(".podcast__btn--pause.playing").removeClass("playing")},Vb=function(){var b=".mp3-"+kb;a(b+" .podcast__btn--play").addClass("playing"),a(b+" .podcast__btn--pause").addClass("playing")},Wb=function(a){pb.src=a},Xb=function(){ob=!0,Tb(),pb.play(),$b(),_b(),Ub(),l(),Vb(),o(),f()},Yb=function(a){cb(),a!==pb.src&&Wb(a),Xb()},Zb=function(){pb.pause(),Ub(),ob=!1,n(),h()},$b=function(){var b=_.template('<div class="now-playing__title"><%- title %></div>'),c=a(".now-playing__title"),d='<div class="audio__title">',e='</div><div class="audio__time"><span class="audio__time--inline">(</span><div class="audio__time--elapsed"></div><span class="audio__time--inline"> / </span><div class="audio__time--remaining"></div><span class="audio__time--inline">)</span></div>';c.length>0?c.html(d+jb+e):Fb.prepend(b({title:jb}))},_b=function(){var b=_.template('<div class="now-playing__artist"><%- artist %></div>'),c=a(".now-playing__artist");c.length>0?c.text(ib):Fb.append(b({artist:ib}))},ac=function(a,b,c){jb=a,ib=b,kb=c,$b(),_b(),Vb()},bc=function(){"undefined"!=typeof Modernizr&&Modernizr.audio&&(pb=new Audio,pb.addEventListener?pb.addEventListener("ended",function(){Ub(),n(),h()}):pb.attachEvent&&pb.attachEvent("ended",function(){Ub(),n(),h()}))};a(document).bind("pjax:click",db),bc(),bb(),pb.addEventListener("timeupdate",function(){eb(),gb(),fb()},!1),d(zb,Qb,o),d(Ab,Qb,Zb),a(document).on("pjax:end",function(){bb(),Vb(),d(zb,Qb,o),d(Ab,Qb,Zb)})}(jQuery,window);