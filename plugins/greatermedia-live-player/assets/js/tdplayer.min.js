!function(a,b,c){"use strict";function d(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c)}function e(){return bowser.firefox?["Flash"]:bowser.safari?["Html5"]:["Html5","Flash"]}function f(){var a=e();console.log("+++ initPlayer - techPriority = ",a);var b={coreModules:[{id:"MediaPlayer",playerId:"td_container",isDebug:!0,techPriority:["Flash","Html5"],timeShift:{active:0,max_listening_time:35},geoTargeting:{desktop:{isActive:!1},iOS:{isActive:!1},android:{isActive:!1}},plugins:[{id:"vastAd"}]},{id:"NowPlayingApi"},{id:"Npe"},{id:"PlayerWebAdmin"},{id:"SyncBanners",elements:[{id:"td_synced_bigbox",width:300,height:250}]},{id:"TargetSpot"}]};require(["tdapi/base/util/Companions"],function(a){yb=new a}),qb=new TdPlayerApi(b),qb.addEventListener?(qb.addEventListener("player-ready",y),qb.addEventListener("configuration-error",S),qb.addEventListener("module-error",T)):qb.attachEvent&&(qb.attachEvent("player-ready",y),qb.attachEvent("configuration-error",S),qb.attachEvent("module-error",T)),qb.loadModules()}function g(){null!=Eb&&d(Eb,Sb,v),null!=Fb&&d(Fb,Sb,w),null!=Mb&&d(Mb,Sb,jb),null!=Jb&&d(Jb,Sb,u)}function h(){null!==Bb&&(Bb.classList.add("stream__active"),Db.style.display="none",Fb.style.display="none",Eb.style.display="block",Ob.style.display="none",!0===zb?(Jb.style.display="none",Ib.style.display="inline-block"):(Jb.style.display="inline-block",Ib.style.display="none"))}function i(){null!==Bb&&(Db.style.display="block",Eb.style.display="none",Fb.style.display="none",Ib.style.display="inline-block",Ob.style.display="none",Jb.style.display="none")}function j(){null!==Bb&&(Db.style.display="none",Eb.style.display="none",Ib.style.display="inline-block",Ob.style.display="none",Jb.style.display="none",Fb.style.display="block")}function k(){null!=Pb&&(Pb.style.display="none"),null!=Qb&&Qb.classList.add("playing"),null!=Rb&&Cb.insertBefore(Rb,Cb.childNodes[0]),null!=Cb&&Cb.classList.add("audio__playing")}function l(){null!=Pb&&(Pb.style.display="block"),null!=Qb&&Qb.classList.contains("playing")&&Qb.classList.remove("playing"),null!=Rb&&Cb.insertBefore(Rb,Cb.childNodes[3]),null!=Cb&&Cb.classList.remove("audio__playing")}function m(){is_gigya_user_logged_in()?(null!=Db&&1==Cookies.get("gmr_play_live_audio")?d(Db,Sb,s):null!=Db&&d(Db,Sb,t),null!=Ib&&d(Ib,Sb,Tb)):(null!=Db&&d(Db,"click",function(){b.location.href=Lb}),null!=Ib&&d(Ib,"click",function(){b.location.href=Lb}))}function n(){is_gigya_user_logged_in()&&(i(),1==Cookies.get("gmlp_play_button_pushed")?(t(),Cookies.set("gmlp_play_button_pushed",0)):console.log("--- Log In with Gigya ---"))}function o(){var a=document.getElementById("live-stream__container");null!=a&&a.classList.add("vast__pre-roll")}function p(){var a=document.getElementById("live-stream__container");null!=a&&a.classList.remove("vast__pre-roll"),Cookies("gmr_play_live_audio",c),Cookies("gmr_play_live_audio",1,{expires:86400})}function q(){var a=gmr.streamUrl;ab(),$(),qb.stop(),qb.playAd("vastAd",{url:a})}function r(){var a=document.querySelector(".vast__pre-roll");null!=a&&(a.innerHTML='<div class="adblock--detected"><div class="adblock--detected__notice">We\'ve detected that you\'re using <strong>AdBlock Plus</strong> or some other adblocking software. In order to have the best viewing experience, please diasable AdBlock.</div></div>')}function s(){if(lb(),!0===zb)$b(),h();else if(Nb==c)o(),r(),setTimeout(p,15e3);else{!1===zb&&l();var a=gmr.callsign;if(""==a)return void alert("Please enter a Station");ib("playLiveStream - station="+a),wb&&qb.stop(),qb.play({station:a,timeShift:!0}),h()}}function t(){if(!0===zb)$b(),h();else{!1===zb&&l();{var a=gmr.callsign;gmr.streamUrl}if(""==a)return void alert("Please enter a Station");ib("playLiveStream - station="+a),o(),Nb==c?(r(),setTimeout(p,15e3)):q(),qb.addEventListener?qb.addEventListener("ad-playback-complete",function(){p(),console.log("--- ad complete ---"),wb&&qb.stop(),qb.play({station:a,timeShift:!0}),h()}):qb.attachEvent&&qb.attachEvent("ad-playback-complete",function(){p(),console.log("--- ad complete ---"),wb&&qb.stop(),qb.play({station:a,timeShift:!0}),h()})}}function u(){!0===zb?bc():qb.stop(),i()}function v(){!0===zb?ac():qb.pause(),j()}function w(){!0===zb?$b():wb?qb.resume():qb.play(),h()}function x(){if(""==a("#songHistoryCallsignUser").val())return void alert("Please enter a Callsign");var b="hdConnection"==a("#songHistoryConnectionTypeSelect").val();qb.NowPlayingApi.load({mount:a("#songHistoryCallsignUser").val(),hd:b,numberToFetch:15})}function y(){qb.MediaPlayer!=c&&(n(),g(),qb.addEventListener?(qb.addEventListener("track-cue-point",I),qb.addEventListener("ad-break-cue-point",L),qb.addEventListener("stream-track-change",J),qb.addEventListener("hls-cue-point",K),qb.addEventListener("stream-status",U),qb.addEventListener("stream-geo-blocked",V),qb.addEventListener("timeout-alert",Q),qb.addEventListener("timeout-reach",R),qb.addEventListener("npe-song",bb),qb.addEventListener("stream-select",G),qb.addEventListener("stream-start",F),qb.addEventListener("stream-stop",H)):qb.attachEvent&&(qb.attachEvent("track-cue-point",I),qb.attachEvent("ad-break-cue-point",L),qb.attachEvent("stream-track-change",J),qb.attachEvent("hls-cue-point",K),qb.attachEvent("stream-status",U),qb.attachEvent("stream-geo-blocked",V),qb.attachEvent("timeout-alert",Q),qb.attachEvent("timeout-reach",R),qb.attachEvent("npe-song",bb),qb.attachEvent("stream-select",G),qb.attachEvent("stream-start",F),qb.attachEvent("stream-stop",H)),qb.setVolume(1),W("Api Ready"),X(qb.MediaPlayer.tech.type),qb.addEventListener?(qb.addEventListener("list-loaded",N),qb.addEventListener("list-empty",O),qb.addEventListener("nowplaying-api-error",P)):qb.attachEvent&&(qb.attachEvent("list-loaded",N),qb.attachEvent("list-empty",O),qb.attachEvent("nowplaying-api-error",P)),a("#fetchSongHistoryByUserCallsignButton").click(function(){x()}),qb.addEventListener?qb.addEventListener("pwa-data-loaded",Z):qb.attachEvent&&qb.attachEvent("pwa-data-loaded",Z),a("#pwaButton").click(function(){Y()}))}function z(a){ub=!0,W("Advertising... Type="+a.data.type)}function A(){ub=!1,a("#td_adserver_bigbox").empty(),a("#td_adserver_leaderboard").empty(),W("Ready")}function B(a){ib("Ad countdown : "+a.data.countDown+" second(s)")}function C(a){ib("Vast Process complete");var b=a.data.companions;E(b)}function D(a){ib("Vpaid Ad Companions"),E(a.companions)}function E(b){if(b&&b.length>0){var c=-1,d=-1;a.each(b,function(a,b){300==parseInt(b.width)&&250==parseInt(b.height)?c=a:728==parseInt(b.width)&&90==parseInt(b.height)&&(d=a)}),c>-1&&yb.loadVASTCompanionAd("td_adserver_bigbox",b[c]),d>-1&&yb.loadVASTCompanionAd("td_adserver_leaderboard",b[d])}}function F(){wb=!0}function G(){a("#hasHQ").html(qb.MediaPlayer.hasHQ().toString()),a("#isHQ").html(qb.MediaPlayer.isHQ().toString()),a("#hasLow").html(qb.MediaPlayer.hasLow().toString()),a("#isLow").html(qb.MediaPlayer.isLow().toString())}function H(){wb=!1,M(),a("#trackInfo").html(""),a("#asyncData").html(""),a("#hasHQ").html("N/A"),a("#isHQ").html("N/A"),a("#hasLow").html("N/A"),a("#isLow").html("N/A")}function I(b){ib("New Track cuepoint received"),ib("Title:"+b.data.cuePoint.cueTitle+" - Artist:"+b.data.cuePoint.artistName),console.log(b),vb&&vb!=b.data.cuePoint&&M(),b.data.cuePoint.nowplayingURL&&qb.Npe.loadNpeMetadata(b.data.cuePoint.nowplayingURL,b.data.cuePoint.artistName,b.data.cuePoint.cueTitle),vb=b.data.cuePoint,a("#trackInfo").html('<div class="now-playing__title">'+vb.cueTitle+'</div><div class="now-playing__artist">'+vb.artistName+"</div>")}function J(a){ib("Stream Track has changed"),ib("Codec:"+a.data.cuePoint.audioTrack.codec()+" - Bitrate:"+a.data.cuePoint.audioTrack.bitRate())}function K(a){ib("New HLS cuepoint received"),ib("Track Id:"+a.data.cuePoint.hlsTrackId+" SegmentId:"+a.data.cuePoint.hlsSegmentId),console.log(a)}function L(a){W("Commercial break..."),console.log(a)}function M(){a("#npeInfo").html(""),a("#asyncData").html("")}function N(b){ib("Song History loaded"),console.log(b.data),a("#asyncData").html('<br><p><span class="label label-warning">Song History:</span>');var c,d='<table class="table table-striped"><thead><tr><th>Song title</th><th>Artist name</th><th>Time</th></tr></thead>';a.each(b.data.list,function(a,b){c=new Date(Number(b.cueTimeStart)),d+="<tr><td>"+b.cueTitle+"</td><td>"+b.artistName+"</td><td>"+c.toLocaleTimeString()+"</td></tr>"}),d+="</table></p>",a("#asyncData").html("<div>"+d+"</div>")}function O(){a("#asyncData").html('<br><p><span class="label label-important">Song History is empty</span>')}function P(b){ib("Song History loading error",!0),console.error(b),a("#asyncData").html('<br><p><span class="label label-important">Song History error</span>')}function Q(){ib("Time Out Alert")}function R(){ib("Time Out Reached")}function S(a){ib("Configuration error",!0),console.log(a)}function T(b){var c="";a.each(b.data.errors,function(a,b){c+="ERROR : "+b.data.error.message+"<br/>"}),a("#status").html('<p><span class="label label-important">'+c+"</span><p></p>")}function U(a){console.log("tdplayer::onStatus"),W(a.data.status)}function V(a){console.log("tdplayer::onGeoBlocked"),W(a.data.text)}function W(b){ib(b),a("#status").html('<p><span class="label label-success">Status: '+b+"</span></p>")}function X(b){var c=qb.version.major+"."+qb.version.minor+"."+qb.version.patch+"."+qb.version.flag,d='<p><span class="label label-info">Api version: '+c+" - Technology: "+b;qb.flash.available&&(d+=" - Your current version of flash plugin is: "+qb.flash.version.major+"."+qb.flash.version.minor+"."+qb.flash.version.rev),d+="</span></p>",a("#techInfo").html(d)}function Y(){return""==a("#pwaCallsign").val()||""==a("#pwaStreamId").val()?void alert("Please enter a Callsign and a streamid"):void qb.PlayerWebAdmin.load(a("#pwaCallsign").val(),a("#pwaStreamId").val())}function Z(b){ib("PlayerWebAdmin data loaded successfully"),console.log(b),a("#asyncData").html('<br><p><span class="label label-warning">PlayerWebAdmin:</span>');var c='<table class="table table-striped"><thead><tr><th>Key</th><th>Value</th></tr></thead>';for(var d in b.data.config)console.log(d),c+="<tr><td>"+d+"</td><td>"+b.data.config[d]+"</td></tr>";c+="</table></p>",a("#asyncData").html("<div>"+c+"</div>")}function $(){qb.addEventListener?(qb.addEventListener("ad-playback-start",z),qb.addEventListener("ad-playback-error",A),qb.addEventListener("ad-playback-complete",A),qb.addEventListener("ad-countdown",B),qb.addEventListener("vast-process-complete",C),qb.addEventListener("vpaid-ad-companions",D)):qb.attachEvent&&(qb.attachEvent("ad-playback-start",z),qb.attachEvent("ad-playback-error",A),qb.attachEvent("ad-playback-complete",A),qb.attachEvent("ad-countdown",B),qb.attachEvent("vast-process-complete",C),qb.attachEvent("vpaid-ad-companions",D))}function ab(){qb.removeEventListener?(qb.removeEventListener("ad-playback-start",z),qb.removeEventListener("ad-playback-error",A),qb.removeEventListener("ad-playback-complete",A),qb.removeEventListener("ad-countdown",B),qb.removeEventListener("vast-process-complete",C),qb.removeEventListener("vpaid-ad-companions",D)):qb.detachEvent&&(qb.detachEvent("ad-playback-start",z),qb.detachEvent("ad-playback-error",A),qb.detachEvent("ad-playback-complete",A),qb.detachEvent("ad-countdown",B),qb.detachEvent("vast-process-complete",C),qb.detachEvent("vpaid-ad-companions",D))}function bb(a){console.log("tdplayer::onNPESong"),console.log(a),xb=a.data.song,Vb=xb.artist(),Vb.addEventListener?Vb.addEventListener("artist-complete",db):Vb.attachEvent&&Vb.attachEvent("artist-complete",db);var b=gb();cb(b,!1)}function cb(b,c){a("#asyncData").empty();var d=c?"asyncData":"npeInfo",e=a("#"+d);0==c&&e.html('<span class="label label-inverse">Npe Info:</span>'),e.append(b)}function db(){Vb.addEventListener?Vb.addEventListener("picture-complete",eb):Vb.attachEvent&&Vb.attachEvent("picture-complete",eb);for(var a=Vb.getPictures(),b=[],c=0;c<a.length;c++)b.push(a[c].id);b.length>0&&Vb.fetchPictureByIds(b);var d=fb();cb(d,!0)}function eb(b){console.log("tdplayer::onArtistPictureComplete"),console.log(b);for(var c='<span class="label label-inverse">Photos:</span><br>',d=0;d<b.length;d++)b[d].getFiles()&&(c+='<a href="'+b[d].getFiles()[0].url+'" rel="lightbox[npe]" title="Click on the right side of the image to move forward."><img src="'+b[d].getFiles()[0].url+'" width="125" /></a>&nbsp;');a("#asyncData").append(c)}function fb(){if(xb!=c){var a='<span class="label label-inverse">Artist:</span>';a+="<ul><li>Artist id: "+xb.artist().id+"</li>",a+="<li>Artist birth date: "+xb.artist().getBirthDate()+"</li>",a+="<li>Artist end date: "+xb.artist().getEndDate()+"</li>",a+="<li>Artist begin place: "+xb.artist().getBeginPlace()+"</li>",a+="<li>Artist end place: "+xb.artist().getEndPlace()+"</li>",a+="<li>Artist is group ?: "+xb.artist().getIsGroup()+"</li>",a+="<li>Artist country: "+xb.artist().getCountry()+"</li>";for(var b=xb.artist().getAlbums(),d=0;d<b.length;d++)a+="<li>Album "+(d+1)+": "+b[d].getTitle()+"</li>";for(var e=xb.artist().getSimilar(),d=0;d<e.length;d++)a+="<li>Similar artist "+(d+1)+": "+e[d].name+"</li>";for(var f=xb.artist().getMembers(),d=0;d<f.length;d++)a+="<li>Member "+(d+1)+": "+f[d].name+"</li>";a+="<li>Artist website: "+xb.artist().getWebsite()+"</li>",a+="<li>Artist twitter: "+xb.artist().getTwitterUsername()+"</li>",a+="<li>Artist facebook: "+xb.artist().getFacebookUrl()+"</li>",a+="<li>Artist biography: "+xb.artist().getBiography().substring(0,2e3)+"...</small>";for(var g=xb.artist().getGenres(),d=0;d<g.length;d++)a+="<li>Genre "+(d+1)+": "+g[d]+"</li>";return a+="</ul>"}return'<span class="label label-important">The artist information is undefined</span>'}function gb(){var a="NPE Data undefined";if(xb!=c&&xb.album()){var b="";null!=xb.album().getBuyUrl()&&(b='<a target="_blank" title="'+xb.album().getBuyUrl()+'" href="'+xb.album().getBuyUrl()+'">Buy on iTunes</a><br/>'),a="<p><b>Album:</b> "+xb.album().getTitle()+"<br/>"+b+'<img src="'+xb.album().getCoverArtOriginal().url+'" style="height:100px" /></p>'}return a}function hb(){for(var a,c=[],d=b.location.href.slice(b.location.href.indexOf("?")+1).split("&"),e=0;e<d.length;e++)a=d[e].split("="),c.push(a[0]),c[a[0]]=a[1];return c}function ib(b,c){c?console.error(b):console.log(b),a("#debugInformation").append(b),a("#debugInformation").append("\n")}function jb(){a("#debugInformation").html("")}function kb(){if("undefined"!=typeof Modernizr&&Modernizr.audio){var b=document.querySelectorAll(".content"),c=a(b);c.on("click",".podcast__btn--play",function(b){var c=a(b.currentTarget);_b(c.attr("data-mp3-src")),Xb(),ec(c.attr("data-mp3-title"),c.attr("data-mp3-artist"),c.attr("data-mp3-hash"))}),c.on("click",".podcast__btn--pause",ac)}else{var d=a(".gmr-mediaelement-fallback audio"),e=a(".podcast__play");d.mediaelementplayer(),e.hide()}}function lb(){is_gigya_user_logged_in()?a.support.pjax&&a(document).pjax("a:not(.ab-item)",".main",{fragment:".main",maxCacheLength:500,timeout:5e3}):gmlp.logged_in&&a.support.pjax&&a(document).pjax("a:not(.ab-item)",".page-wrap",{fragment:".page-wrap",maxCacheLength:500,timeout:5e3})}function mb(){a(document).on("pjax:click",function(a){a.preventDefault()})}function nb(){var a=document.getElementById("audio__progress"),b=0;Ab.currentTime>0&&(b=Math.floor(100/Ab.duration*Ab.currentTime)),a.style.width=b+"%"}function ob(){var a,b,c=document.getElementById("audio__time--remaining"),d=parseInt(Ab.duration),e=parseInt(Ab.currentTime),f=d-e;a=f%60,b=Math.floor(f/60)%60,a=10>a?"0"+a:a,b=10>b?+b:b,c.innerHTML=b+":"+a}function pb(){var a=document.getElementById("audio__time--elapsed"),b=parseInt(Ab.currentTime%60),c=parseInt(Ab.currentTime/60%60);a.innerHTML=10>b?c+":0"+b:c+":"+b}var qb,rb,sb,tb,ub,vb,wb,xb,yb,zb=(hb().tech||"html5_flash","false"==hb().aSyncCuePointFallback?!1:!0,!1),Ab=!1,Bb=document.getElementById("td_container"),Cb=document.querySelector(".live-stream"),Db=document.getElementById("playButton"),Eb=document.getElementById("pauseButton"),Fb=document.getElementById("resumeButton"),Gb=document.querySelector(".podcast__btn--play"),Hb=document.querySelector(".podcast__btn--pause"),Ib=document.getElementById("live-stream__listen-now"),Jb=document.getElementById("live-stream__now-playing"),Kb=a(document.getElementById("trackInfo")),Lb=gmr.homeUrl+"members/login",Mb=document.getElementById("clearDebug"),Nb=document.getElementById("ad-check"),Ob=(document.getElementById("close-adblock"),document.getElementById("live-stream__login")),Pb=document.getElementById("on-air"),Qb=document.getElementById("audio__time"),Rb=document.getElementById("live-stream__status"),Sb="click";b.tdPlayerApiReady=function(){console.log("--- TD Player API Loaded ---"),f()};var Tb=function(){!0===zb&&(Ab.pause(),Xb(),zb=!1,i()),1==Cookies.get("gmr_play_live_audio")?s():t()};m();var Ub=a(".live-player__stream--current-name");Ub.bind("DOMSubtreeModified",function(){console.log("--- new stream select ---");var a=Ub.text();wb&&qb.stop(),!0===zb&&bc(),qb.play({station:a,timeShift:!0}),h()});var Vb,Wb=function(){"undefined"!=typeof qb&&"undefined"!=typeof qb.stop&&qb.stop()},Xb=function(){a(".podcast__btn--play.playing").removeClass("playing"),a(".podcast__btn--pause.playing").removeClass("playing")},Yb=function(){var b=".mp3-"+tb;a(b+" .podcast__btn--play").addClass("playing"),a(b+" .podcast__btn--pause").addClass("playing")},Zb=function(a){Ab.src=a},$b=function(){zb=!0,Wb(),Ab.play(),cc(),dc(),h(),Xb(),Yb(),k()},_b=function(a){lb(),a!==Ab.src&&Zb(a),$b()},ac=function(){mb(),Ab.pause(),Xb(),j(),l()},bc=function(){mb(),Ab.pause(),Xb(),zb=!1,i(),l()},cc=function(){var b=_.template('<div class="now-playing__title"><%- title %></div>'),c=a(".now-playing__title");c.length>0?c.text(sb):Kb.prepend(b({title:sb}))},dc=function(){var b=_.template('<div class="now-playing__artist"><%- artist %></div>'),c=a(".now-playing__artist");c.length>0?c.text(rb):Kb.append(b({artist:rb}))},ec=function(a,b,c){sb=a,rb=b,tb=c,cc(),dc(),Yb()},fc=function(){"undefined"!=typeof Modernizr&&Modernizr.audio&&(Ab=new Audio,Ab.addEventListener?Ab.addEventListener("ended",function(){Xb(),j()}):Ab.attachEvent&&Ab.attachEvent("ended",function(){Xb(),j()}))};fc(),kb(),Ab.addEventListener("timeupdate",function(){nb(),pb(),ob()},!1),d(Gb,Sb,k),d(Hb,Sb,ac),a(document).on("pjax:end",function(){kb(),Yb()})}(jQuery,window);