function initPlayer(){var a;switch(tech){case"html5_flash":a=["Html5","Flash"];break;case"flash":a=["Flash"];break;case"html5":a=["Html5"];break;case"flash_html5":default:a=["Flash","Html5"]}var b={coreModules:[{id:"MediaPlayer",playerId:"td_container",platformId:platformid+"01",isDebug:!0,techPriority:a,timeShift:{active:0,max_listening_time:35},sbm:{active:sbm,aSyncCuePointFallback:aSyncCuePointFallback},geoTargeting:{desktop:{isActive:!0},iOS:{isActive:!0},android:{isActive:!0}}},{id:"UserRegistration",tenantId:"see_1670",platformId:platformid+"01"},{id:"NowPlayingApi"},{id:"Npe"},{id:"PlayerWebAdmin"},{id:"TargetSpot"}]};require(["tdapi/base/util/Companions"],function(a){companions=new a}),player=new TdPlayerApi(b),player.addEventListener("player-ready",onPlayerReady),player.addEventListener("configuration-error",onConfigurationError),player.addEventListener("module-error",onModuleError),player.loadModules()}function loadIdSync(a){var b=document.createElement("script");b.setAttribute("type","text/javascript"),b.setAttribute("src","//playerservices.live.streamtheworld.com/api/idsync.js?station="+a),document.getElementsByTagName("head")[0].appendChild(b)}function initControlsUi(){var a,b,c,d;a=$("#playButton"),b=$("#pauseButton"),c=$("#resumeButton"),d=$(".mejs-play"),$(document).on("click","#playButton",playLiveAudioStream),a.click(function(){a.hide(),b.show()}),$("#clearDebug").click(function(){clearDebugInfo()}),$("#playStreamByUserStationButton").click(function(){playStreamByUserStation()}),$("#playUrlButton").click(function(){return""==$("#streamUrlUser").val()?void alert("Please enter an url"):(adPlaying&&player.skipAd(),livePlaying&&player.stop(),void player.MediaPlayer.tech.playStream({url:$("#streamUrlUser").val(),aSyncCuePoint:{active:!1}}))}),$(".stop-live").click(function(){stopStream()}),b.click(function(){b.hide(),c.show(),pauseStream()}),d.click(function(){b.hide(),c.show(),pauseStream()}),c.click(function(){c.hide(),b.show(),seekLive()}),$("#seekLiveButton").click(function(){seekLive()}),$("#muteButton").click(function(){mute()}),$("#unMuteButton").click(function(){unMute()}),$("#setVolume50Button").click(function(){setVolume50()}),$("#getArtistButton").click(function(){getArtistData()})}function playLiveAudioStream(a){a.preventDefault();var b=$(a.target).data("station");return""==b?void alert("Please enter a Station"):(debug("playLiveAudioStream - station="+b),$("#stationUser").val(""),livePlaying&&player.stop(),void player.play({station:b,timeShift:!0}))}function playStreamByUserStation(){return""==$("#stationUser").val()?void alert("Please enter a Station"):(adPlaying&&player.skipAd(),livePlaying&&player.stop(),player.play({station:$("#stationUser").val(),timeShift:!0}),void(currentStation!=$("#stationUser").val()&&(currentStation=$("#stationUser").val(),loadIdSync(currentStation))))}function stopStream(){player.stop()}function pauseStream(){player.pause()}function resumeStream(){livePlaying?player.resume():player.play()}function seekLive(){player.seekLive()}function loadNpApi(){if(""==$("#songHistoryCallsignUser").val())return void alert("Please enter a Callsign");var a="hdConnection"==$("#songHistoryConnectionTypeSelect").val();player.NowPlayingApi.load({mount:$("#songHistoryCallsignUser").val(),hd:a,numberToFetch:15})}function setVolume50(){player.setVolume(.5)}function mute(){player.mute()}function unMute(){player.unMute()}function getArtistData(){song&&null!=song.artist()&&song.artist().fetchData()}function onPlayerReady(){void 0!=player.MediaPlayer&&(initControlsUi(),player.addEventListener("track-cue-point",onTrackCuePoint),player.addEventListener("stream-status",onStatus),player.addEventListener("stream-geo-blocked",onGeoBlocked),player.addEventListener("timeout-alert",onTimeOutAlert),player.addEventListener("timeout-reach",onTimeOutReach),player.addEventListener("npe-song",onNPESong),player.addEventListener("stream-select",onStreamSelect),player.addEventListener("stream-start",onStreamStarted),player.addEventListener("stream-stop",onStreamStopped),player.setVolume(1),setStatus("Api Ready"),setTech(player.MediaPlayer.tech.type),player.addEventListener("list-loaded",onListLoaded),player.addEventListener("list-empty",onListEmpty),player.addEventListener("nowplaying-api-error",onNowPlayingApiError),$("#fetchSongHistoryByUserCallsignButton").click(function(){loadNpApi()}),player.addEventListener("pwa-data-loaded",onPwaDataLoaded),$("#pwaButton").click(function(){loadPwaData()}))}function onStreamStarted(){livePlaying=!0}function onStreamSelect(){$("#hasHQ").html(player.MediaPlayer.hasHQ().toString()),$("#isHQ").html(player.MediaPlayer.isHQ().toString()),$("#hasLow").html(player.MediaPlayer.hasLow().toString()),$("#isLow").html(player.MediaPlayer.isLow().toString())}function onStreamStopped(){livePlaying=!1,clearNpe(),$("#trackInfo").html(""),$("#asyncData").html(""),$("#hasHQ").html("N/A"),$("#isHQ").html("N/A"),$("#hasLow").html("N/A"),$("#isLow").html("N/A")}function onTrackCuePoint(a){debug("New Track cuepoint received"),debug("Title:"+a.data.cuePoint.cueTitle+" - Artist:"+a.data.cuePoint.artistName),console.log(a),currentTrackCuePoint&&currentTrackCuePoint!=a.data.cuePoint&&clearNpe(),a.data.cuePoint.nowplayingURL&&player.Npe.loadNpeMetadata(a.data.cuePoint.nowplayingURL,a.data.cuePoint.artistName,a.data.cuePoint.cueTitle),currentTrackCuePoint=a.data.cuePoint,$("#trackInfo").html('<div class="now-playing__title">'+currentTrackCuePoint.cueTitle+'</div><div class="now-playing__artist">'+currentTrackCuePoint.artistName+"</div>")}function clearNpe(){$("#npeInfo").html(""),$("#asyncData").html("")}function onListLoaded(a){debug("Song History loaded"),console.log(a.data),$("#asyncData").html('<br><p><span class="label label-warning">Song History:</span>');var b,c='<table class="table table-striped"><thead><tr><th>Song title</th><th>Artist name</th><th>Time</th></tr></thead>';$.each(a.data.list,function(a,d){b=new Date(Number(d.cueTimeStart)),c+="<tr><td>"+d.cueTitle+"</td><td>"+d.artistName+"</td><td>"+b.toLocaleTimeString()+"</td></tr>"}),c+="</table></p>",$("#asyncData").html("<div>"+c+"</div>")}function onListEmpty(){$("#asyncData").html('<br><p><span class="label label-important">Song History is empty</span>')}function onNowPlayingApiError(a){debug("Song History loading error",!0),console.error(a),$("#asyncData").html('<br><p><span class="label label-important">Song History error</span>')}function onTimeOutAlert(){debug("Time Out Alert")}function onTimeOutReach(){debug("Time Out Reached")}function onConfigurationError(a){debug("Configuration error",!0),console.log(a)}function onModuleError(a){var b="";$.each(a.data.errors,function(a,c){b+="ERROR : "+c.data.error.message+"<br/>"}),$("#status").html('<p><span class="label label-important">'+b+"</span><p></p>")}function onStatus(a){console.log("tdplayer::onStatus"),setStatus(a.data.status)}function onGeoBlocked(a){console.log("tdplayer::onGeoBlocked"),setStatus(a.data.text)}function setStatus(a){debug(a),$("#status").html('<p><span class="label label-success">Status: '+a+"</span></p>")}function setTech(a){var b=player.version.major+"."+player.version.minor+"."+player.version.patch+"."+player.version.flag,c='<p><span class="label label-info">Api version: '+b+" - Technology: "+a;player.flash.available&&(c+=" - Your current version of flash plugin is: "+player.flash.version.major+"."+player.flash.version.minor+"."+player.flash.version.rev),c+="</span></p>",$("#techInfo").html(c)}function loadPwaData(){return""==$("#pwaCallsign").val()||""==$("#pwaStreamId").val()?void alert("Please enter a Callsign and a streamid"):void player.PlayerWebAdmin.load($("#pwaCallsign").val(),$("#pwaStreamId").val())}function onPwaDataLoaded(a){debug("PlayerWebAdmin data loaded successfully"),console.log(a),$("#asyncData").html('<br><p><span class="label label-warning">PlayerWebAdmin:</span>');var b='<table class="table table-striped"><thead><tr><th>Key</th><th>Value</th></tr></thead>';for(var c in a.data.config)console.log(c),b+="<tr><td>"+c+"</td><td>"+a.data.config[c]+"</td></tr>";b+="</table></p>",$("#asyncData").html("<div>"+b+"</div>")}function onNPESong(a){console.log("tdplayer::onNPESong"),console.log(a),song=a.data.song,artist=song.artist(),artist.addEventListener("artist-complete",onArtistComplete);var b=getNPEData();displayNpeInfo(b,!1)}function displayNpeInfo(a,b){$("#asyncData").empty();var c=b?"asyncData":"npeInfo",d=$("#"+c);0==b&&d.html('<span class="label label-inverse">Npe Info:</span>'),d.append(a)}function onArtistComplete(){artist.addEventListener("picture-complete",onArtistPictureComplete);for(var a=artist.getPictures(),b=[],c=0;c<a.length;c++)b.push(a[c].id);b.length>0&&artist.fetchPictureByIds(b);var d=getArtist();displayNpeInfo(d,!0)}function onArtistPictureComplete(a){console.log("tdplayer::onArtistPictureComplete"),console.log(a);for(var b='<span class="label label-inverse">Photos:</span><br>',c=0;c<a.length;c++)a[c].getFiles()&&(b+='<a href="'+a[c].getFiles()[0].url+'" rel="lightbox[npe]" title="Click on the right side of the image to move forward."><img src="'+a[c].getFiles()[0].url+'" width="125" /></a>&nbsp;');$("#asyncData").append(b)}function getArtist(){if(void 0!=song){var a='<span class="label label-inverse">Artist:</span>';a+="<ul><li>Artist id: "+song.artist().id+"</li>",a+="<li>Artist birth date: "+song.artist().getBirthDate()+"</li>",a+="<li>Artist end date: "+song.artist().getEndDate()+"</li>",a+="<li>Artist begin place: "+song.artist().getBeginPlace()+"</li>",a+="<li>Artist end place: "+song.artist().getEndPlace()+"</li>",a+="<li>Artist is group ?: "+song.artist().getIsGroup()+"</li>",a+="<li>Artist country: "+song.artist().getCountry()+"</li>";for(var b=song.artist().getAlbums(),c=0;c<b.length;c++)a+="<li>Album "+(c+1)+": "+b[c].getTitle()+"</li>";for(var d=song.artist().getSimilar(),c=0;c<d.length;c++)a+="<li>Similar artist "+(c+1)+": "+d[c].name+"</li>";for(var e=song.artist().getMembers(),c=0;c<e.length;c++)a+="<li>Member "+(c+1)+": "+e[c].name+"</li>";a+="<li>Artist website: "+song.artist().getWebsite()+"</li>",a+="<li>Artist twitter: "+song.artist().getTwitterUsername()+"</li>",a+="<li>Artist facebook: "+song.artist().getFacebookUrl()+"</li>",a+="<li>Artist biography: "+song.artist().getBiography().substring(0,2e3)+"...</small>";for(var f=song.artist().getGenres(),c=0;c<f.length;c++)a+="<li>Genre "+(c+1)+": "+f[c]+"</li>";return a+="</ul>"}return'<span class="label label-important">The artist information is undefined</span>'}function getNPEData(){var a="NPE Data undefined";if(void 0!=song&&song.album()){var b="";null!=song.album().getBuyUrl()&&(b='<a target="_blank" title="'+song.album().getBuyUrl()+'" href="'+song.album().getBuyUrl()+'">Buy on iTunes</a><br/>'),a="<p><b>Album:</b> "+song.album().getTitle()+"<br/>"+b+'<img src="'+song.album().getCoverArtOriginal().url+'" style="height:100px" /></p>'}return a}function getUrlVars(){for(var a,b=[],c=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),d=0;d<c.length;d++)a=c[d].split("="),b.push(a[0]),b[a[0]]=a[1];return b}function debug(a,b){b?console.error(a):console.log(a),$("#debugInformation").append(a),$("#debugInformation").append("\n")}function clearDebugInfo(){$("#debugInformation").html("")}$(document).ready(function(){configurePlatformIdButtons(),configureTechButtons(),configureSBMButtons()});var platformid=getUrlVars().platformid||"prod",tech=getUrlVars().tech||"flash_html5",sbm="false"==getUrlVars().sbm?!1:!0,aSyncCuePointFallback="false"==getUrlVars().aSyncCuePointFallback?!1:!0,player,station="KOITFM",stationVideo="CKOIFMFLASH1",currentTrackCuePoint,livePlaying,song,currentStation="";window.tdPlayerApiReady=function(){console.log("--- TD Player API Loaded ---"),initPlayer()};var artist;