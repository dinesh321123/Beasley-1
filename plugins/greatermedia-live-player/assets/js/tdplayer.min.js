!function(a,b,c){"use strict";function d(a,b,c){null!=a&&(a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c))}function e(){return bowser.firefox?["Flash"]:bowser.safari?["Html5"]:["Html5","Flash"]}function f(){var a=e();console.log("+++ initPlayer - techPriority = ",a);var b={coreModules:[{id:"MediaPlayer",playerId:"td_container",isDebug:!0,techPriority:["Flash","Html5"],timeShift:{active:0,max_listening_time:35},geoTargeting:{desktop:{isActive:!1},iOS:{isActive:!1},android:{isActive:!1}},plugins:[{id:"vastAd"}]},{id:"NowPlayingApi"},{id:"Npe"},{id:"PlayerWebAdmin"},{id:"SyncBanners",elements:[{id:"td_synced_bigbox",width:300,height:250}]},{id:"TargetSpot"}]};require(["tdapi/base/util/Companions"],function(a){zb=new a}),rb=new TdPlayerApi(b),rb.addEventListener?(rb.addEventListener("player-ready",z),rb.addEventListener("configuration-error",T),rb.addEventListener("module-error",U)):rb.attachEvent&&(rb.attachEvent("player-ready",z),rb.attachEvent("configuration-error",T),rb.attachEvent("module-error",U)),rb.loadModules()}function g(){null!=Hb&&d(Hb,Ub,w),null!=Ib&&d(Ib,Ub,x),null!=Qb&&d(Qb,Ub,kb),null!=Nb&&d(Nb,Ub,v)}function h(){null!==Db&&(Db.classList.add("stream__active"),Gb.style.display="none",Ib.style.display="none",Hb.style.display="block",!0===Ab?(Nb.style.display="none",Mb.style.display="inline-block"):(Nb.style.display="inline-block",Mb.style.display="none"))}function i(){null!==Db&&(Gb.style.display="block",Hb.style.display="none",Ib.style.display="none",Mb.style.display="inline-block",Nb.style.display="none")}function j(){null!==Db&&(Gb.style.display="none",Hb.style.display="none",Mb.style.display="inline-block",Nb.style.display="none",Ib.style.display="block")}function k(){var a,b=document.querySelectorAll(".audio__time");for(a=0;a<b.length;++a)b[a].classList.add("playing");null!=Fb&&Fb.classList.add("audio__playing"),null!=Sb&&Sb.classList.add("audio__playing"),null!=Eb&&Eb.classList.add("playing"),null!=Tb&&Tb.classList.add("playing"),null!=Mb&&setTimeout(function(){Mb.innerHTML="Switch to Live Stream"},1e3)}function l(a){var b,c=a.target,d=c.parentNode,e=d.nextElementSibling,f=e.nextElementSibling,g=document.querySelectorAll(".audio__time"),h=document.querySelector(".podcast__runtime");if(null!=Lb&&Cb.classList.contains("page-template-single-show-podcasts-php"))e.classList.add("playing__current"),f.classList.add("playing");else{for(b=0;b<g.length;++b)null!=g[b]&&(g[b].classList.add("playing"),g[b].classList.add("playing__current"));h.classList.add("playing")}}function m(){var a,a,b=document.querySelectorAll(".audio__time"),c=document.querySelectorAll(".podcast__runtime");for(a=0;a<b.length;++a)null!=b[a]&&b[a].classList.contains("playing")&&b[a].classList.remove("playing"),null!=b[a]&&b[a].classList.contains("playing__current")&&b[a].classList.remove("playing__current");for(null!=Fb&&Fb.classList.remove("audio__playing"),null!=Sb&&Sb.classList.remove("audio__playing"),null!=Eb&&Eb.classList.remove("playing"),a=0;a<c.length;++a)null!=c[a]&&c[a].classList.contains("playing")&&c[a].classList.remove("playing");null!=Tb&&Tb.classList.remove("playing")}function n(){is_gigya_user_logged_in()?(null!=Gb&&1==Cookies.get("gmr_play_live_audio")?d(Gb,Ub,t):null!=Gb&&d(Gb,Ub,u),null!=Mb&&d(Mb,Ub,Vb)):(null!=Gb&&d(Gb,"click",function(){b.location.href=Pb}),null!=Mb&&d(Mb,"click",function(){b.location.href=Pb}))}function o(){is_gigya_user_logged_in()&&(i(),1==Cookies.get("gmlp_play_button_pushed")?(u(),Cookies.set("gmlp_play_button_pushed",0)):console.log("--- Log In with Gigya ---"))}function p(){var a=document.getElementById("live-stream__container");null!=a&&a.classList.add("vast__pre-roll")}function q(){var a=document.getElementById("live-stream__container");null!=a&&a.classList.remove("vast__pre-roll"),Cookies("gmr_play_live_audio",c),Cookies("gmr_play_live_audio",1,{expires:86400})}function r(){var a=gmr.streamUrl;bb(),ab(),rb.stop(),rb.playAd("vastAd",{url:a})}function s(){var a=document.querySelector(".vast__pre-roll");null!=a&&(a.innerHTML='<div class="adblock--detected"><div class="adblock--detected__notice">We\'ve detected that you\'re using <strong>AdBlock Plus</strong> or some other adblocking software. In order to have the best viewing experience, please diasable AdBlock.</div></div>')}function t(){if(mb(),!0===Ab)ac();else if(Rb==c)p(),s(),setTimeout(q,15e3);else{var a=gmr.callsign;if(""==a)return void alert("Please enter a Station");jb("playLiveStream - station="+a),xb&&rb.stop(),rb.play({station:a,timeShift:!0}),setTimeout(h,1e3)}}function u(){if(!0===Ab)ac(),h();else{{var a=gmr.callsign;gmr.streamUrl}if(""==a)return void alert("Please enter a Station");jb("playLiveStream - station="+a),p(),Rb==c?(s(),setTimeout(q,15e3)):r(),rb.addEventListener?rb.addEventListener("ad-playback-complete",function(){q(),console.log("--- ad complete ---"),xb&&rb.stop(),rb.play({station:a,timeShift:!0}),setTimeout(h,1e3)}):rb.attachEvent&&rb.attachEvent("ad-playback-complete",function(){q(),console.log("--- ad complete ---"),xb&&rb.stop(),rb.play({station:a,timeShift:!0}),setTimeout(h,1e3)})}}function v(){!0===Ab?dc():rb.stop(),i()}function w(){!0===Ab?cc():rb.pause(),j()}function x(){!0===Ab?ac():xb?rb.resume():rb.play(),h()}function y(){if(""==a("#songHistoryCallsignUser").val())return void alert("Please enter a Callsign");var b="hdConnection"==a("#songHistoryConnectionTypeSelect").val();rb.NowPlayingApi.load({mount:a("#songHistoryCallsignUser").val(),hd:b,numberToFetch:15})}function z(){rb.MediaPlayer!=c&&(o(),g(),rb.addEventListener?(rb.addEventListener("track-cue-point",J),rb.addEventListener("ad-break-cue-point",M),rb.addEventListener("stream-track-change",K),rb.addEventListener("hls-cue-point",L),rb.addEventListener("stream-status",V),rb.addEventListener("stream-geo-blocked",W),rb.addEventListener("timeout-alert",R),rb.addEventListener("timeout-reach",S),rb.addEventListener("npe-song",cb),rb.addEventListener("stream-select",H),rb.addEventListener("stream-start",G),rb.addEventListener("stream-stop",I)):rb.attachEvent&&(rb.attachEvent("track-cue-point",J),rb.attachEvent("ad-break-cue-point",M),rb.attachEvent("stream-track-change",K),rb.attachEvent("hls-cue-point",L),rb.attachEvent("stream-status",V),rb.attachEvent("stream-geo-blocked",W),rb.attachEvent("timeout-alert",R),rb.attachEvent("timeout-reach",S),rb.attachEvent("npe-song",cb),rb.attachEvent("stream-select",H),rb.attachEvent("stream-start",G),rb.attachEvent("stream-stop",I)),rb.setVolume(1),X("Api Ready"),Y(rb.MediaPlayer.tech.type),rb.addEventListener?(rb.addEventListener("list-loaded",O),rb.addEventListener("list-empty",P),rb.addEventListener("nowplaying-api-error",Q)):rb.attachEvent&&(rb.attachEvent("list-loaded",O),rb.attachEvent("list-empty",P),rb.attachEvent("nowplaying-api-error",Q)),a("#fetchSongHistoryByUserCallsignButton").click(function(){y()}),rb.addEventListener?rb.addEventListener("pwa-data-loaded",$):rb.attachEvent&&rb.attachEvent("pwa-data-loaded",$),a("#pwaButton").click(function(){Z()}))}function A(a){vb=!0,X("Advertising... Type="+a.data.type)}function B(){vb=!1,a("#td_adserver_bigbox").empty(),a("#td_adserver_leaderboard").empty(),X("Ready")}function C(a){jb("Ad countdown : "+a.data.countDown+" second(s)")}function D(a){jb("Vast Process complete");var b=a.data.companions;F(b)}function E(a){jb("Vpaid Ad Companions"),F(a.companions)}function F(b){if(b&&b.length>0){var c=-1,d=-1;a.each(b,function(a,b){300==parseInt(b.width)&&250==parseInt(b.height)?c=a:728==parseInt(b.width)&&90==parseInt(b.height)&&(d=a)}),c>-1&&zb.loadVASTCompanionAd("td_adserver_bigbox",b[c]),d>-1&&zb.loadVASTCompanionAd("td_adserver_leaderboard",b[d])}}function G(){xb=!0}function H(){a("#hasHQ").html(rb.MediaPlayer.hasHQ().toString()),a("#isHQ").html(rb.MediaPlayer.isHQ().toString()),a("#hasLow").html(rb.MediaPlayer.hasLow().toString()),a("#isLow").html(rb.MediaPlayer.isLow().toString())}function I(){xb=!1,N(),a("#trackInfo").html(""),a("#asyncData").html(""),a("#hasHQ").html("N/A"),a("#isHQ").html("N/A"),a("#hasLow").html("N/A"),a("#isLow").html("N/A")}function J(b){jb("New Track cuepoint received"),jb("Title:"+b.data.cuePoint.cueTitle+" - Artist:"+b.data.cuePoint.artistName),console.log(b),wb&&wb!=b.data.cuePoint&&N(),b.data.cuePoint.nowplayingURL&&rb.Npe.loadNpeMetadata(b.data.cuePoint.nowplayingURL,b.data.cuePoint.artistName,b.data.cuePoint.cueTitle),wb=b.data.cuePoint,a("#trackInfo").html('<div class="now-playing__title">'+wb.cueTitle+'</div><div class="now-playing__artist">'+wb.artistName+"</div>")}function K(a){jb("Stream Track has changed"),jb("Codec:"+a.data.cuePoint.audioTrack.codec()+" - Bitrate:"+a.data.cuePoint.audioTrack.bitRate())}function L(a){jb("New HLS cuepoint received"),jb("Track Id:"+a.data.cuePoint.hlsTrackId+" SegmentId:"+a.data.cuePoint.hlsSegmentId),console.log(a)}function M(a){X("Commercial break..."),console.log(a)}function N(){a("#npeInfo").html(""),a("#asyncData").html("")}function O(b){jb("Song History loaded"),console.log(b.data),a("#asyncData").html('<br><p><span class="label label-warning">Song History:</span>');var c,d='<table class="table table-striped"><thead><tr><th>Song title</th><th>Artist name</th><th>Time</th></tr></thead>';a.each(b.data.list,function(a,b){c=new Date(Number(b.cueTimeStart)),d+="<tr><td>"+b.cueTitle+"</td><td>"+b.artistName+"</td><td>"+c.toLocaleTimeString()+"</td></tr>"}),d+="</table></p>",a("#asyncData").html("<div>"+d+"</div>")}function P(){a("#asyncData").html('<br><p><span class="label label-important">Song History is empty</span>')}function Q(b){jb("Song History loading error",!0),console.error(b),a("#asyncData").html('<br><p><span class="label label-important">Song History error</span>')}function R(){jb("Time Out Alert")}function S(){jb("Time Out Reached")}function T(a){jb("Configuration error",!0),console.log(a)}function U(b){var c="";a.each(b.data.errors,function(a,b){c+="ERROR : "+b.data.error.message+"<br/>"}),a("#status").html('<p><span class="label label-important">'+c+"</span><p></p>")}function V(a){console.log("tdplayer::onStatus"),X(a.data.status)}function W(a){console.log("tdplayer::onGeoBlocked"),X(a.data.text)}function X(b){jb(b),a("#status").html('<p><span class="label label-success">Status: '+b+"</span></p>")}function Y(b){var c=rb.version.major+"."+rb.version.minor+"."+rb.version.patch+"."+rb.version.flag,d='<p><span class="label label-info">Api version: '+c+" - Technology: "+b;rb.flash.available&&(d+=" - Your current version of flash plugin is: "+rb.flash.version.major+"."+rb.flash.version.minor+"."+rb.flash.version.rev),d+="</span></p>",a("#techInfo").html(d)}function Z(){return""==a("#pwaCallsign").val()||""==a("#pwaStreamId").val()?void alert("Please enter a Callsign and a streamid"):void rb.PlayerWebAdmin.load(a("#pwaCallsign").val(),a("#pwaStreamId").val())}function $(b){jb("PlayerWebAdmin data loaded successfully"),console.log(b),a("#asyncData").html('<br><p><span class="label label-warning">PlayerWebAdmin:</span>');var c='<table class="table table-striped"><thead><tr><th>Key</th><th>Value</th></tr></thead>';for(var d in b.data.config)console.log(d),c+="<tr><td>"+d+"</td><td>"+b.data.config[d]+"</td></tr>";c+="</table></p>",a("#asyncData").html("<div>"+c+"</div>")}function ab(){rb.addEventListener?(rb.addEventListener("ad-playback-start",A),rb.addEventListener("ad-playback-error",B),rb.addEventListener("ad-playback-complete",B),rb.addEventListener("ad-countdown",C),rb.addEventListener("vast-process-complete",D),rb.addEventListener("vpaid-ad-companions",E)):rb.attachEvent&&(rb.attachEvent("ad-playback-start",A),rb.attachEvent("ad-playback-error",B),rb.attachEvent("ad-playback-complete",B),rb.attachEvent("ad-countdown",C),rb.attachEvent("vast-process-complete",D),rb.attachEvent("vpaid-ad-companions",E))}function bb(){rb.removeEventListener?(rb.removeEventListener("ad-playback-start",A),rb.removeEventListener("ad-playback-error",B),rb.removeEventListener("ad-playback-complete",B),rb.removeEventListener("ad-countdown",C),rb.removeEventListener("vast-process-complete",D),rb.removeEventListener("vpaid-ad-companions",E)):rb.detachEvent&&(rb.detachEvent("ad-playback-start",A),rb.detachEvent("ad-playback-error",B),rb.detachEvent("ad-playback-complete",B),rb.detachEvent("ad-countdown",C),rb.detachEvent("vast-process-complete",D),rb.detachEvent("vpaid-ad-companions",E))}function cb(a){console.log("tdplayer::onNPESong"),console.log(a),yb=a.data.song,Xb=yb.artist(),Xb.addEventListener?Xb.addEventListener("artist-complete",eb):Xb.attachEvent&&Xb.attachEvent("artist-complete",eb);var b=hb();db(b,!1)}function db(b,c){a("#asyncData").empty();var d=c?"asyncData":"npeInfo",e=a("#"+d);0==c&&e.html('<span class="label label-inverse">Npe Info:</span>'),e.append(b)}function eb(){Xb.addEventListener?Xb.addEventListener("picture-complete",fb):Xb.attachEvent&&Xb.attachEvent("picture-complete",fb);for(var a=Xb.getPictures(),b=[],c=0;c<a.length;c++)b.push(a[c].id);b.length>0&&Xb.fetchPictureByIds(b);var d=gb();db(d,!0)}function fb(b){console.log("tdplayer::onArtistPictureComplete"),console.log(b);for(var c='<span class="label label-inverse">Photos:</span><br>',d=0;d<b.length;d++)b[d].getFiles()&&(c+='<a href="'+b[d].getFiles()[0].url+'" rel="lightbox[npe]" title="Click on the right side of the image to move forward."><img src="'+b[d].getFiles()[0].url+'" width="125" /></a>&nbsp;');a("#asyncData").append(c)}function gb(){if(yb!=c){var a='<span class="label label-inverse">Artist:</span>';a+="<ul><li>Artist id: "+yb.artist().id+"</li>",a+="<li>Artist birth date: "+yb.artist().getBirthDate()+"</li>",a+="<li>Artist end date: "+yb.artist().getEndDate()+"</li>",a+="<li>Artist begin place: "+yb.artist().getBeginPlace()+"</li>",a+="<li>Artist end place: "+yb.artist().getEndPlace()+"</li>",a+="<li>Artist is group ?: "+yb.artist().getIsGroup()+"</li>",a+="<li>Artist country: "+yb.artist().getCountry()+"</li>";for(var b=yb.artist().getAlbums(),d=0;d<b.length;d++)a+="<li>Album "+(d+1)+": "+b[d].getTitle()+"</li>";for(var e=yb.artist().getSimilar(),d=0;d<e.length;d++)a+="<li>Similar artist "+(d+1)+": "+e[d].name+"</li>";for(var f=yb.artist().getMembers(),d=0;d<f.length;d++)a+="<li>Member "+(d+1)+": "+f[d].name+"</li>";a+="<li>Artist website: "+yb.artist().getWebsite()+"</li>",a+="<li>Artist twitter: "+yb.artist().getTwitterUsername()+"</li>",a+="<li>Artist facebook: "+yb.artist().getFacebookUrl()+"</li>",a+="<li>Artist biography: "+yb.artist().getBiography().substring(0,2e3)+"...</small>";for(var g=yb.artist().getGenres(),d=0;d<g.length;d++)a+="<li>Genre "+(d+1)+": "+g[d]+"</li>";return a+="</ul>"}return'<span class="label label-important">The artist information is undefined</span>'}function hb(){var a="NPE Data undefined";if(yb!=c&&yb.album()){var b="";null!=yb.album().getBuyUrl()&&(b='<a target="_blank" title="'+yb.album().getBuyUrl()+'" href="'+yb.album().getBuyUrl()+'">Buy on iTunes</a><br/>'),a="<p><b>Album:</b> "+yb.album().getTitle()+"<br/>"+b+'<img src="'+yb.album().getCoverArtOriginal().url+'" style="height:100px" /></p>'}return a}function ib(){for(var a,c=[],d=b.location.href.slice(b.location.href.indexOf("?")+1).split("&"),e=0;e<d.length;e++)a=d[e].split("="),c.push(a[0]),c[a[0]]=a[1];return c}function jb(b,c){c?console.error(b):console.log(b),a("#debugInformation").append(b),a("#debugInformation").append("\n")}function kb(){a("#debugInformation").html("")}function lb(){if("undefined"!=typeof Modernizr&&Modernizr.audio){var b=document.querySelectorAll(".content"),c=a(b);c.on("click",".podcast__btn--play",function(b){var c=a(b.currentTarget);l(b),bc(c.attr("data-mp3-src")),Zb(),gc(c.attr("data-mp3-title"),c.attr("data-mp3-artist"),c.attr("data-mp3-hash"))}),c.on("click",".podcast__btn--pause",cc)}else{var d=a(".gmr-mediaelement-fallback audio"),e=a(".podcast__play");d.mediaelementplayer(),e.hide()}}function mb(){is_gigya_user_logged_in()?a.support.pjax&&a(document).pjax("a:not(.ab-item)",".main",{fragment:".main",maxCacheLength:500,timeout:5e3}):gmlp.logged_in&&a.support.pjax&&a(document).pjax("a:not(.ab-item)",".page-wrap",{fragment:".page-wrap",maxCacheLength:500,timeout:5e3})}function nb(){a(document).on("pjax:click",function(a){a.preventDefault()})}function ob(){var a,b=document.querySelectorAll(".audio__progress"),c=0;for(a=0;a<b.length;++a)Bb.currentTime>0&&(c=Math.floor(100/Bb.duration*Bb.currentTime)),b[a].style.width=c+"%"}function pb(){var a,b,c,d=document.querySelectorAll(".audio__time--remaining"),e=parseInt(Bb.duration),f=parseInt(Bb.currentTime),g=e-f;for(a=0;a<d.length;++a)b=g%60,c=Math.floor(g/60)%60,b=10>b?"0"+b:b,c=10>c?+c:c,d[a].innerHTML=c+":"+b}function qb(){var a,b=document.querySelectorAll(".audio__time--elapsed"),c=parseInt(Bb.currentTime%60),d=parseInt(Bb.currentTime/60%60);for(a=0;a<b.length;++a)b[a].innerHTML=10>c?d+":0"+c:d+":"+c}var rb,sb,tb,ub,vb,wb,xb,yb,zb,Ab=(ib().tech||"html5_flash","false"==ib().aSyncCuePointFallback?!1:!0,!1),Bb=!1,Cb=document.querySelector("body"),Db=document.getElementById("td_container"),Eb=document.getElementById("live-player"),Fb=document.querySelector(".live-stream__player"),Gb=document.getElementById("playButton"),Hb=document.getElementById("pauseButton"),Ib=document.getElementById("resumeButton"),Jb=document.querySelector(".podcast__btn--play"),Kb=document.querySelector(".podcast__btn--pause"),Lb=document.querySelector(".podcast-player"),Mb=(document.querySelector(".podcast__btn--play.playing"),document.getElementById("live-stream__listen-now")),Nb=document.getElementById("live-stream__now-playing"),Ob=a(document.getElementById("trackInfo")),Pb=gmr.homeUrl+"members/login",Qb=document.getElementById("clearDebug"),Rb=document.getElementById("ad-check"),Sb=(document.getElementById("close-adblock"),document.querySelector(".on-air__title"),document.querySelector(".on-air__show"),document.getElementById("live-stream__status")),Tb=document.getElementById("nowPlaying"),Ub="click";b.tdPlayerApiReady=function(){console.log("--- TD Player API Loaded ---"),f()};var Vb=function(){var a=Mb.textContent,b=document.getElementById("trackInfo"),c=document.getElementById("npeInfo");!0===Ab&&(Bb.pause(),b.innerHTML="",c.innerHTML="",Zb(),m(),Ab=!1),"Switch to Live Stream"===a&&(Mb.innerHTML="Listen Live"),1==Cookies.get("gmr_play_live_audio")?t():u()};n();var Wb=a(".live-player__stream--current-name");Wb.bind("DOMSubtreeModified",function(){console.log("--- new stream select ---");var a=Wb.text();xb&&rb.stop(),!0===Ab&&dc(),rb.play({station:a,timeShift:!0}),h()});var Xb,Yb=function(){"undefined"!=typeof rb&&"undefined"!=typeof rb.stop&&rb.stop()},Zb=function(){a(".podcast__btn--play.playing").removeClass("playing"),a(".podcast__btn--pause.playing").removeClass("playing")},$b=function(){var b=".mp3-"+ub;a(b+" .podcast__btn--play").addClass("playing"),a(b+" .podcast__btn--pause").addClass("playing")},_b=function(a){Bb.src=a},ac=function(){Ab=!0,Yb(),Bb.play(),ec(),fc(),Zb(),setTimeout(h,1e3),$b(),k()},bc=function(a){mb(),a!==Bb.src&&_b(a),ac()},cc=function(){nb(),Bb.pause(),Zb(),j()},dc=function(){nb(),Bb.pause(),Zb(),Ab=!1,i(),m()},ec=function(){var b=_.template('<div class="now-playing__title"><%- title %></div>'),c=a(".now-playing__title");c.length>0?c.text(tb):Ob.prepend(b({title:tb}))},fc=function(){var b=_.template('<div class="now-playing__artist"><%- artist %></div>'),c=a(".now-playing__artist");c.length>0?c.text(sb):Ob.append(b({artist:sb}))},gc=function(a,b,c){tb=a,sb=b,ub=c,ec(),fc(),$b()},hc=function(){"undefined"!=typeof Modernizr&&Modernizr.audio&&(Bb=new Audio,Bb.addEventListener?Bb.addEventListener("ended",function(){Zb(),j()}):Bb.attachEvent&&Bb.attachEvent("ended",function(){Zb(),j()}))};hc(),lb(),Bb.addEventListener("timeupdate",function(){ob(),qb(),pb()},!1),d(Jb,Ub,k),d(Kb,Ub,cc),a(document).on("pjax:end",function(){lb(),$b(),d(Jb,Ub,k),d(Kb,Ub,cc)})}(jQuery,window);