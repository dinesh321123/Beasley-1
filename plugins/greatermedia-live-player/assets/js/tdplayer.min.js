!function(a,b,c){"use strict";function d(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c)}function e(){var a;switch(bb){case"html5_flash":a=["Html5","Flash"];break;case"flash":a=["Flash"];break;case"html5":a=["Html5"];break;case"flash_html5":default:a=["Flash","Html5"]}var b={coreModules:[{id:"MediaPlayer",playerId:"td_container",isDebug:!0,techPriority:["Html5","Flash"],timeShift:{active:0,max_listening_time:35},geoTargeting:{desktop:{isActive:!1},iOS:{isActive:!1},android:{isActive:!1}},plugins:[{id:"vastAd"}]},{id:"NowPlayingApi"},{id:"Npe"},{id:"PlayerWebAdmin"},{id:"SyncBanners",elements:[{id:"td_synced_bigbox",width:300,height:250}]},{id:"TargetSpot"}]};require(["tdapi/base/util/Companions"],function(a){ab=new a}),U=new TdPlayerApi(b),U.addEventListener?(U.addEventListener("player-ready",o),U.addEventListener("configuration-error",C),U.addEventListener("module-error",D)):U.attachEvent&&(U.attachEvent("player-ready",o),U.attachEvent("configuration-error",C),U.attachEvent("module-error",D)),U.loadModules()}function f(){var b=a(".mejs-play");null!=fb&&d(fb,mb,k),null!=gb&&d(gb,mb,l),null!=hb&&d(hb,mb,m),null!=lb&&d(lb,mb,S),b.click(function(){gb.hide(),hb.show(),l()})}function g(){null!==eb&&(eb.classList.add("stream__active"),fb.style.display="none",hb.style.display="none",gb.style.display="block",ib.style.display="none",jb.style.display="inline-block")}function h(){null!==eb&&(fb.style.display="block",gb.style.display="none",ib.style.display="inline-block",jb.style.display="none")}function i(){null!==eb&&(fb.style.display="none",gb.style.display="none",ib.style.display="inline-block",jb.style.display="none",hb.style.display="block")}function j(){is_gigya_user_logged_in()?1==Cookies.get("gmlp_play_button_pushed")&&(k(),Cookies.set("gmlp_play_button_pushed",0)):console.log("--- Log In with Gigya ---")}function k(){if(!0===cb)tb();else{var a=gmr.callsign;if(""==a)return void alert("Please enter a Station");R("playLiveStream - station="+a),Z&&U.stop(),U.play({station:a,timeShift:!0})}g()}function l(){!0===cb?vb():U.pause(),i()}function m(){!0===cb?tb():Z?U.resume():U.play(),g()}function n(){if(""==a("#songHistoryCallsignUser").val())return void alert("Please enter a Callsign");var b="hdConnection"==a("#songHistoryConnectionTypeSelect").val();U.NowPlayingApi.load({mount:a("#songHistoryCallsignUser").val(),hd:b,numberToFetch:15})}function o(){U.MediaPlayer!=c&&(j(),f(),U.addEventListener?(U.addEventListener("track-cue-point",s),U.addEventListener("ad-break-cue-point",v),U.addEventListener("stream-track-change",t),U.addEventListener("hls-cue-point",u),U.addEventListener("stream-status",E),U.addEventListener("stream-geo-blocked",F),U.addEventListener("timeout-alert",A),U.addEventListener("timeout-reach",B),U.addEventListener("npe-song",K),U.addEventListener("stream-select",q),U.addEventListener("stream-start",p),U.addEventListener("stream-stop",r)):U.attachEvent&&(U.attachEvent("track-cue-point",s),U.attachEvent("ad-break-cue-point",v),U.attachEvent("stream-track-change",t),U.attachEvent("hls-cue-point",u),U.attachEvent("stream-status",E),U.attachEvent("stream-geo-blocked",F),U.attachEvent("timeout-alert",A),U.attachEvent("timeout-reach",B),U.attachEvent("npe-song",K),U.attachEvent("stream-select",q),U.attachEvent("stream-start",p),U.attachEvent("stream-stop",r)),U.setVolume(1),G("Api Ready"),H(U.MediaPlayer.tech.type),U.addEventListener?(U.addEventListener("list-loaded",x),U.addEventListener("list-empty",y),U.addEventListener("nowplaying-api-error",z)):U.attachEvent&&(U.attachEvent("list-loaded",x),U.attachEvent("list-empty",y),U.attachEvent("nowplaying-api-error",z)),a("#fetchSongHistoryByUserCallsignButton").click(function(){n()}),U.addEventListener?U.addEventListener("pwa-data-loaded",J):U.attachEvent&&U.attachEvent("pwa-data-loaded",J),a("#pwaButton").click(function(){I()}))}function p(){Z=!0}function q(){a("#hasHQ").html(U.MediaPlayer.hasHQ().toString()),a("#isHQ").html(U.MediaPlayer.isHQ().toString()),a("#hasLow").html(U.MediaPlayer.hasLow().toString()),a("#isLow").html(U.MediaPlayer.isLow().toString())}function r(){Z=!1,w(),a("#trackInfo").html(""),a("#asyncData").html(""),a("#hasHQ").html("N/A"),a("#isHQ").html("N/A"),a("#hasLow").html("N/A"),a("#isLow").html("N/A")}function s(b){R("New Track cuepoint received"),R("Title:"+b.data.cuePoint.cueTitle+" - Artist:"+b.data.cuePoint.artistName),console.log(b),Y&&Y!=b.data.cuePoint&&w(),b.data.cuePoint.nowplayingURL&&U.Npe.loadNpeMetadata(b.data.cuePoint.nowplayingURL,b.data.cuePoint.artistName,b.data.cuePoint.cueTitle),Y=b.data.cuePoint,a("#trackInfo").html('<div class="now-playing__title">'+Y.cueTitle+'</div><div class="now-playing__artist">'+Y.artistName+"</div>")}function t(a){R("Stream Track has changed"),R("Codec:"+a.data.cuePoint.audioTrack.codec()+" - Bitrate:"+a.data.cuePoint.audioTrack.bitRate())}function u(a){R("New HLS cuepoint received"),R("Track Id:"+a.data.cuePoint.hlsTrackId+" SegmentId:"+a.data.cuePoint.hlsSegmentId),console.log(a)}function v(a){G("Commercial break..."),console.log(a)}function w(){a("#npeInfo").html(""),a("#asyncData").html("")}function x(b){R("Song History loaded"),console.log(b.data),a("#asyncData").html('<br><p><span class="label label-warning">Song History:</span>');var c,d='<table class="table table-striped"><thead><tr><th>Song title</th><th>Artist name</th><th>Time</th></tr></thead>';a.each(b.data.list,function(a,b){c=new Date(Number(b.cueTimeStart)),d+="<tr><td>"+b.cueTitle+"</td><td>"+b.artistName+"</td><td>"+c.toLocaleTimeString()+"</td></tr>"}),d+="</table></p>",a("#asyncData").html("<div>"+d+"</div>")}function y(){a("#asyncData").html('<br><p><span class="label label-important">Song History is empty</span>')}function z(b){R("Song History loading error",!0),console.error(b),a("#asyncData").html('<br><p><span class="label label-important">Song History error</span>')}function A(){R("Time Out Alert")}function B(){R("Time Out Reached")}function C(a){R("Configuration error",!0),console.log(a)}function D(b){var c="";a.each(b.data.errors,function(a,b){c+="ERROR : "+b.data.error.message+"<br/>"}),a("#status").html('<p><span class="label label-important">'+c+"</span><p></p>")}function E(a){console.log("tdplayer::onStatus"),G(a.data.status)}function F(a){console.log("tdplayer::onGeoBlocked"),G(a.data.text)}function G(b){R(b),a("#status").html('<p><span class="label label-success">Status: '+b+"</span></p>")}function H(b){var c=U.version.major+"."+U.version.minor+"."+U.version.patch+"."+U.version.flag,d='<p><span class="label label-info">Api version: '+c+" - Technology: "+b;U.flash.available&&(d+=" - Your current version of flash plugin is: "+U.flash.version.major+"."+U.flash.version.minor+"."+U.flash.version.rev),d+="</span></p>",a("#techInfo").html(d)}function I(){return""==a("#pwaCallsign").val()||""==a("#pwaStreamId").val()?void alert("Please enter a Callsign and a streamid"):void U.PlayerWebAdmin.load(a("#pwaCallsign").val(),a("#pwaStreamId").val())}function J(b){R("PlayerWebAdmin data loaded successfully"),console.log(b),a("#asyncData").html('<br><p><span class="label label-warning">PlayerWebAdmin:</span>');var c='<table class="table table-striped"><thead><tr><th>Key</th><th>Value</th></tr></thead>';for(var d in b.data.config)console.log(d),c+="<tr><td>"+d+"</td><td>"+b.data.config[d]+"</td></tr>";c+="</table></p>",a("#asyncData").html("<div>"+c+"</div>")}function K(a){console.log("tdplayer::onNPESong"),console.log(a),$=a.data.song,ob=$.artist(),ob.addEventListener?ob.addEventListener("artist-complete",M):ob.attachEvent&&ob.attachEvent("artist-complete",M);var b=P();L(b,!1)}function L(b,c){a("#asyncData").empty();var d=c?"asyncData":"npeInfo",e=a("#"+d);0==c&&e.html('<span class="label label-inverse">Npe Info:</span>'),e.append(b)}function M(){ob.addEventListener?ob.addEventListener("picture-complete",N):ob.attachEvent&&ob.attachEvent("picture-complete",N);for(var a=ob.getPictures(),b=[],c=0;c<a.length;c++)b.push(a[c].id);b.length>0&&ob.fetchPictureByIds(b);var d=O();L(d,!0)}function N(b){console.log("tdplayer::onArtistPictureComplete"),console.log(b);for(var c='<span class="label label-inverse">Photos:</span><br>',d=0;d<b.length;d++)b[d].getFiles()&&(c+='<a href="'+b[d].getFiles()[0].url+'" rel="lightbox[npe]" title="Click on the right side of the image to move forward."><img src="'+b[d].getFiles()[0].url+'" width="125" /></a>&nbsp;');a("#asyncData").append(c)}function O(){if($!=c){var a='<span class="label label-inverse">Artist:</span>';a+="<ul><li>Artist id: "+$.artist().id+"</li>",a+="<li>Artist birth date: "+$.artist().getBirthDate()+"</li>",a+="<li>Artist end date: "+$.artist().getEndDate()+"</li>",a+="<li>Artist begin place: "+$.artist().getBeginPlace()+"</li>",a+="<li>Artist end place: "+$.artist().getEndPlace()+"</li>",a+="<li>Artist is group ?: "+$.artist().getIsGroup()+"</li>",a+="<li>Artist country: "+$.artist().getCountry()+"</li>";for(var b=$.artist().getAlbums(),d=0;d<b.length;d++)a+="<li>Album "+(d+1)+": "+b[d].getTitle()+"</li>";for(var e=$.artist().getSimilar(),d=0;d<e.length;d++)a+="<li>Similar artist "+(d+1)+": "+e[d].name+"</li>";for(var f=$.artist().getMembers(),d=0;d<f.length;d++)a+="<li>Member "+(d+1)+": "+f[d].name+"</li>";a+="<li>Artist website: "+$.artist().getWebsite()+"</li>",a+="<li>Artist twitter: "+$.artist().getTwitterUsername()+"</li>",a+="<li>Artist facebook: "+$.artist().getFacebookUrl()+"</li>",a+="<li>Artist biography: "+$.artist().getBiography().substring(0,2e3)+"...</small>";for(var g=$.artist().getGenres(),d=0;d<g.length;d++)a+="<li>Genre "+(d+1)+": "+g[d]+"</li>";return a+="</ul>"}return'<span class="label label-important">The artist information is undefined</span>'}function P(){var a="NPE Data undefined";if($!=c&&$.album()){var b="";null!=$.album().getBuyUrl()&&(b='<a target="_blank" title="'+$.album().getBuyUrl()+'" href="'+$.album().getBuyUrl()+'">Buy on iTunes</a><br/>'),a="<p><b>Album:</b> "+$.album().getTitle()+"<br/>"+b+'<img src="'+$.album().getCoverArtOriginal().url+'" style="height:100px" /></p>'}return a}function Q(){for(var a,c=[],d=b.location.href.slice(b.location.href.indexOf("?")+1).split("&"),e=0;e<d.length;e++)a=d[e].split("="),c.push(a[0]),c[a[0]]=a[1];return c}function R(b,c){c?console.error(b):console.log(b),a("#debugInformation").append(b),a("#debugInformation").append("\n")}function S(){a("#debugInformation").html("")}function T(){if("undefined"!=typeof Modernizr&&Modernizr.audio){var b=document.querySelectorAll(".content"),c=a(b);c.on("click",".podcast__btn--play",function(b){var c=a(b.currentTarget);ub(c.attr("data-mp3-src")),qb(),zb(c.attr("data-mp3-title"),c.attr("data-mp3-artist"),c.attr("data-mp3-hash"))}),c.on("click",".podcast__btn--pause",vb)}else{var d=a(".gmr-mediaelement-fallback audio"),e=a(".podcast__play");d.mediaelementplayer(),e.hide()}}var U,V,W,X,Y,Z,$,ab,bb=Q().tech||"html5_flash",cb=("false"==Q().aSyncCuePointFallback?!1:!0,!1),db=!1,eb=document.getElementById("td_container"),fb=document.getElementById("playButton"),gb=document.getElementById("pauseButton"),hb=document.getElementById("resumeButton"),ib=document.getElementById("live-stream__listen-now"),jb=document.getElementById("live-stream__now-playing"),kb=a(document.getElementById("trackInfo")),lb=(gmr.homeUrl+"members/login",document.getElementById("clearDebug")),mb="click";b.tdPlayerApiReady=function(){console.log("--- TD Player API Loaded ---"),e()},gmr.logged_in&&a(document).pjax("a:not(.ab-item)","div.page-wrap",{fragment:"div.page-wrap",maxCacheLength:500,timeout:5e3});var nb=a(".live-player__stream--current-name");nb.bind("DOMSubtreeModified",function(){console.log("--- new stream select ---");var a=nb.text();Z&&U.stop(),!0===cb&&wb(),U.play({station:a,timeShift:!0}),g()});var ob,pb=function(){"undefined"!=typeof U&&"undefined"!=typeof U.stop&&U.stop()},qb=function(){a(".podcast__btn--play.playing").removeClass("playing"),a(".podcast__btn--pause.playing").removeClass("playing")},rb=function(){var b=".mp3-"+X;a(b+" .podcast__btn--play").addClass("playing"),a(b+" .podcast__btn--pause").addClass("playing")},sb=function(a){db.src=a},tb=function(){cb=!0,pb(),db.play(),xb(),yb(),g(),qb(),rb()},ub=function(a){sb(a),tb()},vb=function(){db.pause(),qb(),i()},wb=function(){db.pause(),qb(),cb=!1,h()},xb=function(){var b=_.template('<div class="now-playing__title"><%- title %></div>'),c=a(".now-playing__title");c.length>0?c.text(W):kb.prepend(b({title:W}))},yb=function(){var b=_.template('<div class="now-playing__artist"><%- artist %></div>'),c=a(".now-playing__artist");c.length>0?c.text(V):kb.append(b({artist:V}))},zb=function(a,b,c){W=a,V=b,X=c,xb(),yb(),rb()},Ab=function(){"undefined"!=typeof Modernizr&&Modernizr.audio&&(db=new Audio,db.addEventListener?db.addEventListener("ended",function(){qb(),i()}):db.attachEvent&&db.attachEvent("ended",function(){qb(),i()}))};Ab(),T(),a(document).on("pjax:end",function(){T(),rb()})}(jQuery,window);