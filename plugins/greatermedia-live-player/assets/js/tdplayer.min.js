!function(a,b,c){"use strict";function d(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c)}function e(){var a;switch(tb){case"html5_flash":a=["Html5","Flash"];break;case"flash":a=["Flash"];break;case"html5":a=["Html5"];break;case"flash_html5":default:a=["Flash","Html5"]}var b={coreModules:[{id:"MediaPlayer",playerId:"td_container",isDebug:!0,techPriority:["Flash","Html5"],timeShift:{active:0,max_listening_time:35},geoTargeting:{desktop:{isActive:!1},iOS:{isActive:!1},android:{isActive:!1}},plugins:[{id:"vastAd"}]},{id:"NowPlayingApi"},{id:"Npe"},{id:"PlayerWebAdmin"},{id:"SyncBanners",elements:[{id:"td_synced_bigbox",width:300,height:250}]},{id:"TargetSpot"}]};require(["tdapi/base/util/Companions"],function(a){sb=new a}),kb=new TdPlayerApi(b),kb.addEventListener?(kb.addEventListener("player-ready",v),kb.addEventListener("configuration-error",P),kb.addEventListener("module-error",Q)):kb.attachEvent&&(kb.attachEvent("player-ready",v),kb.attachEvent("configuration-error",P),kb.attachEvent("module-error",Q)),kb.loadModules()}function f(){null!=yb&&d(yb,Ib,s),null!=zb&&d(zb,Ib,t),null!=Eb&&d(Eb,Ib,gb)}function g(){null!==wb&&(wb.classList.add("stream__active"),xb.style.display="none",zb.style.display="none",yb.style.display="block",Ab.style.display="none",Hb.style.display="none",Bb.style.display="inline-block")}function h(){null!==wb&&(xb.style.display="block",yb.style.display="none",Ab.style.display="inline-block",Hb.style.display="none",Bb.style.display="none")}function i(){null!==wb&&(xb.style.display="none",yb.style.display="none",Ab.style.display="inline-block",Hb.style.display="none",Bb.style.display="none",zb.style.display="block")}function j(){is_gigya_user_logged_in()?(null!=xb&&d(xb,Ib,q),null!=Ab&&d(Ab,Ib,q)):(null!=xb&&d(xb,"click",function(){b.location.href=Db}),null!=Hb&&d(Hb,"click",function(){b.location.href=Db}))}function k(){is_gigya_user_logged_in()&&(h(),1==Cookies.get("gmlp_play_button_pushed")?(r(),Cookies.set("gmlp_play_button_pushed",0)):console.log("--- Log In with Gigya ---"))}function l(){var a=document.getElementById("live-stream__container");null!=a&&a.classList.add("vast__pre-roll")}function m(){var a=document.getElementById("live-stream__container");null!=a&&a.classList.remove("vast__pre-roll")}function n(){var a=gmr.streamUrl;Y(),X(),kb.stop(),kb.playAd("vastAd",{url:a})}function o(){var a=document.querySelector(".vast__pre-roll");null!=a&&(a.innerHTML='<div class="adblock--detected"><div class="adblock--detected__notice">We\'ve detected that you\'re using <strong>AdBlock Plus</strong> or some other adblocking software. In order to have the best viewing experience, please diasable AdBlock.</div></div>')}function p(){for(var a=document.getElementById("live-stream__container");a.hasChildNodes();)a.removeChild(a.firstChild);a.classList.remove("vast__pre-roll")}function q(){if(ib(),!0===ub)Pb(),g();else if(Fb==c)l(),o(),setTimeout(m,15e3);else{var a=gmr.callsign;if(""==a)return void alert("Please enter a Station");fb("playLiveStream - station="+a),qb&&kb.stop(),kb.play({station:a,timeShift:!0}),g()}}function r(){if(!0===ub)Pb(),g();else{{var a=gmr.callsign;gmr.streamUrl}if(""==a)return void alert("Please enter a Station");fb("playLiveStream - station="+a),l(),Fb==c?(o(),setTimeout(m,15e3)):n(),kb.addEventListener?kb.addEventListener("ad-playback-complete",function(){m(),console.log("--- ad complete ---"),qb&&kb.stop(),kb.play({station:a,timeShift:!0}),g()}):kb.attachEvent&&kb.attachEvent("ad-playback-complete",function(){m(),console.log("--- ad complete ---"),qb&&kb.stop(),kb.play({station:a,timeShift:!0}),g()})}}function s(){!0===ub?Rb():kb.pause(),i()}function t(){!0===ub?Pb():qb?kb.resume():kb.play(),g()}function u(){if(""==a("#songHistoryCallsignUser").val())return void alert("Please enter a Callsign");var b="hdConnection"==a("#songHistoryConnectionTypeSelect").val();kb.NowPlayingApi.load({mount:a("#songHistoryCallsignUser").val(),hd:b,numberToFetch:15})}function v(){kb.MediaPlayer!=c&&(k(),f(),kb.addEventListener?(kb.addEventListener("track-cue-point",F),kb.addEventListener("ad-break-cue-point",I),kb.addEventListener("stream-track-change",G),kb.addEventListener("hls-cue-point",H),kb.addEventListener("stream-status",R),kb.addEventListener("stream-geo-blocked",S),kb.addEventListener("timeout-alert",N),kb.addEventListener("timeout-reach",O),kb.addEventListener("npe-song",Z),kb.addEventListener("stream-select",D),kb.addEventListener("stream-start",C),kb.addEventListener("stream-stop",E)):kb.attachEvent&&(kb.attachEvent("track-cue-point",F),kb.attachEvent("ad-break-cue-point",I),kb.attachEvent("stream-track-change",G),kb.attachEvent("hls-cue-point",H),kb.attachEvent("stream-status",R),kb.attachEvent("stream-geo-blocked",S),kb.attachEvent("timeout-alert",N),kb.attachEvent("timeout-reach",O),kb.attachEvent("npe-song",Z),kb.attachEvent("stream-select",D),kb.attachEvent("stream-start",C),kb.attachEvent("stream-stop",E)),kb.setVolume(1),T("Api Ready"),U(kb.MediaPlayer.tech.type),kb.addEventListener?(kb.addEventListener("list-loaded",K),kb.addEventListener("list-empty",L),kb.addEventListener("nowplaying-api-error",M)):kb.attachEvent&&(kb.attachEvent("list-loaded",K),kb.attachEvent("list-empty",L),kb.attachEvent("nowplaying-api-error",M)),a("#fetchSongHistoryByUserCallsignButton").click(function(){u()}),kb.addEventListener?kb.addEventListener("pwa-data-loaded",W):kb.attachEvent&&kb.attachEvent("pwa-data-loaded",W),a("#pwaButton").click(function(){V()}))}function w(a){ob=!0,T("Advertising... Type="+a.data.type)}function x(){ob=!1,a("#td_adserver_bigbox").empty(),a("#td_adserver_leaderboard").empty(),T("Ready")}function y(a){fb("Ad countdown : "+a.data.countDown+" second(s)")}function z(a){fb("Vast Process complete");var b=a.data.companions;B(b)}function A(a){fb("Vpaid Ad Companions"),B(a.companions)}function B(b){if(b&&b.length>0){var c=-1,d=-1;a.each(b,function(a,b){300==parseInt(b.width)&&250==parseInt(b.height)?c=a:728==parseInt(b.width)&&90==parseInt(b.height)&&(d=a)}),c>-1&&sb.loadVASTCompanionAd("td_adserver_bigbox",b[c]),d>-1&&sb.loadVASTCompanionAd("td_adserver_leaderboard",b[d])}}function C(){qb=!0}function D(){a("#hasHQ").html(kb.MediaPlayer.hasHQ().toString()),a("#isHQ").html(kb.MediaPlayer.isHQ().toString()),a("#hasLow").html(kb.MediaPlayer.hasLow().toString()),a("#isLow").html(kb.MediaPlayer.isLow().toString())}function E(){qb=!1,J(),a("#trackInfo").html(""),a("#asyncData").html(""),a("#hasHQ").html("N/A"),a("#isHQ").html("N/A"),a("#hasLow").html("N/A"),a("#isLow").html("N/A")}function F(b){fb("New Track cuepoint received"),fb("Title:"+b.data.cuePoint.cueTitle+" - Artist:"+b.data.cuePoint.artistName),console.log(b),pb&&pb!=b.data.cuePoint&&J(),b.data.cuePoint.nowplayingURL&&kb.Npe.loadNpeMetadata(b.data.cuePoint.nowplayingURL,b.data.cuePoint.artistName,b.data.cuePoint.cueTitle),pb=b.data.cuePoint,a("#trackInfo").html('<div class="now-playing__title">'+pb.cueTitle+'</div><div class="now-playing__artist">'+pb.artistName+"</div>")}function G(a){fb("Stream Track has changed"),fb("Codec:"+a.data.cuePoint.audioTrack.codec()+" - Bitrate:"+a.data.cuePoint.audioTrack.bitRate())}function H(a){fb("New HLS cuepoint received"),fb("Track Id:"+a.data.cuePoint.hlsTrackId+" SegmentId:"+a.data.cuePoint.hlsSegmentId),console.log(a)}function I(a){T("Commercial break..."),console.log(a)}function J(){a("#npeInfo").html(""),a("#asyncData").html("")}function K(b){fb("Song History loaded"),console.log(b.data),a("#asyncData").html('<br><p><span class="label label-warning">Song History:</span>');var c,d='<table class="table table-striped"><thead><tr><th>Song title</th><th>Artist name</th><th>Time</th></tr></thead>';a.each(b.data.list,function(a,b){c=new Date(Number(b.cueTimeStart)),d+="<tr><td>"+b.cueTitle+"</td><td>"+b.artistName+"</td><td>"+c.toLocaleTimeString()+"</td></tr>"}),d+="</table></p>",a("#asyncData").html("<div>"+d+"</div>")}function L(){a("#asyncData").html('<br><p><span class="label label-important">Song History is empty</span>')}function M(b){fb("Song History loading error",!0),console.error(b),a("#asyncData").html('<br><p><span class="label label-important">Song History error</span>')}function N(){fb("Time Out Alert")}function O(){fb("Time Out Reached")}function P(a){fb("Configuration error",!0),console.log(a)}function Q(b){var c="";a.each(b.data.errors,function(a,b){c+="ERROR : "+b.data.error.message+"<br/>"}),a("#status").html('<p><span class="label label-important">'+c+"</span><p></p>")}function R(a){console.log("tdplayer::onStatus"),T(a.data.status)}function S(a){console.log("tdplayer::onGeoBlocked"),T(a.data.text)}function T(b){fb(b),a("#status").html('<p><span class="label label-success">Status: '+b+"</span></p>")}function U(b){var c=kb.version.major+"."+kb.version.minor+"."+kb.version.patch+"."+kb.version.flag,d='<p><span class="label label-info">Api version: '+c+" - Technology: "+b;kb.flash.available&&(d+=" - Your current version of flash plugin is: "+kb.flash.version.major+"."+kb.flash.version.minor+"."+kb.flash.version.rev),d+="</span></p>",a("#techInfo").html(d)}function V(){return""==a("#pwaCallsign").val()||""==a("#pwaStreamId").val()?void alert("Please enter a Callsign and a streamid"):void kb.PlayerWebAdmin.load(a("#pwaCallsign").val(),a("#pwaStreamId").val())}function W(b){fb("PlayerWebAdmin data loaded successfully"),console.log(b),a("#asyncData").html('<br><p><span class="label label-warning">PlayerWebAdmin:</span>');var c='<table class="table table-striped"><thead><tr><th>Key</th><th>Value</th></tr></thead>';for(var d in b.data.config)console.log(d),c+="<tr><td>"+d+"</td><td>"+b.data.config[d]+"</td></tr>";c+="</table></p>",a("#asyncData").html("<div>"+c+"</div>")}function X(){kb.addEventListener?(kb.addEventListener("ad-playback-start",w),kb.addEventListener("ad-playback-error",x),kb.addEventListener("ad-playback-complete",x),kb.addEventListener("ad-countdown",y),kb.addEventListener("vast-process-complete",z),kb.addEventListener("vpaid-ad-companions",A)):kb.attachEvent&&(kb.attachEvent("ad-playback-start",w),kb.attachEvent("ad-playback-error",x),kb.attachEvent("ad-playback-complete",x),kb.attachEvent("ad-countdown",y),kb.attachEvent("vast-process-complete",z),kb.attachEvent("vpaid-ad-companions",A))}function Y(){kb.removeEventListener?(kb.removeEventListener("ad-playback-start",w),kb.removeEventListener("ad-playback-error",x),kb.removeEventListener("ad-playback-complete",x),kb.removeEventListener("ad-countdown",y),kb.removeEventListener("vast-process-complete",z),kb.removeEventListener("vpaid-ad-companions",A)):kb.detachEvent&&(kb.detachEvent("ad-playback-start",w),kb.detachEvent("ad-playback-error",x),kb.detachEvent("ad-playback-complete",x),kb.detachEvent("ad-countdown",y),kb.detachEvent("vast-process-complete",z),kb.detachEvent("vpaid-ad-companions",A))}function Z(a){console.log("tdplayer::onNPESong"),console.log(a),rb=a.data.song,Kb=rb.artist(),Kb.addEventListener?Kb.addEventListener("artist-complete",ab):Kb.attachEvent&&Kb.attachEvent("artist-complete",ab);var b=db();$(b,!1)}function $(b,c){a("#asyncData").empty();var d=c?"asyncData":"npeInfo",e=a("#"+d);0==c&&e.html('<span class="label label-inverse">Npe Info:</span>'),e.append(b)}function ab(){Kb.addEventListener?Kb.addEventListener("picture-complete",bb):Kb.attachEvent&&Kb.attachEvent("picture-complete",bb);for(var a=Kb.getPictures(),b=[],c=0;c<a.length;c++)b.push(a[c].id);b.length>0&&Kb.fetchPictureByIds(b);var d=cb();$(d,!0)}function bb(b){console.log("tdplayer::onArtistPictureComplete"),console.log(b);for(var c='<span class="label label-inverse">Photos:</span><br>',d=0;d<b.length;d++)b[d].getFiles()&&(c+='<a href="'+b[d].getFiles()[0].url+'" rel="lightbox[npe]" title="Click on the right side of the image to move forward."><img src="'+b[d].getFiles()[0].url+'" width="125" /></a>&nbsp;');a("#asyncData").append(c)}function cb(){if(rb!=c){var a='<span class="label label-inverse">Artist:</span>';a+="<ul><li>Artist id: "+rb.artist().id+"</li>",a+="<li>Artist birth date: "+rb.artist().getBirthDate()+"</li>",a+="<li>Artist end date: "+rb.artist().getEndDate()+"</li>",a+="<li>Artist begin place: "+rb.artist().getBeginPlace()+"</li>",a+="<li>Artist end place: "+rb.artist().getEndPlace()+"</li>",a+="<li>Artist is group ?: "+rb.artist().getIsGroup()+"</li>",a+="<li>Artist country: "+rb.artist().getCountry()+"</li>";for(var b=rb.artist().getAlbums(),d=0;d<b.length;d++)a+="<li>Album "+(d+1)+": "+b[d].getTitle()+"</li>";for(var e=rb.artist().getSimilar(),d=0;d<e.length;d++)a+="<li>Similar artist "+(d+1)+": "+e[d].name+"</li>";for(var f=rb.artist().getMembers(),d=0;d<f.length;d++)a+="<li>Member "+(d+1)+": "+f[d].name+"</li>";a+="<li>Artist website: "+rb.artist().getWebsite()+"</li>",a+="<li>Artist twitter: "+rb.artist().getTwitterUsername()+"</li>",a+="<li>Artist facebook: "+rb.artist().getFacebookUrl()+"</li>",a+="<li>Artist biography: "+rb.artist().getBiography().substring(0,2e3)+"...</small>";for(var g=rb.artist().getGenres(),d=0;d<g.length;d++)a+="<li>Genre "+(d+1)+": "+g[d]+"</li>";return a+="</ul>"}return'<span class="label label-important">The artist information is undefined</span>'}function db(){var a="NPE Data undefined";if(rb!=c&&rb.album()){var b="";null!=rb.album().getBuyUrl()&&(b='<a target="_blank" title="'+rb.album().getBuyUrl()+'" href="'+rb.album().getBuyUrl()+'">Buy on iTunes</a><br/>'),a="<p><b>Album:</b> "+rb.album().getTitle()+"<br/>"+b+'<img src="'+rb.album().getCoverArtOriginal().url+'" style="height:100px" /></p>'}return a}function eb(){for(var a,c=[],d=b.location.href.slice(b.location.href.indexOf("?")+1).split("&"),e=0;e<d.length;e++)a=d[e].split("="),c.push(a[0]),c[a[0]]=a[1];return c}function fb(b,c){c?console.error(b):console.log(b),a("#debugInformation").append(b),a("#debugInformation").append("\n")}function gb(){a("#debugInformation").html("")}function hb(){if("undefined"!=typeof Modernizr&&Modernizr.audio){var b=document.querySelectorAll(".content"),c=a(b);c.on("click",".podcast__btn--play",function(b){var c=a(b.currentTarget);Qb(c.attr("data-mp3-src")),Mb(),Vb(c.attr("data-mp3-title"),c.attr("data-mp3-artist"),c.attr("data-mp3-hash"))}),c.on("click",".podcast__btn--pause",Rb)}else{var d=a(".gmr-mediaelement-fallback audio"),e=a(".podcast__play");d.mediaelementplayer(),e.hide()}}function ib(){is_gigya_user_logged_in()?a.support.pjax&&a(document).pjax("a:not(.ab-item)",".main",{fragment:".main",maxCacheLength:500,timeout:5e3}):gmlp.logged_in&&a.support.pjax&&a(document).pjax("a:not(.ab-item)",".page-wrap",{fragment:".page-wrap",maxCacheLength:500,timeout:5e3})}function jb(){a(document).on("pjax:click",function(a){a.preventDefault()})}var kb,lb,mb,nb,ob,pb,qb,rb,sb,tb=eb().tech||"html5_flash",ub=("false"==eb().aSyncCuePointFallback?!1:!0,!1),vb=!1,wb=document.getElementById("td_container"),xb=document.getElementById("playButton"),yb=document.getElementById("pauseButton"),zb=document.getElementById("resumeButton"),Ab=document.getElementById("live-stream__listen-now"),Bb=document.getElementById("live-stream__now-playing"),Cb=a(document.getElementById("trackInfo")),Db=gmr.homeUrl+"members/login",Eb=document.getElementById("clearDebug"),Fb=document.getElementById("ad-check"),Gb=document.getElementById("close-adblock"),Hb=document.getElementById("live-stream__login"),Ib="click";b.tdPlayerApiReady=function(){console.log("--- TD Player API Loaded ---"),e()},j(),d(Gb,Ib,p);var Jb=a(".live-player__stream--current-name");Jb.bind("DOMSubtreeModified",function(){console.log("--- new stream select ---");var a=Jb.text();qb&&kb.stop(),!0===ub&&Sb(),kb.play({station:a,timeShift:!0}),g()});var Kb,Lb=function(){"undefined"!=typeof kb&&"undefined"!=typeof kb.stop&&kb.stop()},Mb=function(){a(".podcast__btn--play.playing").removeClass("playing"),a(".podcast__btn--pause.playing").removeClass("playing")},Nb=function(){var b=".mp3-"+nb;a(b+" .podcast__btn--play").addClass("playing"),a(b+" .podcast__btn--pause").addClass("playing")},Ob=function(a){vb.src=a},Pb=function(){ub=!0,Lb(),vb.play(),Tb(),Ub(),g(),Mb(),Nb()},Qb=function(a){ib(),a!==vb.src&&Ob(a),Pb()},Rb=function(){jb(),vb.pause(),Mb(),i()},Sb=function(){jb(),vb.pause(),Mb(),ub=!1,h()},Tb=function(){var b=_.template('<div class="now-playing__title"><%- title %></div>'),c=a(".now-playing__title");c.length>0?c.text(mb):Cb.prepend(b({title:mb}))},Ub=function(){var b=_.template('<div class="now-playing__artist"><%- artist %></div>'),c=a(".now-playing__artist");c.length>0?c.text(lb):Cb.append(b({artist:lb}))},Vb=function(a,b,c){mb=a,lb=b,nb=c,Tb(),Ub(),Nb()},Wb=function(){"undefined"!=typeof Modernizr&&Modernizr.audio&&(vb=new Audio,vb.addEventListener?vb.addEventListener("ended",function(){Mb(),i()}):vb.attachEvent&&vb.attachEvent("ended",function(){Mb(),i()}))};Wb(),hb(),a(document).on("pjax:end",function(){hb(),Nb()})}(jQuery,window);