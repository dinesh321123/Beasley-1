!function(a,b,c){"use strict";function d(a,b,c){null!=a&&(a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c))}function e(){gb("Live stream interval set"),Vb=setInterval(function(){a(yb).trigger("liveStreamPlaying.gmr"),gb("Live stream interval reached")},Wb)}function f(){gb("Inline audio interval set"),Ub=setInterval(function(){a(yb).trigger("inlineAudioPlaying.gmr"),gb("Inline audio interval reached")},Wb)}function g(){clearInterval(Vb),gb("Live stream interval off")}function h(){clearInterval(Ub),gb("Inline audio interval off")}function i(){return bowser.firefox?["Flash","Html5"]:bowser.safari?["Html5","Flash"]:bowser.chrome?["Flash","Html5"]:["Html5","Flash"]}function j(){var a=i();console.log("+++ initPlayer - techPriority = ",a);var b={coreModules:[{id:"MediaPlayer",playerId:"td_container",isDebug:!1,techPriority:a,timeShift:{active:0,max_listening_time:35},geoTargeting:{desktop:{isActive:!1},iOS:{isActive:!1},android:{isActive:!1}},plugins:[{id:"vastAd"}]},{id:"NowPlayingApi"},{id:"Npe"},{id:"PlayerWebAdmin"},{id:"SyncBanners",elements:[{id:"td_synced_bigbox",width:300,height:250}]},{id:"TargetSpot"}]};require(["tdapi/base/util/Companions"],function(a){vb=new a}),ob=new TdPlayerApi(b),ob.addEventListener?(ob.addEventListener("player-ready",E),ob.addEventListener("configuration-error",S),ob.addEventListener("module-error",T)):ob.attachEvent&&(ob.attachEvent("player-ready",E),ob.attachEvent("configuration-error",S),ob.attachEvent("module-error",T)),ob.loadModules()}function k(){null!=Db&&d(Db,Yb,C),null!=Eb&&d(Eb,Yb,B),null!=Ob&&d(Ob,Yb,hb)}function l(){null!==zb&&(zb.classList.add("stream__active"),Cb.classList.add(!0===wb&&b.innerWidth<=767?"live-player__login":"live-player__muted"),Eb.classList.contains("live-player__muted")||Eb.classList.add("live-player__muted"),Eb.classList.contains("resume__live")&&Eb.classList.remove("resume__live"),!0===wb?(Kb.style.display="none",Jb.style.display="inline-block"):(Kb.style.display="inline-block",Jb.style.display="none"),!1===wb&&null!=Fb&&Fb.classList.add("loading"),!0===wb&&null!=Db?Db.classList.contains("live-player__muted")&&Db.classList.remove("live-player__muted"):Db.classList.add("live-player__muted"))}function m(){null!==zb&&(Eb.classList.contains("live-player__muted")&&(Eb.classList.remove("live-player__muted"),Eb.classList.add("resume__live")),Jb.style.display="inline-block",Kb.style.display="none",Db.classList.add("live-player__muted"))}function n(){null!==zb&&(Cb.classList.add(!0===wb&&b.innerWidth<=767?"live-player__login":"live-player__muted"),yb.classList.contains("live-player--active")&&yb.classList.remove("live-player--active"),Jb.style.display="inline-block",Kb.style.display="none",Db.classList.add("live-player__muted"),Eb.classList.contains("live-player__muted")&&(Eb.classList.remove("live-player__muted"),Eb.classList.add("resume__live")),Eb.classList.add("resume__audio"))}function o(){var a,b=document.querySelectorAll(".audio__time");for(a=0;a<b.length;++a)b[a].classList.add("playing");null!=Bb&&Bb.classList.add("audio__playing"),null!=Qb&&Qb.classList.add("audio__playing"),null!=Ab&&Ab.classList.add("playing"),null!=Rb&&Rb.classList.add("playing"),null!=Jb&&setTimeout(function(){Jb.innerHTML="Switch to Live Stream"},1e3)}function p(b){var c,d=b.target,e=d.parentNode,f=e.nextElementSibling,g=f.nextElementSibling,h=document.querySelectorAll(".audio__time"),i=document.querySelector(".podcast__runtime");if(a(".playing__current").removeClass("playing__current"),null!=Ib&&(yb.classList.contains("single-show")||yb.classList.contains("post-type-archive-podcast")||yb.classList.contains("single-podcast")))f.classList.add("playing__current"),g.classList.add("playing");else{for(c=0;c<h.length;++c)null!=h[c]&&(h[c].classList.add("playing"),h[c].classList.add("playing__current"));i.classList.add("playing")}}function q(){var a,b=document.querySelectorAll(".audio__time"),c=document.querySelectorAll(".podcast__runtime");for(a=0;a<b.length;++a)null!=b[a]&&b[a].classList.contains("playing")&&b[a].classList.remove("playing"),null!=b[a]&&b[a].classList.contains("playing__current")&&b[a].classList.remove("playing__current");for(null!=Bb&&Bb.classList.remove("audio__playing"),null!=Qb&&Qb.classList.remove("audio__playing"),null!=Ab&&Ab.classList.remove("playing"),a=0;a<c.length;++a)null!=c[a]&&c[a].classList.contains("playing")&&c[a].classList.remove("playing");null!=Rb&&Rb.classList.remove("playing")}function r(){b.innerWidth<=767&&(""===Sb.innerHTML?(Pb.classList.add("on-air__npe"),Tb.classList.add("full__width")):Pb.classList.contains("on-air__npe")&&(Pb.classList.remove("on-air__npe"),Tb.classList.remove("full__width")))}function s(){null!=Cb&&Cb.classList.add("play-btn--heartbeat"),null!=Ab&&Ab.classList.add("live-player--heartbeat")}function t(){null!=Cb&&Cb.classList.contains("play-btn--heartbeat")&&Cb.classList.remove("play-btn--heartbeat"),null!=Ab&&Ab.classList.contains("live-player--heartbeat")&&Ab.classList.remove("live-player--heartbeat")}function u(){Xb=0}function v(){Xb=1}function w(){var a=setInterval(function(){0===Xb||(1===Xb?(b.innerWidth>=768?A():z(),clearInterval(a)):u())})}function x(){is_gigya_user_logged_in()?(null!=Cb&&d(Cb,Yb,w),null!=Jb&&d(Jb,Yb,Zb)):(null!=Cb&&d(Cb,"click",function(){b.location.href=Nb}),null!=Jb&&d(Jb,"click",function(){b.location.href=Nb}),null!=Lb&&b.innerWidth<=767&&d(Lb,"click",function(){b.location.href=Nb}))}function y(){is_gigya_user_logged_in()&&(m(),1==Cookies.get("gmlp_play_button_pushed")&&(b.innerWidth>=768?A():z(),Cookies.set("gmlp_play_button_pushed",0)))}function z(){var a=gmr.callsign;return""===a?void alert("Please enter a Station"):(!0===wb&&Zb(),gb("playLiveStream - station="+a),tb&&ob.stop(),yb.classList.add("live-player--active"),Ab.classList.add("live-player--active"),ob.play({station:a,timeShift:!0}),void l())}function A(){var a=gmr.callsign;if(jb(),!0===wb)ec(),l();else{if(""===a)return void alert("Please enter a Station");gb("playLiveStream - station="+a),tb&&ob.stop(),yb.classList.add("live-player--active"),Ab.classList.add("live-player--active"),ob.play({station:a,timeShift:!0}),l()}}function B(){if(jb(),!0===wb)ec(),l();else{var a=gmr.callsign;if(""===a)return void alert("Please enter a Station");gb("playLiveStream - station="+a),tb&&ob.stop(),Ab.classList.add("live-player--active"),ob.play({station:a,timeShift:!0}),l()}}function C(){!0===wb?(gc(),h()):(ob.pause(),g()),Ab.classList.contains("live-player--active")&&Ab.classList.remove("live-player--active"),n()}function D(){if(""===a("#songHistoryCallsignUser").val())return void alert("Please enter a Callsign");var b="hdConnection"==a("#songHistoryConnectionTypeSelect").val();ob.NowPlayingApi.load({mount:a("#songHistoryCallsignUser").val(),hd:b,numberToFetch:15})}function E(){ob.MediaPlayer!==c&&(y(),k(),ob.addEventListener?(ob.addEventListener("track-cue-point",I),ob.addEventListener("ad-break-cue-point",L),ob.addEventListener("stream-track-change",J),ob.addEventListener("hls-cue-point",K),ob.addEventListener("stream-status",U),ob.addEventListener("stream-geo-blocked",V),ob.addEventListener("timeout-alert",Q),ob.addEventListener("timeout-reach",R),ob.addEventListener("npe-song",$),ob.addEventListener("stream-select",G),ob.addEventListener("stream-start",F),ob.addEventListener("stream-stop",H)):ob.attachEvent&&(ob.attachEvent("track-cue-point",I),ob.attachEvent("ad-break-cue-point",L),ob.attachEvent("stream-track-change",J),ob.attachEvent("hls-cue-point",K),ob.attachEvent("stream-status",U),ob.attachEvent("stream-geo-blocked",V),ob.attachEvent("timeout-alert",Q),ob.attachEvent("timeout-reach",R),ob.attachEvent("npe-song",$),ob.attachEvent("stream-select",G),ob.attachEvent("stream-start",F),ob.attachEvent("stream-stop",H)),ob.setVolume(1),W("Api Ready"),v(),b.innerWidth>=768&&(s(),setTimeout(t,2e3)),X(ob.MediaPlayer.tech.type),ob.addEventListener?(ob.addEventListener("list-loaded",N),ob.addEventListener("list-empty",O),ob.addEventListener("nowplaying-api-error",P)):ob.attachEvent&&(ob.attachEvent("list-loaded",N),ob.attachEvent("list-empty",O),ob.attachEvent("nowplaying-api-error",P)),a("#fetchSongHistoryByUserCallsignButton").click(function(){D()}),ob.addEventListener?ob.addEventListener("pwa-data-loaded",Z):ob.attachEvent&&ob.attachEvent("pwa-data-loaded",Z),a("#pwaButton").click(function(){Y()}))}function F(){tb=!0,Fb.classList.contains("loading")&&Fb.classList.remove("loading"),Db.classList.contains("live-player__muted")&&Db.classList.remove("live-player__muted"),e()}function G(){a("#hasHQ").html(ob.MediaPlayer.hasHQ().toString()),a("#isHQ").html(ob.MediaPlayer.isHQ().toString()),a("#hasLow").html(ob.MediaPlayer.hasLow().toString()),a("#isLow").html(ob.MediaPlayer.isLow().toString())}function H(){tb=!1,M(),a("#trackInfo").html(""),a("#asyncData").html(""),a("#hasHQ").html("N/A"),a("#isHQ").html("N/A"),a("#hasLow").html("N/A"),a("#isLow").html("N/A"),g()}function I(b){gb("New Track cuepoint received"),gb("Title:"+b.data.cuePoint.cueTitle+" - Artist:"+b.data.cuePoint.artistName),console.log(b),sb&&sb!=b.data.cuePoint&&M(),b.data.cuePoint.nowplayingURL&&ob.Npe.loadNpeMetadata(b.data.cuePoint.nowplayingURL,b.data.cuePoint.artistName,b.data.cuePoint.cueTitle),sb=b.data.cuePoint,a("#trackInfo").html('<div class="now-playing__title">'+sb.cueTitle+'</div><div class="now-playing__artist">'+sb.artistName+"</div>"),setTimeout(r,1e4),a(yb).trigger("liveAudioTrack.gmr")}function J(a){gb("Stream Track has changed"),gb("Codec:"+a.data.cuePoint.audioTrack.codec()+" - Bitrate:"+a.data.cuePoint.audioTrack.bitRate())}function K(a){gb("New HLS cuepoint received"),gb("Track Id:"+a.data.cuePoint.hlsTrackId+" SegmentId:"+a.data.cuePoint.hlsSegmentId),console.log(a)}function L(a){W("Commercial break..."),console.log(a)}function M(){a("#npeInfo").html(""),a("#asyncData").html("")}function N(b){gb("Song History loaded"),console.log(b.data),a("#asyncData").html('<br><p><span class="label label-warning">Song History:</span>');var c,d='<table class="table table-striped"><thead><tr><th>Song title</th><th>Artist name</th><th>Time</th></tr></thead>';a.each(b.data.list,function(a,b){c=new Date(Number(b.cueTimeStart)),d+="<tr><td>"+b.cueTitle+"</td><td>"+b.artistName+"</td><td>"+c.toLocaleTimeString()+"</td></tr>"}),d+="</table></p>",a("#asyncData").html("<div>"+d+"</div>")}function O(){a("#asyncData").html('<br><p><span class="label label-important">Song History is empty</span>')}function P(b){gb("Song History loading error",!0),console.error(b),a("#asyncData").html('<br><p><span class="label label-important">Song History error</span>')}function Q(){gb("Time Out Alert")}function R(){gb("Time Out Reached")}function S(a){gb("Configuration error",!0),console.log(a)}function T(b){var c="";a.each(b.data.errors,function(a,b){c+="ERROR : "+b.data.error.message+"<br/>"}),a("#status").html('<p><span class="label label-important">'+c+"</span><p></p>")}function U(a){console.log("tdplayer::onStatus"),W(a.data.status)}function V(a){console.log("tdplayer::onGeoBlocked"),W(a.data.text)}function W(b){gb(b),a("#status").html('<p><span class="label label-success">Status: '+b+"</span></p>")}function X(b){var c=ob.version.major+"."+ob.version.minor+"."+ob.version.patch+"."+ob.version.flag,d='<p><span class="label label-info">Api version: '+c+" - Technology: "+b;ob.flash.available&&(d+=" - Your current version of flash plugin is: "+ob.flash.version.major+"."+ob.flash.version.minor+"."+ob.flash.version.rev),d+="</span></p>",a("#techInfo").html(d)}function Y(){return""===a("#pwaCallsign").val()||""===a("#pwaStreamId").val()?void alert("Please enter a Callsign and a streamid"):void ob.PlayerWebAdmin.load(a("#pwaCallsign").val(),a("#pwaStreamId").val())}function Z(b){gb("PlayerWebAdmin data loaded successfully"),console.log(b),a("#asyncData").html('<br><p><span class="label label-warning">PlayerWebAdmin:</span>');var c='<table class="table table-striped"><thead><tr><th>Key</th><th>Value</th></tr></thead>';for(var d in b.data.config)console.log(d),c+="<tr><td>"+d+"</td><td>"+b.data.config[d]+"</td></tr>";c+="</table></p>",a("#asyncData").html("<div>"+c+"</div>")}function $(a){console.log("tdplayer::onNPESong"),console.log(a),ub=a.data.song,_b=ub.artist(),_b.addEventListener?_b.addEventListener("artist-complete",bb):_b.attachEvent&&_b.attachEvent("artist-complete",bb);var b=eb();ab(b,!1)}function ab(b,c){a("#asyncData").empty();var d=c?"asyncData":"npeInfo",e=a("#"+d);c===!1&&e.html('<span class="label label-inverse">Npe Info:</span>'),e.append(b)}function bb(){_b.addEventListener?_b.addEventListener("picture-complete",cb):_b.attachEvent&&_b.attachEvent("picture-complete",cb);for(var a=_b.getPictures(),b=[],c=0;c<a.length;c++)b.push(a[c].id);b.length>0&&_b.fetchPictureByIds(b);var d=db();ab(d,!0)}function cb(b){console.log("tdplayer::onArtistPictureComplete"),console.log(b);for(var c='<span class="label label-inverse">Photos:</span><br>',d=0;d<b.length;d++)b[d].getFiles()&&(c+='<a href="'+b[d].getFiles()[0].url+'" rel="lightbox[npe]" title="Click on the right side of the image to move forward."><img src="'+b[d].getFiles()[0].url+'" width="125" /></a>&nbsp;');a("#asyncData").append(c)}function db(){if(ub!==c){var a='<span class="label label-inverse">Artist:</span>';a+="<ul><li>Artist id: "+ub.artist().id+"</li>",a+="<li>Artist birth date: "+ub.artist().getBirthDate()+"</li>",a+="<li>Artist end date: "+ub.artist().getEndDate()+"</li>",a+="<li>Artist begin place: "+ub.artist().getBeginPlace()+"</li>",a+="<li>Artist end place: "+ub.artist().getEndPlace()+"</li>",a+="<li>Artist is group ?: "+ub.artist().getIsGroup()+"</li>",a+="<li>Artist country: "+ub.artist().getCountry()+"</li>";for(var b=ub.artist().getAlbums(),d=0;d<b.length;d++)a+="<li>Album "+(d+1)+": "+b[d].getTitle()+"</li>";var e=ub.artist().getSimilar();for(d<e.length;d++;)a+="<li>Similar artist "+(d+1)+": "+e[d].name+"</li>";var f=ub.artist().getMembers();for(d<f.length;d++;)a+="<li>Member "+(d+1)+": "+f[d].name+"</li>";a+="<li>Artist website: "+ub.artist().getWebsite()+"</li>",a+="<li>Artist twitter: "+ub.artist().getTwitterUsername()+"</li>",a+="<li>Artist facebook: "+ub.artist().getFacebookUrl()+"</li>",a+="<li>Artist biography: "+ub.artist().getBiography().substring(0,2e3)+"...</small>";var g=ub.artist().getGenres();for(d<g.length;d++;)a+="<li>Genre "+(d+1)+": "+g[d]+"</li>";return a+="</ul>"}return'<span class="label label-important">The artist information is undefined</span>'}function eb(){var a="NPE Data undefined";if(ub!==c&&ub.album()){var b="";null!=ub.album().getBuyUrl()&&(b='<a target="_blank" title="'+ub.album().getBuyUrl()+'" href="'+ub.album().getBuyUrl()+'">Buy on iTunes</a><br/>'),a="<p><b>Album:</b> "+ub.album().getTitle()+"<br/>"+b+'<img src="'+ub.album().getCoverArtOriginal().url+'" style="height:100px" /></p>'}return a}function fb(){for(var a,c=[],d=b.location.href.slice(b.location.href.indexOf("?")+1).split("&"),e=0;e<d.length;e++)a=d[e].split("="),c.push(a[0]),c[a[0]]=a[1];return c}function gb(b,c){c?console.error(b):console.log(b),a("#debugInformation").append(b),a("#debugInformation").append("\n")}function hb(){a("#debugInformation").html("")}function ib(){if("undefined"!=typeof Modernizr&&Modernizr.audio){var b=document.querySelectorAll(".content"),c=a(b);c.on("click",".podcast__btn--play",function(b){var c=a(b.currentTarget);p(b),fc(c.attr("data-mp3-src")),bc(),jc(c.attr("data-mp3-title"),c.attr("data-mp3-artist"),c.attr("data-mp3-hash"))}),c.on("click",".podcast__btn--pause",gc)}else{var d=a(".gmr-mediaelement-fallback audio"),e=a(".podcast__play");d.mediaelementplayer(),e.hide()}}function jb(){is_gigya_user_logged_in()?a.support.pjax&&a(document).pjax("a:not(.ab-item)",".main",{fragment:".main",maxCacheLength:500,timeout:1e4}):gmlp.logged_in&&a.support.pjax&&a(document).pjax("a:not(.ab-item)",".page-wrap",{fragment:".page-wrap",maxCacheLength:500,timeout:1e4})}function kb(){a(document).on("pjax:click",function(a){a.preventDefault()})}function lb(){var a,b=document.querySelectorAll(".audio__progress"),c=0;for(a=0;a<b.length;++a)xb.currentTime>0&&(c=Math.floor(100/xb.duration*xb.currentTime)),b[a].style.width=c+"%"}function mb(){var a,b,c,d=document.querySelectorAll(".audio__time--remaining"),e=parseInt(xb.duration),f=parseInt(xb.currentTime),g=e-f;for(a=0;a<d.length;++a)b=g%60,b=isNaN(b)?"00":10>b?"0"+b:b,c=Math.floor(g/60)%60,isNaN(c)&&(c="0"),d[a].innerHTML=c+":"+b}function nb(){var a,b=document.querySelectorAll(".audio__time--elapsed"),c=parseInt(xb.currentTime%60),d=parseInt(xb.currentTime/60%60);for(a=0;a<b.length;++a)b[a].innerHTML=10>c?d+":0"+c:d+":"+c}var ob,pb,qb,rb,sb,tb,ub,vb,wb=(fb().tech||"html5_flash","false"==fb().aSyncCuePointFallback?!1:!0,!1),xb=!1,yb=document.querySelector("body"),zb=document.getElementById("td_container"),Ab=document.getElementById("live-player"),Bb=document.querySelector(".live-stream__player"),Cb=document.getElementById("playButton"),Db=document.getElementById("pauseButton"),Eb=document.getElementById("resumeButton"),Fb=document.getElementById("loadButton"),Gb=document.querySelector(".podcast__btn--play"),Hb=document.querySelector(".podcast__btn--pause"),Ib=document.querySelector(".podcast-player"),Jb=document.getElementById("live-stream__listen-now"),Kb=document.getElementById("live-stream__now-playing"),Lb=document.getElementById("live-stream__login"),Mb=a(document.getElementById("trackInfo")),Nb=gigya_profile_path("login"),Ob=document.getElementById("clearDebug"),Pb=document.getElementById("on-air"),Qb=document.getElementById("live-stream__status"),Rb=document.getElementById("nowPlaying"),Sb=document.getElementById("trackInfo"),Tb=document.querySelector(".live-player__stream"),Ub=null,Vb=null,Wb=6e4,Xb=(document.querySelector(".footer"),null),Yb="click";b.tdPlayerApiReady=function(){console.log("--- TD Player API Loaded ---"),j()};var Zb=function(){var a=Jb.textContent,c=document.getElementById("trackInfo"),d=document.getElementById("npeInfo");if(!0===wb&&(xb.pause(),c.innerHTML="",d.innerHTML="",bc(),q(),wb=!1,h()),"Switch to Live Stream"===a&&(Jb.innerHTML="Listen Live"),b.innerWidth>=768)var e=setInterval(function(){0===Xb||(1===Xb?(A(),clearInterval(e)):u())})};a(document).ready(function(){x()});var $b=a(".live-player__stream--current-name");$b.bind("DOMSubtreeModified",function(){console.log("--- new stream select ---");var a=$b.text();tb&&ob.stop(),!0===wb&&Zb(),ob.play({station:a,timeShift:!0}),Ab.classList.add("live-player--active"),l()});var _b,ac=function(){"undefined"!=typeof ob&&"undefined"!=typeof ob.stop&&ob.stop()},bc=function(){a(".podcast__btn--play.playing").removeClass("playing"),a(".podcast__btn--pause.playing").removeClass("playing")},cc=function(){var b=".mp3-"+rb;a(b+" .podcast__btn--play").addClass("playing"),a(b+" .podcast__btn--pause").addClass("playing")},dc=function(a){xb.src=a},ec=function(){wb=!0,ac(),xb.play(),hc(),ic(),bc(),l(),cc(),o(),f()},fc=function(a){jb(),a!==xb.src&&dc(a),ec()},gc=function(){kb(),xb.pause(),bc(),n(),h()},hc=function(){var b=_.template('<div class="now-playing__title"><%- title %></div>'),c=a(".now-playing__title"),d='<div class="audio__title">',e='</div><div class="audio__time"><span class="audio__time--inline">(</span><div class="audio__time--elapsed"></div><span class="audio__time--inline"> / </span><div class="audio__time--remaining"></div><span class="audio__time--inline">)</span></div>';c.length>0?c.html(d+qb+e):Mb.prepend(b({title:qb}))},ic=function(){var b=_.template('<div class="now-playing__artist"><%- artist %></div>'),c=a(".now-playing__artist");c.length>0?c.text(pb):Mb.append(b({artist:pb}))},jc=function(a,b,c){qb=a,pb=b,rb=c,hc(),ic(),cc()},kc=function(){"undefined"!=typeof Modernizr&&Modernizr.audio&&(xb=new Audio,xb.addEventListener?xb.addEventListener("ended",function(){bc(),n(),h()}):xb.attachEvent&&xb.attachEvent("ended",function(){bc(),n(),h()}))};kc(),ib(),xb.addEventListener("timeupdate",function(){lb(),nb(),mb()},!1),d(Gb,Yb,o),d(Hb,Yb,gc),a(document).on("pjax:end",function(){ib(),cc(),d(Gb,Yb,o),d(Hb,Yb,gc)})}(jQuery,window);