!function(a,b,c){"use strict";function d(){var a;switch(gb){case"html5_flash":a=["Html5","Flash"];break;case"flash":a=["Flash"];break;case"html5":a=["Html5"];break;case"flash_html5":default:a=["Flash","Html5"]}var b={coreModules:[{id:"MediaPlayer",playerId:"td_container",isDebug:!0,techPriority:a,timeShift:{active:0,max_listening_time:35},geoTargeting:{desktop:{isActive:!1},iOS:{isActive:!1},android:{isActive:!1}},plugins:[{id:"vastAd"}]},{id:"NowPlayingApi"},{id:"Npe"},{id:"PlayerWebAdmin"},{id:"SyncBanners",elements:[{id:"td_synced_bigbox",width:300,height:250}]},{id:"TargetSpot"}]};require(["tdapi/base/util/Companions"],function(a){fb=new a}),ab=new TdPlayerApi(b),ab.addEventListener("player-ready",o),ab.addEventListener("configuration-error",I),ab.addEventListener("module-error",J),ab.loadModules()}function e(){var b=document.getElementById("playButton"),c=document.getElementById("pauseButton"),d=document.getElementById("resumeButton"),e=document.getElementById("clearDebug"),f=a(".mejs-play");null!=b&&b.addEventListener("click",k),null!=c&&c.addEventListener("click",l),null!=d&&d.addEventListener("click",m),null!=e&&e.addEventListener("click",$),f.click(function(){lb.hide(),mb.show(),l()})}function f(){gmr.logged_in?document.referrer==pb?(console.log("--- You are just logged in, so now enjoy some music ---"),g(),i(),ab.addEventListener("ad-playback-complete",function(){h(),console.log("--- ad complete ---"),j()})):(console.log("--- You are logged in, so now enjoy some music ---"),kb.addEventListener("click",k)):console.log("--- Log In with Gigya ---")}function g(){var a=document.getElementById("live-stream__container");null!=a&&a.classList.add("vast__pre-roll")}function h(){var a=document.getElementById("live-stream__container");null!=a&&a.classList.remove("vast__pre-roll")}function i(){var a=gmr.streamUrl;R(),Q(),ab.stop(),ab.skipAd(),ab.playAd("vastAd",{url:a})}function j(){var a=gmr.callsign;return""==a?void alert("Please enter a Station"):(Z("playLiveStream - station="+a),db&&ab.stop(),ab.play({station:a,timeShift:!0}),jb.classList.add("stream__active"),kb.style.display="none",lb.style.display="block",nb.style.display="none",void(ob.style.display="inline-block"))}function k(){var a=gmr.callsign;return""==a?void alert("Please enter a Station"):(Z("playLiveStream - station="+a),g(),i(),void ab.addEventListener("ad-playback-complete",function(){h(),console.log("--- ad complete ---"),db&&ab.stop(),ab.play({station:a,timeShift:!0}),jb.classList.add("stream__active"),kb.style.display="none",lb.style.display="block",nb.style.display="none",ob.style.display="inline-block"}))}function l(){ab.pause(),jb.classList.remove("stream__active"),kb.style.display="none",lb.style.display="none",mb.style.display="block",nb.style.display="inline-block",ob.style.display="none"}function m(){db?ab.resume():ab.play(),jb.classList.add("stream__active"),kb.style.display="none",mb.style.display="none",lb.style.display="block",nb.style.display="none",ob.style.display="inline-block"}function n(){if(""==a("#songHistoryCallsignUser").val())return void alert("Please enter a Callsign");var b="hdConnection"==a("#songHistoryConnectionTypeSelect").val();ab.NowPlayingApi.load({mount:a("#songHistoryCallsignUser").val(),hd:b,numberToFetch:15})}function o(){ab.MediaPlayer!=c&&(f(),e(),ab.addEventListener("track-cue-point",y),ab.addEventListener("ad-break-cue-point",B),ab.addEventListener("stream-track-change",z),ab.addEventListener("hls-cue-point",A),ab.addEventListener("stream-status",K),ab.addEventListener("stream-geo-blocked",L),ab.addEventListener("timeout-alert",G),ab.addEventListener("timeout-reach",H),ab.addEventListener("npe-song",S),ab.addEventListener("stream-select",w),ab.addEventListener("stream-start",v),ab.addEventListener("stream-stop",x),ab.setVolume(1),M("Api Ready"),N(ab.MediaPlayer.tech.type),ab.addEventListener("list-loaded",D),ab.addEventListener("list-empty",E),ab.addEventListener("nowplaying-api-error",F),a("#fetchSongHistoryByUserCallsignButton").click(function(){n()}),ab.addEventListener("pwa-data-loaded",P),a("#pwaButton").click(function(){O()}))}function p(a){bb=!0,M("Advertising... Type="+a.data.type)}function q(){bb=!1,a("#td_adserver_bigbox").empty(),a("#td_adserver_leaderboard").empty(),M("Ready")}function r(a){Z("Ad countdown : "+a.data.countDown+" second(s)")}function s(a){Z("Vast Process complete");var b=a.data.companions;u(b)}function t(a){Z("Vpaid Ad Companions"),u(a.companions)}function u(b){if(b&&b.length>0){var c=-1,d=-1;a.each(b,function(a,b){300==parseInt(b.width)&&250==parseInt(b.height)?c=a:728==parseInt(b.width)&&90==parseInt(b.height)&&(d=a)}),c>-1&&fb.loadVASTCompanionAd("td_adserver_bigbox",b[c]),d>-1&&fb.loadVASTCompanionAd("td_adserver_leaderboard",b[d])}}function v(){db=!0}function w(){a("#hasHQ").html(ab.MediaPlayer.hasHQ().toString()),a("#isHQ").html(ab.MediaPlayer.isHQ().toString()),a("#hasLow").html(ab.MediaPlayer.hasLow().toString()),a("#isLow").html(ab.MediaPlayer.isLow().toString())}function x(){db=!1,C(),a("#trackInfo").html(""),a("#asyncData").html(""),a("#hasHQ").html("N/A"),a("#isHQ").html("N/A"),a("#hasLow").html("N/A"),a("#isLow").html("N/A")}function y(b){Z("New Track cuepoint received"),Z("Title:"+b.data.cuePoint.cueTitle+" - Artist:"+b.data.cuePoint.artistName),console.log(b),cb&&cb!=b.data.cuePoint&&C(),b.data.cuePoint.nowplayingURL&&ab.Npe.loadNpeMetadata(b.data.cuePoint.nowplayingURL,b.data.cuePoint.artistName,b.data.cuePoint.cueTitle),cb=b.data.cuePoint,a("#trackInfo").html('<div class="now-playing__title">'+cb.cueTitle+'</div><div class="now-playing__artist">'+cb.artistName+"</div>")}function z(a){Z("Stream Track has changed"),Z("Codec:"+a.data.cuePoint.audioTrack.codec()+" - Bitrate:"+a.data.cuePoint.audioTrack.bitRate())}function A(a){Z("New HLS cuepoint received"),Z("Track Id:"+a.data.cuePoint.hlsTrackId+" SegmentId:"+a.data.cuePoint.hlsSegmentId),console.log(a)}function B(a){M("Commercial break..."),console.log(a)}function C(){a("#npeInfo").html(""),a("#asyncData").html("")}function D(b){Z("Song History loaded"),console.log(b.data),a("#asyncData").html('<br><p><span class="label label-warning">Song History:</span>');var c,d='<table class="table table-striped"><thead><tr><th>Song title</th><th>Artist name</th><th>Time</th></tr></thead>';a.each(b.data.list,function(a,b){c=new Date(Number(b.cueTimeStart)),d+="<tr><td>"+b.cueTitle+"</td><td>"+b.artistName+"</td><td>"+c.toLocaleTimeString()+"</td></tr>"}),d+="</table></p>",a("#asyncData").html("<div>"+d+"</div>")}function E(){a("#asyncData").html('<br><p><span class="label label-important">Song History is empty</span>')}function F(b){Z("Song History loading error",!0),console.error(b),a("#asyncData").html('<br><p><span class="label label-important">Song History error</span>')}function G(){Z("Time Out Alert")}function H(){Z("Time Out Reached")}function I(a){Z("Configuration error",!0),console.log(a)}function J(b){var c="";a.each(b.data.errors,function(a,b){c+="ERROR : "+b.data.error.message+"<br/>"}),a("#status").html('<p><span class="label label-important">'+c+"</span><p></p>")}function K(a){console.log("tdplayer::onStatus"),M(a.data.status)}function L(a){console.log("tdplayer::onGeoBlocked"),M(a.data.text)}function M(b){Z(b),a("#status").html('<p><span class="label label-success">Status: '+b+"</span></p>")}function N(b){var c=ab.version.major+"."+ab.version.minor+"."+ab.version.patch+"."+ab.version.flag,d='<p><span class="label label-info">Api version: '+c+" - Technology: "+b;ab.flash.available&&(d+=" - Your current version of flash plugin is: "+ab.flash.version.major+"."+ab.flash.version.minor+"."+ab.flash.version.rev),d+="</span></p>",a("#techInfo").html(d)}function O(){return""==a("#pwaCallsign").val()||""==a("#pwaStreamId").val()?void alert("Please enter a Callsign and a streamid"):void ab.PlayerWebAdmin.load(a("#pwaCallsign").val(),a("#pwaStreamId").val())}function P(b){Z("PlayerWebAdmin data loaded successfully"),console.log(b),a("#asyncData").html('<br><p><span class="label label-warning">PlayerWebAdmin:</span>');var c='<table class="table table-striped"><thead><tr><th>Key</th><th>Value</th></tr></thead>';for(var d in b.data.config)console.log(d),c+="<tr><td>"+d+"</td><td>"+b.data.config[d]+"</td></tr>";c+="</table></p>",a("#asyncData").html("<div>"+c+"</div>")}function Q(){ab.addEventListener("ad-playback-start",p),ab.addEventListener("ad-playback-error",q),ab.addEventListener("ad-playback-complete",q),ab.addEventListener("ad-countdown",r),ab.addEventListener("vast-process-complete",s),ab.addEventListener("vpaid-ad-companions",t)}function R(){ab.removeEventListener("ad-playback-start",p),ab.removeEventListener("ad-playback-error",q),ab.removeEventListener("ad-playback-complete",q),ab.removeEventListener("ad-countdown",r),ab.removeEventListener("vast-process-complete",s),ab.removeEventListener("vpaid-ad-companions",t)}function S(a){console.log("tdplayer::onNPESong"),console.log(a),eb=a.data.song,tb=eb.artist(),tb.addEventListener("artist-complete",U);var b=X();T(b,!1)}function T(b,c){a("#asyncData").empty();var d=c?"asyncData":"npeInfo",e=a("#"+d);0==c&&e.html('<span class="label label-inverse">Npe Info:</span>'),e.append(b)}function U(){tb.addEventListener("picture-complete",V);for(var a=tb.getPictures(),b=[],c=0;c<a.length;c++)b.push(a[c].id);b.length>0&&tb.fetchPictureByIds(b);var d=W();T(d,!0)}function V(b){console.log("tdplayer::onArtistPictureComplete"),console.log(b);for(var c='<span class="label label-inverse">Photos:</span><br>',d=0;d<b.length;d++)b[d].getFiles()&&(c+='<a href="'+b[d].getFiles()[0].url+'" rel="lightbox[npe]" title="Click on the right side of the image to move forward."><img src="'+b[d].getFiles()[0].url+'" width="125" /></a>&nbsp;');a("#asyncData").append(c)}function W(){if(eb!=c){var a='<span class="label label-inverse">Artist:</span>';a+="<ul><li>Artist id: "+eb.artist().id+"</li>",a+="<li>Artist birth date: "+eb.artist().getBirthDate()+"</li>",a+="<li>Artist end date: "+eb.artist().getEndDate()+"</li>",a+="<li>Artist begin place: "+eb.artist().getBeginPlace()+"</li>",a+="<li>Artist end place: "+eb.artist().getEndPlace()+"</li>",a+="<li>Artist is group ?: "+eb.artist().getIsGroup()+"</li>",a+="<li>Artist country: "+eb.artist().getCountry()+"</li>";for(var b=eb.artist().getAlbums(),d=0;d<b.length;d++)a+="<li>Album "+(d+1)+": "+b[d].getTitle()+"</li>";for(var e=eb.artist().getSimilar(),d=0;d<e.length;d++)a+="<li>Similar artist "+(d+1)+": "+e[d].name+"</li>";for(var f=eb.artist().getMembers(),d=0;d<f.length;d++)a+="<li>Member "+(d+1)+": "+f[d].name+"</li>";a+="<li>Artist website: "+eb.artist().getWebsite()+"</li>",a+="<li>Artist twitter: "+eb.artist().getTwitterUsername()+"</li>",a+="<li>Artist facebook: "+eb.artist().getFacebookUrl()+"</li>",a+="<li>Artist biography: "+eb.artist().getBiography().substring(0,2e3)+"...</small>";for(var g=eb.artist().getGenres(),d=0;d<g.length;d++)a+="<li>Genre "+(d+1)+": "+g[d]+"</li>";return a+="</ul>"}return'<span class="label label-important">The artist information is undefined</span>'}function X(){var a="NPE Data undefined";if(eb!=c&&eb.album()){var b="";null!=eb.album().getBuyUrl()&&(b='<a target="_blank" title="'+eb.album().getBuyUrl()+'" href="'+eb.album().getBuyUrl()+'">Buy on iTunes</a><br/>'),a="<p><b>Album:</b> "+eb.album().getTitle()+"<br/>"+b+'<img src="'+eb.album().getCoverArtOriginal().url+'" style="height:100px" /></p>'}return a}function Y(){for(var a,c=[],d=b.location.href.slice(b.location.href.indexOf("?")+1).split("&"),e=0;e<d.length;e++)a=d[e].split("="),c.push(a[0]),c[a[0]]=a[1];return c}function Z(b,c){c?console.error(b):console.log(b),a("#debugInformation").append(b),a("#debugInformation").append("\n")}function $(){a("#debugInformation").html("")}function _(){if("undefined"!=typeof Modernizr&&Modernizr.audio){var b=document.querySelectorAll(".content"),c=a(b);c.on("click",".podcast__btn--play",function(b){var c=a(b.currentTarget),d=c.parent().find(".podcast__btn--pause");xb(c.attr("data-mp3-src")),ub(),c.addClass("playing"),d.addClass("playing"),Ab(c.attr("data-mp3-title")),Bb(c.attr("data-mp3-artist"))}),c.on("click",".podcast__btn--pause",zb)}else{var d=a(".gmr-mediaelement-fallback audio"),e=a(".podcast__play");d.mediaelementplayer(),e.hide()}}var ab,bb,cb,db,eb,fb,gb=Y().tech,hb=("false"==Y().aSyncCuePointFallback?!1:!0,!1),ib=!1,jb=document.getElementById("td_container"),kb=document.getElementById("playButton"),lb=document.getElementById("pauseButton"),mb=document.getElementById("resumeButton"),nb=document.getElementById("live-stream__listen-now"),ob=document.getElementById("live-stream__now-playing"),pb=gmr.homeUrl+"members/login",qb=!1,rb=!1;b.tdPlayerApiReady=function(){console.log("--- TD Player API Loaded ---"),d()},a(document).pjax("a:not(.ab-item)","div.page-wrap",{fragment:"div.page-wrap",maxCacheLength:500,timeout:5e3});var sb=a(".live-player__stream--current-name");sb.bind("DOMSubtreeModified",function(){console.log("--- new stream select ---");var a=sb.text();db&&ab.stop(),ab.play({station:a,timeShift:!0})});var tb,ub=function(){a(".podcast__btn--play.playing").removeClass("playing"),a(".podcast__btn--pause.playing").removeClass("playing")},vb=function(a){ib.src=a},wb=function(){hb=!0,ib.play()},xb=function(a){vb(a),wb()},yb=function(){ib.pause(),ub()},zb=function(){yb(),hb=!1},Ab=function(b){!1===qb&&(qb=a(".now-playing__title")),qb.text(b)},Bb=function(b){!1===rb&&(rb=a(".now-playing__artist")),rb.text(b)},Cb=function(){"undefined"!=typeof Modernizr&&Modernizr.audio&&(ib=new Audio,ib.addEventListener("ended",ub))};Cb(),_(),a(document).on("pjax:end",_)}(jQuery,window);