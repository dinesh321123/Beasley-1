!function(a){var b=a(document);b.ready(function(){var c,d,e=a("#gallery-item-tmpl").html(),f=a(".add-gallery-item");d=function(){var a="undefined"!=typeof tinymce&&tinymce.get("content");a&&(a.isNotDirty=!1)},a.fn.sortable&&a(".gallery-preview").sortable({items:"> .gallery-image",containment:"parent",cursor:"move",distance:20,placeholder:"gallery-item gallery-item-placeholder",stop:d}).disableSelection(),c=wp.media({title:"Add image to the gallery",multiple:!0,library:{type:"image"},button:{text:"Select Image"}}),c.on("select",function(){var b=c.state().get("selection");b&&b.each(function(b){var c,d=b.attributes,g=d.sizes,h=g.medium||g.full||g.thumbnail;c=e.replace("%id%",d.id).replace("%image%",h.url),a(c).insertBefore(f.parent())})}),f.click(function(){return d(),c.open(),!1}),b.on("click",".remove-gallery-item",function(){d(),a(this).parent().remove()}),b.on("click",".gallery-preview .gallery-item",function(){var b=a(this),c=b.find("input").val(),e=wp.media({title:"Change gallery image",button:{text:"Select Image"},states:[new wp.media.controller.Library({title:"Change gallery image",multiple:!1,selection:"single",content:"browse"})]});e.on("open",function(){var a=e.state().get("selection");if(c){var b=wp.media.attachment(c);b.fetch().then(function(){a.add(b)})}}),e.on("select",function(){var a=e.state().get("selection");a&&a.each(function(a){var c=a.attributes,e=c.sizes,f=e.medium||e.full||e.thumbnail;b.find("input").val(c.id),b.css("background-image","url("+f.url+")"),d()})}),e.open()})})}(jQuery);